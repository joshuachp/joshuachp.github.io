1:HL["/_next/static/css/c54d109becb66e5a.css",{"as":"style"}]
0:[[["",{"children":["notes",{"children":[["path","2022-06-18","d"],{"children":["__PAGE__?{\"path\":\"2022-06-18\"}",{}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/c54d109becb66e5a.css","precedence":"next"}]],["$L3",null]]]]
4:HL["/_next/static/css/2a1840b1c557e13c.css",{"as":"style"}]
2:["$L5",null]
3:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"/dev/blog - /dev/blog - Jouranl 2022-06-18"}],["$","meta",null,{"name":"description","content":"Developer blog"}],["$","meta",null,{"name":"application-name","content":"/dev/blog"}],null,null,["$","meta",null,{"name":"generator","content":"Next.js"}],["$","meta",null,{"name":"keywords","content":"Dev,Blog,Programmings"}],["$","meta",null,{"name":"referrer","content":"origin-when-cross-origin"}],[["$","meta",null,{"name":"theme-color","content":"amber"}]],["$","meta",null,{"name":"color-scheme","content":"dark"}],["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta",null,{"name":"creator","content":"Joshua Chapman"}],null,null,null,null,null,null,null,null,null,[]],[["$","link",null,{"rel":"canonical","href":"https://joshuachp.dev/notes/2022-06-18"}],null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.svg","type":"image/svg+xml"}],["$","link",null,{"rel":"icon","href":"/favicon.png","type":"image/png"}],["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon"}]],[],null]]
6:I{"id":"3508","chunks":["920:static/chunks/920-79b25866a09062bb.js","185:static/chunks/app/layout-bb2895f610760e8a.js"],"name":"","async":false}
7:I{"id":"247","chunks":["920:static/chunks/920-79b25866a09062bb.js","185:static/chunks/app/layout-bb2895f610760e8a.js"],"name":"","async":false}
8:I{"id":"3495","chunks":["920:static/chunks/920-79b25866a09062bb.js","185:static/chunks/app/layout-bb2895f610760e8a.js"],"name":"","async":false}
9:I{"id":"4463","chunks":["272:static/chunks/webpack-00f0855eb92aefea.js","667:static/chunks/2443530c-52b0a2f58ac02a84.js","488:static/chunks/488-c7775bdaa3bbbd30.js"],"name":"","async":false}
a:I{"id":"1010","chunks":["272:static/chunks/webpack-00f0855eb92aefea.js","667:static/chunks/2443530c-52b0a2f58ac02a84.js","488:static/chunks/488-c7775bdaa3bbbd30.js"],"name":"","async":false}
5:["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","$L6",null,{"production":true,"goatCounterApi":"a7d98e3f-b56b"}],["$","script",null,{"id":"dark-theme","dangerouslySetInnerHTML":{"__html":"if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}"}}]]}],["$","body",null,{"className":"bg-primary-50 dark:bg-primary-900","children":["$","$L7",null,{"children":[["$","$L8",null,{}],["$","main",null,{"className":"flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96","children":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children","notes","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children","notes","children",["path","2022-06-18","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Lb",null],"segment":"__PAGE__?{\"path\":\"2022-06-18\"}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/2a1840b1c557e13c.css","precedence":"next"}]]}],"segment":["path","2022-06-18","d"]},"styles":[]}],"segment":"notes"},"styles":[]}]}]]}]}]]}]
c:I{"id":"8920","chunks":["920:static/chunks/920-79b25866a09062bb.js","563:static/chunks/app/posts/[path]/page-1689690ab55e8573.js"],"name":"","async":false}
d:I{"id":"8451","chunks":["920:static/chunks/920-79b25866a09062bb.js","563:static/chunks/app/posts/[path]/page-1689690ab55e8573.js"],"name":"","async":false}
b:["$","article",null,{"className":"flex max-w-full grow flex-col justify-self-start","children":[["$","h1",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl","children":[["$","span","1",{"children":"Journal 2022-06-18"}]]}],["$","h2",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl","children":[["$","span","4",{"children":"Rust"}]]}],["$","ul",null,{"className":"mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc","children":[["$","li","15",{"className":"mb-2","children":[["$","$Lc",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://crates.io/crates/pretty_assertions","children":[["$","span","9",{"children":"pretty_assertions"}]]}],["$","span","11",{"children":": Overwrite"}],"\r\n",["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"assert_eq!"}],["$","span","14",{"children":" with a drop-in replacement, adding a colorful diff."}]]}]]}],["$","h3",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl","children":[["$","span","18",{"children":"Custom Serde Serialize"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","21",{"children":"It could be difficult to make a custom implementation of the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"serde::Serialize"}],"\r\n",["$","span","24",{"children":"trait. Like serializing a "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"Vec"}],["$","span","26",{"children":" into a tree or graph structure. This is because"}],"\r\n",["$","span","28",{"children":"you need to consume the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"serde::Serializer"}],["$","span","30",{"children":" to create a data type like"}],"\r\n",["$","span","32",{"children":"structure or sequence. A trick I implemented to overcome this limitation is to"}],"\r\n",["$","span","34",{"children":"implement the visitor patten to a custom "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"enum"}],["$","span","36",{"children":" that implements "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"Serialize"}],"\r\n",["$","span","39",{"children":"itself."}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","42",{"children":"You start by implementing the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"Serialize"}],["$","span","44",{"children":" for your structure:"}]]}],["$","$Ld","48",{"language":"rust","className":"mb-4 mt-2","children":[["$","span","47",{"children":"use serde::Serialize;\n\nimpl<T> Serialize for Vec<T>\nwhere\n    T: Serialize,\n{\n    fn serialize<S>(&self, serializer: S) -> Result<S::Ok, S::Error>\n    where\n        S: Serializer,\n    {\n        let mut seq = serializer.serialize_seq(Some(self.len()))?;\n        for e in self {\n            ...\n        }\n        seq.end()\n    }\n}\n"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","50",{"children":"And when you need an additional structure you create an enum and implement"}],"\r\n",["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"Serialize"}],["$","span","53",{"children":" for it:"}]]}],["$","$Ld","57",{"language":"rust","className":"mb-4 mt-2","children":[["$","span","56",{"children":"\nenum ElementSerialize<T> {\n    Node{ elements: &[T], ...},\n    Childs{ elements: &[T], ...}\n}\n...\n\nimpl<T> Serialize for ElementSerialize<T>\nwhere\n    T: Serialize,\n{\n    fn serialize<S>(&self, serializer: S) -> Result<S::Ok, S::Error>\n    where\n        S: Serializer,\n    {\n        match self {\n            Node{...} => todo!(), // Can now consume the serializer inside the match\n            Childs{...} => todo!(),\n        }\n    }\n}\n"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","59",{"children":"And you can wrap the value in the Serialize of the structure:"}]]}],["$","$Ld","63",{"language":"rust","className":"mb-4 mt-2","children":[["$","span","62",{"children":"...\n        // Inside impl Serialize for Vec\n        for e in self {\n            seq.serialize_element(ElementSerialize::Node(...))?;\n        }\n...\n"}]]}],["$","h3",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl","children":[["$","span","65",{"children":"Publish a package"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","68",{"children":"To publish a packages to "}],["$","$Lc",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://crates.io","children":[["$","span","70",{"children":"crates.io"}]]}],["$","span","72",{"children":":"}]]}],["$","ul",null,{"className":"mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc","children":[["$","li","77",{"className":"mb-2","children":[["$","span","76",{"children":"Register on the site"}]]}],["$","li","80",{"className":"mb-2","children":[["$","span","79",{"children":"Create a new API Token and save it"}]]}],["$","li","98",{"className":"mb-2","children":[["$","span","82",{"children":"Set the token to work with cargo:"}],["$","ul",null,{"className":"mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc","children":[["$","li","91",{"className":"mb-2","children":[["$","span","85",{"children":"Run "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"cargo login"}],["$","span","87",{"children":" to set the token in the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"$$CARGO_HOME/credentials.toml"}],"\r\n",["$","span","90",{"children":"file"}]]}],["$","li","96",{"className":"mb-2","children":[["$","span","93",{"children":"Otherwise for CI/CD set the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"CARGO_REGISTRY_TOKEN"}],["$","span","95",{"children":" environment variable"}]]}]]}]]}],["$","li","102",{"className":"mb-2","children":[["$","span","100",{"children":"Run "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"cargo publish"}]]}]]}],["$","h4",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-xl font-semibold tracking-tight sm:text-2xl md:text-3xl","children":[["$","span","105",{"children":"Publish with GitHub Actions"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","108",{"children":"A simple workflow to publish a create when on a new release is the following:"}]]}],["$","$Ld","112",{"language":"yaml","className":"mb-4 mt-2","children":[["$","span","111",{"children":"name: Publish\n\non:\n  release:\n    types: [published]\n  workflow_dispatch:\n\nenv:\n  CARGO_TERM_COLOR: always\n\njobs:\n  publish:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      - uses: actions/cache@v3\n        with:\n          path: |\n            ~/.cargo/bin/\n            ~/.cargo/registry/index/\n            ~/.cargo/registry/cache/\n            ~/.cargo/git/db/\n            target/\n          key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}\n      - name: Check\n        run: cargo check --all-targets --all-features --verbose --locked\n      - name: Build\n        run: cargo build --verbose --locked\n      - name: Run tests\n        run: cargo test --all-targets --all-features --verbose --locked\n      - name: Publish crate\n        run: cargo publish --verbose --locked\n        env:\n          CARGO_REGISTRY_TOKEN: ${{ secrets.CARGO_REGISTRY_TOKEN }}\n"}]]}],"<!-- Morning -->\n","<!-- What do I want to do today? -->\n","<!-- Evening -->\n","<!-- What did I learn today? -->\n","<!-- Things I learned -->\n","<!-- Useful tools and libraries -->\n"]}]
