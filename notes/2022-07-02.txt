0:[[["",{"children":["notes",{"children":[["path","2022-07-02","d"],{"children":["__PAGE__?{\"path\":\"2022-07-02\"}",{}]}]}]},"$undefined","$undefined",true],"$L1","$L2"]]
2:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"/dev/blog - /dev/blog - Jouranl 2022-07-02"}],["$","meta",null,{"name":"description","content":"Developer blog"}],["$","meta",null,{"name":"application-name","content":"/dev/blog"}],null,null,["$","meta",null,{"name":"generator","content":"Next.js"}],["$","meta",null,{"name":"keywords","content":"Dev,Blog,Programmings"}],["$","meta",null,{"name":"referrer","content":"origin-when-cross-origin"}],[["$","meta",null,{"name":"theme-color","content":"amber"}]],["$","meta",null,{"name":"color-scheme","content":"dark"}],["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta",null,{"name":"creator","content":"Joshua Chapman"}],null,null,null,null,null,null,null,null,null,[]],[["$","link",null,{"rel":"canonical","href":"https://joshuachp.dev/notes/2022-07-02"}],null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.svg","type":"image/svg+xml"}],["$","link",null,{"rel":"icon","href":"/favicon.png","type":"image/png"}],["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon"}]],[],null]]
1:["$L3",null,null,[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/816f3edd0640ecf0.css","precedence":"next.js"}]]]
4:I{"id":"5376","name":"","chunks":["619:619-3a70a20416de9ff0","185:app/layout-4b8fb878def027fc"],"async":false}
5:I{"id":"6722","name":"","chunks":["619:619-3a70a20416de9ff0","185:app/layout-4b8fb878def027fc"],"async":false}
6:I{"id":"9299","name":"","chunks":["619:619-3a70a20416de9ff0","185:app/layout-4b8fb878def027fc"],"async":false}
7:I{"id":"5019","name":"","chunks":["619:619-3a70a20416de9ff0","185:app/layout-4b8fb878def027fc"],"async":false}
8:I{"id":"1300","name":"","chunks":["272:webpack-e24f1f8cbee90348","667:2443530c-65ca4daeaf429502","961:961-409d5e344dd5ce3d"],"async":false}
9:I{"id":"6022","name":"","chunks":["272:webpack-e24f1f8cbee90348","667:2443530c-65ca4daeaf429502","961:961-409d5e344dd5ce3d"],"async":false}
3:["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","$L4",null,{"production":true,"goatCounterApi":"a7d98e3f-b56b"}],["$","$L5",null,{"id":"dark-theme","strategy":"beforeInteractive","children":"if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}"}]]}],["$","body",null,{"className":"bg-primary-50 dark:bg-primary-900","children":["$","$L6",null,{"children":[["$","$L7",null,{}],["$","main",null,{"className":"flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96","children":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","notes","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L8",null,{"parallelRouterKey":"children","segmentPath":["children","notes","children",["path","2022-07-02","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L9",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$La",null,null,[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/2a1840b1c557e13c.css","precedence":"next.js"}]]],"segment":"__PAGE__?{\"path\":\"2022-07-02\"}"}}],"segment":["path","2022-07-02","d"]}}],"segment":"notes"}}]}]]}]}]]}]
b:I{"id":"7876","name":"","chunks":["619:619-3a70a20416de9ff0","563:app/posts/[path]/page-f449502d4ce927b8"],"async":false}
a:["$","article",null,{"className":"flex max-w-full grow flex-col justify-self-start","children":[["$","h1",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl","children":[["$","span","1",{"children":"Journal 2022-07-02"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","4",{"children":"Hi, I"}],["$","span","5",{"children":"’"}],["$","span","6",{"children":"ve been following the topic for a while, trying to fix the crash on with"}],"\r\n",["$","span","8",{"children":"sync (not reverse prime). I managed to make it work with the following config:"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","11",{"children":"Video config "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"configuration.nix "}]]}],"<details title=\"video-configuration.nix\">\n",["$","$Lb","17",{"language":"nix","className":"mb-4 mt-2","children":[["$","span","16",{"children":"{ config\n, pkgs\n, lib\n, ...\n}: {\n  config = {\n    services.xserver.exportConfiguration = true;\n\n    services.xserver.videoDrivers = [\n      # \"modesetting\"\n      # \"fbdev\"\n      \"amdgpu\"\n      \"nvidia\"\n    ];\n\n    hardware.opengl = {\n      enable = true;\n\n      extraPackages = with pkgs; [\n        rocm-opencl-icd\n        rocm-opencl-runtime\n        amdvlk\n        vaapiVdpau\n      ];\n\n      driSupport = true;\n    };\n\n\n    hardware.nvidia = {\n      #powerManagement = {\n      #  enable = true;\n      #  finegrained = true;\n      #};\n\n      nvidiaPersistenced = true;\n\n      modesetting.enable = true;\n\n      prime = {\n        #offload.enable = true;\n        sync.enable = true;\n\n        amdgpuBusId = \"PCI:5:0:0\";\n        nvidiaBusId = \"PCI:1:0:0\";\n      };\n    };\n\n    environment.etc.\"X11/xorg.conf.d/10-amdgpu.conf\".text = ''\n      Section \"OutputClass\"\n          Identifier \"AMDgpu\"\n          MatchDriver \"amdgpu\"\n          Driver \"amdgpu\"\n      EndSection\n    '';\n\n    environment.etc.\"X11/xorg.conf.d/10-radeon.conf\".text = ''\n      Section \"OutputClass\"\n          Identifier \"Radeon\"\n          MatchDriver \"radeon\"\n          Driver \"radeon\"\n      EndSection\n    '';\n\n    environment.etc.\"X11/xorg.conf.d/10-nvidia.conf\".text = ''\n      Section \"OutputClass\"\n          Identifier \"nvidia\"\n          MatchDriver \"nvidia-drm\"\n          Driver \"nvidia\"\n          Option \"AllowEmptyInitialConfiguration\"\n          Option \"SLI\" \"Auto\"\n          Option \"BaseMosaic\" \"on\"\n      EndSection\n\n      Section \"ServerLayout\"\n          Identifier \"layout\"\n          Option \"AllowNVIDIAGPUScreens\"\n      EndSection\n    '';\n\n    services.xserver.config = lib.mkForce ''\n      Section \"ServerFlags\"\n        Option \"AllowMouseOpenFail\" \"on\"\n        Option \"DontZap\" \"on\"\n      EndSection\n\n      Section \"Module\"\n      EndSection\n\n      Section \"Monitor\"\n        Identifier \"Monitor[0]\"\n      EndSection\n\n      # Additional \"InputClass\" sections\n      Section \"InputClass\"\n        Identifier \"libinput mouse configuration\"\n        MatchDriver \"libinput\"\n        MatchIsPointer \"on\"\n        Option \"AccelProfile\" \"adaptive\"\n        Option \"LeftHanded\" \"off\"\n        Option \"MiddleEmulation\" \"on\"\n        Option \"NaturalScrolling\" \"off\"\n        Option \"ScrollMethod\" \"twofinger\"\n        Option \"HorizontalScrolling\" \"on\"\n        Option \"SendEventsMode\" \"enabled\"\n        Option \"Tapping\" \"on\"\n        Option \"TappingDragLock\" \"on\"\n        Option \"DisableWhileTyping\" \"off\"\n      EndSection\n\n      Section \"InputClass\"\n        Identifier \"libinput touchpad configuration\"\n        MatchDriver \"libinput\"\n        MatchIsTouchpad \"on\"\n        Option \"AccelProfile\" \"adaptive\"\n        Option \"LeftHanded\" \"off\"\n        Option \"MiddleEmulation\" \"on\"\n        Option \"NaturalScrolling\" \"off\"\n        Option \"ScrollMethod\" \"twofinger\"\n        Option \"HorizontalScrolling\" \"on\"\n        Option \"SendEventsMode\" \"enabled\"\n        Option \"Tapping\" \"on\"\n        Option \"TappingDragLock\" \"on\"\n        Option \"DisableWhileTyping\" \"off\"\n      EndSection\n\n      Section \"ServerLayout\"\n        Identifier \"Layout[all]\"\n        Inactive \"Device-amdgpu[0]\"\n\n        # Reference the Screen sections for each driver.  This will\n        # cause the X server to try each in turn.\n        Screen \"Screen-nvidia[0]\"\n        Screen \"Screen-amdgpu[0]\"\n      EndSection\n\n      # For each supported driver, add a \"Device\" and \"Screen\"\n      # section.\n      Section \"Device\"\n        Identifier \"Device-nvidia[0]\"\n        Driver \"nvidia\"\n        BusID \"PCI:1:0:0\"\n      EndSection\n\n      Section \"Screen\"\n        Identifier \"Screen-nvidia[0]\"\n        Device \"Device-nvidia[0]\"\n        Option \"RandRRotation\" \"on\"\n        Option \"AllowEmptyInitialConfiguration\"\n      EndSection\n\n      Section \"Screen\"\n        Identifier \"Screen-amdgpu[0]\"\n        Device \"Device-amdgpu[0]\"\n      EndSection\n\n\n      Section \"Device\"\n        Identifier \"Device-amdgpu[0]\"\n        Driver \"amdgpu\"\n        BusID \"PCI:5:0:0\"\n      EndSection\n    '';\n\n    services.xserver.displayManager.gdm.wayland = false;\n\n  };\n}\n"}]]}],"</details>\n",["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","20",{"children":"Exported "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"xorg.conf"}]]}],"<details title=\"xorg.conf\">\n",["$","$Lb","26",{"language":"xf86conf","className":"mb-4 mt-2","children":[["$","span","25",{"children":"Section \"Files\"\n\n  FontPath \"/nix/store/qydzz8v6nl5n88aabc2glrayy3wd867q-unifont-14.0.04/share/fonts\"\n  FontPath \"/nix/store/23bir9f496d3q7z7r11l0139afm58ln3-font-cursor-misc-1.0.3/lib/X11/fonts/misc\"\n  FontPath \"/nix/store/zxg8rdv42bqs5rz4p7wwsdq9dlnp8qdp-font-misc-misc-1.1.2/lib/X11/fonts/misc\"\n  FontPath \"/nix/store/srf487s27nqn8vxxyv9jw9sl9fqif6b0-font-adobe-100dpi-1.0.3/lib/X11/fonts/100dpi\"\n  FontPath \"/nix/store/jsysicgm3ifrjzgvpwby4v9vsph3wkm8-font-adobe-75dpi-1.0.3/lib/X11/fonts/75dpi\"\n  ModulePath \"/nix/store/bji361pzh9knqbs182g0jgm22nw9wkgh-xf86-video-amdgpu-21.0.0/lib/xorg/modules/drivers\"\n  ModulePath \"/nix/store/bji361pzh9knqbs182g0jgm22nw9wkgh-xf86-video-amdgpu-21.0.0/lib/xorg/modules/drivers\"\n  ModulePath \"/nix/store/ib2y8r7s6xj408zgg9nsplcqsvpyykk9-nvidia-x11-515.48.07-5.18.6-bin/lib/xorg/modules/drivers\"\n  ModulePath \"/nix/store/ib2y8r7s6xj408zgg9nsplcqsvpyykk9-nvidia-x11-515.48.07-5.18.6-bin/lib/xorg/modules/extensions\"\n  ModulePath \"/nix/store/mjn47cwnwgy49zlcq7kv66smsy7r6ghv-xorg-server-1.20.14/lib/xorg/modules\"\n  ModulePath \"/nix/store/mjn47cwnwgy49zlcq7kv66smsy7r6ghv-xorg-server-1.20.14/lib/xorg/modules/drivers\"\n  ModulePath \"/nix/store/mjn47cwnwgy49zlcq7kv66smsy7r6ghv-xorg-server-1.20.14/lib/xorg/modules/extensions\"\n  ModulePath \"/nix/store/mrpw1zy65avf761yydyl5v2ya1247rs8-xf86-input-evdev-2.10.6/lib/xorg/modules/input\"\n  ModulePath \"/nix/store/cgrphl8qib783yp1g3xifsqv8bvksgsw-xf86-input-libinput-1.2.0/lib/xorg/modules/input\"\nFontPath \"/nix/store/f741iiyrs9dj9rf5nzx0r33gfic0jd1f-X11-fonts/share/X11/fonts\"\n\nEndSection\n\nSection \"ServerFlags\"\n  Option \"AllowMouseOpenFail\" \"on\"\n  Option \"DontZap\" \"on\"\nEndSection\n\nSection \"Module\"\nEndSection\n\nSection \"Monitor\"\n  Identifier \"Monitor[0]\"\nEndSection\n\n# Additional \"InputClass\" sections\nSection \"InputClass\"\n  Identifier \"libinput mouse configuration\"\n  MatchDriver \"libinput\"\n  MatchIsPointer \"on\"\n  Option \"AccelProfile\" \"adaptive\"\n  Option \"LeftHanded\" \"off\"\n  Option \"MiddleEmulation\" \"on\"\n  Option \"NaturalScrolling\" \"off\"\n  Option \"ScrollMethod\" \"twofinger\"\n  Option \"HorizontalScrolling\" \"on\"\n  Option \"SendEventsMode\" \"enabled\"\n  Option \"Tapping\" \"on\"\n  Option \"TappingDragLock\" \"on\"\n  Option \"DisableWhileTyping\" \"off\"\nEndSection\n\nSection \"InputClass\"\n  Identifier \"libinput touchpad configuration\"\n  MatchDriver \"libinput\"\n  MatchIsTouchpad \"on\"\n  Option \"AccelProfile\" \"adaptive\"\n  Option \"LeftHanded\" \"off\"\n  Option \"MiddleEmulation\" \"on\"\n  Option \"NaturalScrolling\" \"off\"\n  Option \"ScrollMethod\" \"twofinger\"\n  Option \"HorizontalScrolling\" \"on\"\n  Option \"SendEventsMode\" \"enabled\"\n  Option \"Tapping\" \"on\"\n  Option \"TappingDragLock\" \"on\"\n  Option \"DisableWhileTyping\" \"off\"\nEndSection\n\nSection \"ServerLayout\"\n  Identifier \"Layout[all]\"\n  Inactive \"Device-amdgpu[0]\"\n\n  # Reference the Screen sections for each driver.  This will\n  # cause the X server to try each in turn.\n  Screen \"Screen-nvidia[0]\"\n  Screen \"Screen-amdgpu[0]\"\nEndSection\n\n# For each supported driver, add a \"Device\" and \"Screen\"\n# section.\nSection \"Device\"\n  Identifier \"Device-nvidia[0]\"\n  Driver \"nvidia\"\n  BusID \"PCI:1:0:0\"\nEndSection\n\nSection \"Screen\"\n  Identifier \"Screen-nvidia[0]\"\n  Device \"Device-nvidia[0]\"\n  Option \"RandRRotation\" \"on\"\n  Option \"AllowEmptyInitialConfiguration\"\nEndSection\n\nSection \"Screen\"\n  Identifier \"Screen-amdgpu[0]\"\n  Device \"Device-amdgpu[0]\"\nEndSection\n\n\nSection \"Device\"\n  Identifier \"Device-amdgpu[0]\"\n  Driver \"amdgpu\"\n  BusID \"PCI:5:0:0\"\nEndSection\n"}]]}],"</details>\n",["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","29",{"children":"I"}],["$","span","30",{"children":"’"}],["$","span","31",{"children":"m on nixpkgs unstable with the latest kernel. The thing I noticed trying to"}],"\r\n",["$","span","33",{"children":"fix the crash were:"}]]}],["$","ul",null,{"className":"mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc","children":[["$","li","48",{"className":"mb-2","children":[["$","span","37",{"children":"You need both the "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"amdgpu"}],["$","span","39",{"children":" and "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"nvidia"}],["$","span","41",{"children":" video driver, or the explicit"}],"\r\n",["$","span","43",{"children":"dependencies. ("}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"xf86videoamdgpu"}],["$","span","45",{"children":","}],["$","span","46",{"children":"…"}],["$","span","47",{"children":")"}]]}],["$","li","60",{"className":"mb-2","children":[["$","span","50",{"children":"The order in which you declare and the drivers and the "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"Screen"}],["$","span","52",{"children":"/"}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"Device"}],"\r\n",["$","span","55",{"children":"sections are not the same. The "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"amdgpu"}],["$","span","57",{"children":" will always be the first, resulting"}],"\r\n",["$","span","59",{"children":"in errors."}]]}],["$","li","65",{"className":"mb-2","children":[["$","span","62",{"children":"The NVIDIA Screen must be the first with sync enabled. I would guess it"}],"\r\n",["$","span","64",{"children":"should be the other way around for Reverse Prime."}]]}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","68",{"children":"I"}],["$","span","69",{"children":"’"}],["$","span","70",{"children":"m not sure whether this is the cause of the crash, but I think the problem"}],"\r\n",["$","span","72",{"children":"lies in how the dependencies and the final "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"xorg.conf"}],["$","span","74",{"children":" is generated."}]]}],"<!-- Morning -->\n","<!-- What do I want to do today? -->\n","<!-- Evening -->\n","<!-- What did I learn today? -->\n","<!-- Things I learned -->\n","<!-- Useful tools and libraries -->\n"]}]
