<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="icon" type="image/png" href="/favicon.png"/><link rel="icon" type="image/x-icon" href="/favicon.ico"/><title>/dev/blog - Jouranl 2022-07-02</title><meta name="description" content="Developer blog"/><meta name="next-head-count" content="7"/><script id="dark-theme" data-nscript="beforeInteractive">if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}</script><link rel="preload" href="/_next/static/css/5fc30b497c9bed6d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5fc30b497c9bed6d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/2a1840b1c557e13c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2a1840b1c557e13c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2751f6424e24f776.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-f11614d8aa7ee555.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4751e1abc30929ff.js" defer=""></script><script src="/_next/static/chunks/424-7590959e48df0588.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bpath%5D-7f6d1ab20249e46f.js" defer=""></script><script src="/_next/static/C-waYn5KflRK_a3FE3DO6/_buildManifest.js" defer=""></script><script src="/_next/static/C-waYn5KflRK_a3FE3DO6/_ssgManifest.js" defer=""></script></head><body class="bg-primary-50 dark:bg-primary-900"><div id="__next"><header class="flex flex-row items-baseline justify-between gap-4 p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><nav class="flex flex-grow flex-row flex-wrap gap-y-4"><a title="Home page" class="mr-8" href="/"><h1 class=" text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl">/dev/blog</h1></a><ul class="flex flex-grow flex-row items-end justify-start gap-8"><li><a title="Posts" href="/posts"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50  font-bold">Posts</span></a></li><li><a title="Notes" href="/notes"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50 underline font-bold">Notes</span></a></li></ul></nav><div><button class="rounded border-t-2 border-l-2 border-r-4 border-b-4  border-primary-900 px-4 py-2 text-sm font-medium text-primary-900  hover:bg-primary-100 active:translate-y-0.5 dark:border-primary-50 dark:text-primary-50 dark:hover:bg-primary-800 "><span class="text-sm sm:text-base xl:text-lg text-primary-900 dark:text-primary-50 font-semibold">Auto</span></button></div></header><main class="flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><article class="flex max-w-full grow flex-col justify-self-start"><h1 class="mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl"><span>Journal 2022-07-02</span></h1><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Hi, I</span><span>â€™</span><span>ve been following the topic for a while, trying to fix the crash on with</span>
<span>sync (not reverse prime). I managed to make it work with the following config:</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Video config </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">configuration.nix </code></p>&lt;details title=&quot;video-configuration.nix&quot;&gt;
<pre class="language-nix mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>{ config
, pkgs
, lib
, ...
}: {
  config = {
    services.xserver.exportConfiguration = true;

    services.xserver.videoDrivers = [
      # &quot;modesetting&quot;
      # &quot;fbdev&quot;
      &quot;amdgpu&quot;
      &quot;nvidia&quot;
    ];

    hardware.opengl = {
      enable = true;

      extraPackages = with pkgs; [
        rocm-opencl-icd
        rocm-opencl-runtime
        amdvlk
        vaapiVdpau
      ];

      driSupport = true;
    };


    hardware.nvidia = {
      #powerManagement = {
      #  enable = true;
      #  finegrained = true;
      #};

      nvidiaPersistenced = true;

      modesetting.enable = true;

      prime = {
        #offload.enable = true;
        sync.enable = true;

        amdgpuBusId = &quot;PCI:5:0:0&quot;;
        nvidiaBusId = &quot;PCI:1:0:0&quot;;
      };
    };

    environment.etc.&quot;X11/xorg.conf.d/10-amdgpu.conf&quot;.text = &#x27;&#x27;
      Section &quot;OutputClass&quot;
          Identifier &quot;AMDgpu&quot;
          MatchDriver &quot;amdgpu&quot;
          Driver &quot;amdgpu&quot;
      EndSection
    &#x27;&#x27;;

    environment.etc.&quot;X11/xorg.conf.d/10-radeon.conf&quot;.text = &#x27;&#x27;
      Section &quot;OutputClass&quot;
          Identifier &quot;Radeon&quot;
          MatchDriver &quot;radeon&quot;
          Driver &quot;radeon&quot;
      EndSection
    &#x27;&#x27;;

    environment.etc.&quot;X11/xorg.conf.d/10-nvidia.conf&quot;.text = &#x27;&#x27;
      Section &quot;OutputClass&quot;
          Identifier &quot;nvidia&quot;
          MatchDriver &quot;nvidia-drm&quot;
          Driver &quot;nvidia&quot;
          Option &quot;AllowEmptyInitialConfiguration&quot;
          Option &quot;SLI&quot; &quot;Auto&quot;
          Option &quot;BaseMosaic&quot; &quot;on&quot;
      EndSection

      Section &quot;ServerLayout&quot;
          Identifier &quot;layout&quot;
          Option &quot;AllowNVIDIAGPUScreens&quot;
      EndSection
    &#x27;&#x27;;

    services.xserver.config = lib.mkForce &#x27;&#x27;
      Section &quot;ServerFlags&quot;
        Option &quot;AllowMouseOpenFail&quot; &quot;on&quot;
        Option &quot;DontZap&quot; &quot;on&quot;
      EndSection

      Section &quot;Module&quot;
      EndSection

      Section &quot;Monitor&quot;
        Identifier &quot;Monitor[0]&quot;
      EndSection

      # Additional &quot;InputClass&quot; sections
      Section &quot;InputClass&quot;
        Identifier &quot;libinput mouse configuration&quot;
        MatchDriver &quot;libinput&quot;
        MatchIsPointer &quot;on&quot;
        Option &quot;AccelProfile&quot; &quot;adaptive&quot;
        Option &quot;LeftHanded&quot; &quot;off&quot;
        Option &quot;MiddleEmulation&quot; &quot;on&quot;
        Option &quot;NaturalScrolling&quot; &quot;off&quot;
        Option &quot;ScrollMethod&quot; &quot;twofinger&quot;
        Option &quot;HorizontalScrolling&quot; &quot;on&quot;
        Option &quot;SendEventsMode&quot; &quot;enabled&quot;
        Option &quot;Tapping&quot; &quot;on&quot;
        Option &quot;TappingDragLock&quot; &quot;on&quot;
        Option &quot;DisableWhileTyping&quot; &quot;off&quot;
      EndSection

      Section &quot;InputClass&quot;
        Identifier &quot;libinput touchpad configuration&quot;
        MatchDriver &quot;libinput&quot;
        MatchIsTouchpad &quot;on&quot;
        Option &quot;AccelProfile&quot; &quot;adaptive&quot;
        Option &quot;LeftHanded&quot; &quot;off&quot;
        Option &quot;MiddleEmulation&quot; &quot;on&quot;
        Option &quot;NaturalScrolling&quot; &quot;off&quot;
        Option &quot;ScrollMethod&quot; &quot;twofinger&quot;
        Option &quot;HorizontalScrolling&quot; &quot;on&quot;
        Option &quot;SendEventsMode&quot; &quot;enabled&quot;
        Option &quot;Tapping&quot; &quot;on&quot;
        Option &quot;TappingDragLock&quot; &quot;on&quot;
        Option &quot;DisableWhileTyping&quot; &quot;off&quot;
      EndSection

      Section &quot;ServerLayout&quot;
        Identifier &quot;Layout[all]&quot;
        Inactive &quot;Device-amdgpu[0]&quot;

        # Reference the Screen sections for each driver.  This will
        # cause the X server to try each in turn.
        Screen &quot;Screen-nvidia[0]&quot;
        Screen &quot;Screen-amdgpu[0]&quot;
      EndSection

      # For each supported driver, add a &quot;Device&quot; and &quot;Screen&quot;
      # section.
      Section &quot;Device&quot;
        Identifier &quot;Device-nvidia[0]&quot;
        Driver &quot;nvidia&quot;
        BusID &quot;PCI:1:0:0&quot;
      EndSection

      Section &quot;Screen&quot;
        Identifier &quot;Screen-nvidia[0]&quot;
        Device &quot;Device-nvidia[0]&quot;
        Option &quot;RandRRotation&quot; &quot;on&quot;
        Option &quot;AllowEmptyInitialConfiguration&quot;
      EndSection

      Section &quot;Screen&quot;
        Identifier &quot;Screen-amdgpu[0]&quot;
        Device &quot;Device-amdgpu[0]&quot;
      EndSection


      Section &quot;Device&quot;
        Identifier &quot;Device-amdgpu[0]&quot;
        Driver &quot;amdgpu&quot;
        BusID &quot;PCI:5:0:0&quot;
      EndSection
    &#x27;&#x27;;

    services.xserver.displayManager.gdm.wayland = false;

  };
}
</span></code></pre>&lt;/details&gt;
<p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Exported </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">xorg.conf</code></p>&lt;details title=&quot;xorg.conf&quot;&gt;
<pre class="language-xf86conf mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>Section &quot;Files&quot;

  FontPath &quot;/nix/store/qydzz8v6nl5n88aabc2glrayy3wd867q-unifont-14.0.04/share/fonts&quot;
  FontPath &quot;/nix/store/23bir9f496d3q7z7r11l0139afm58ln3-font-cursor-misc-1.0.3/lib/X11/fonts/misc&quot;
  FontPath &quot;/nix/store/zxg8rdv42bqs5rz4p7wwsdq9dlnp8qdp-font-misc-misc-1.1.2/lib/X11/fonts/misc&quot;
  FontPath &quot;/nix/store/srf487s27nqn8vxxyv9jw9sl9fqif6b0-font-adobe-100dpi-1.0.3/lib/X11/fonts/100dpi&quot;
  FontPath &quot;/nix/store/jsysicgm3ifrjzgvpwby4v9vsph3wkm8-font-adobe-75dpi-1.0.3/lib/X11/fonts/75dpi&quot;
  ModulePath &quot;/nix/store/bji361pzh9knqbs182g0jgm22nw9wkgh-xf86-video-amdgpu-21.0.0/lib/xorg/modules/drivers&quot;
  ModulePath &quot;/nix/store/bji361pzh9knqbs182g0jgm22nw9wkgh-xf86-video-amdgpu-21.0.0/lib/xorg/modules/drivers&quot;
  ModulePath &quot;/nix/store/ib2y8r7s6xj408zgg9nsplcqsvpyykk9-nvidia-x11-515.48.07-5.18.6-bin/lib/xorg/modules/drivers&quot;
  ModulePath &quot;/nix/store/ib2y8r7s6xj408zgg9nsplcqsvpyykk9-nvidia-x11-515.48.07-5.18.6-bin/lib/xorg/modules/extensions&quot;
  ModulePath &quot;/nix/store/mjn47cwnwgy49zlcq7kv66smsy7r6ghv-xorg-server-1.20.14/lib/xorg/modules&quot;
  ModulePath &quot;/nix/store/mjn47cwnwgy49zlcq7kv66smsy7r6ghv-xorg-server-1.20.14/lib/xorg/modules/drivers&quot;
  ModulePath &quot;/nix/store/mjn47cwnwgy49zlcq7kv66smsy7r6ghv-xorg-server-1.20.14/lib/xorg/modules/extensions&quot;
  ModulePath &quot;/nix/store/mrpw1zy65avf761yydyl5v2ya1247rs8-xf86-input-evdev-2.10.6/lib/xorg/modules/input&quot;
  ModulePath &quot;/nix/store/cgrphl8qib783yp1g3xifsqv8bvksgsw-xf86-input-libinput-1.2.0/lib/xorg/modules/input&quot;
FontPath &quot;/nix/store/f741iiyrs9dj9rf5nzx0r33gfic0jd1f-X11-fonts/share/X11/fonts&quot;

EndSection

Section &quot;ServerFlags&quot;
  Option &quot;AllowMouseOpenFail&quot; &quot;on&quot;
  Option &quot;DontZap&quot; &quot;on&quot;
EndSection

Section &quot;Module&quot;
EndSection

Section &quot;Monitor&quot;
  Identifier &quot;Monitor[0]&quot;
EndSection

# Additional &quot;InputClass&quot; sections
Section &quot;InputClass&quot;
  Identifier &quot;libinput mouse configuration&quot;
  MatchDriver &quot;libinput&quot;
  MatchIsPointer &quot;on&quot;
  Option &quot;AccelProfile&quot; &quot;adaptive&quot;
  Option &quot;LeftHanded&quot; &quot;off&quot;
  Option &quot;MiddleEmulation&quot; &quot;on&quot;
  Option &quot;NaturalScrolling&quot; &quot;off&quot;
  Option &quot;ScrollMethod&quot; &quot;twofinger&quot;
  Option &quot;HorizontalScrolling&quot; &quot;on&quot;
  Option &quot;SendEventsMode&quot; &quot;enabled&quot;
  Option &quot;Tapping&quot; &quot;on&quot;
  Option &quot;TappingDragLock&quot; &quot;on&quot;
  Option &quot;DisableWhileTyping&quot; &quot;off&quot;
EndSection

Section &quot;InputClass&quot;
  Identifier &quot;libinput touchpad configuration&quot;
  MatchDriver &quot;libinput&quot;
  MatchIsTouchpad &quot;on&quot;
  Option &quot;AccelProfile&quot; &quot;adaptive&quot;
  Option &quot;LeftHanded&quot; &quot;off&quot;
  Option &quot;MiddleEmulation&quot; &quot;on&quot;
  Option &quot;NaturalScrolling&quot; &quot;off&quot;
  Option &quot;ScrollMethod&quot; &quot;twofinger&quot;
  Option &quot;HorizontalScrolling&quot; &quot;on&quot;
  Option &quot;SendEventsMode&quot; &quot;enabled&quot;
  Option &quot;Tapping&quot; &quot;on&quot;
  Option &quot;TappingDragLock&quot; &quot;on&quot;
  Option &quot;DisableWhileTyping&quot; &quot;off&quot;
EndSection

Section &quot;ServerLayout&quot;
  Identifier &quot;Layout[all]&quot;
  Inactive &quot;Device-amdgpu[0]&quot;

  # Reference the Screen sections for each driver.  This will
  # cause the X server to try each in turn.
  Screen &quot;Screen-nvidia[0]&quot;
  Screen &quot;Screen-amdgpu[0]&quot;
EndSection

# For each supported driver, add a &quot;Device&quot; and &quot;Screen&quot;
# section.
Section &quot;Device&quot;
  Identifier &quot;Device-nvidia[0]&quot;
  Driver &quot;nvidia&quot;
  BusID &quot;PCI:1:0:0&quot;
EndSection

Section &quot;Screen&quot;
  Identifier &quot;Screen-nvidia[0]&quot;
  Device &quot;Device-nvidia[0]&quot;
  Option &quot;RandRRotation&quot; &quot;on&quot;
  Option &quot;AllowEmptyInitialConfiguration&quot;
EndSection

Section &quot;Screen&quot;
  Identifier &quot;Screen-amdgpu[0]&quot;
  Device &quot;Device-amdgpu[0]&quot;
EndSection


Section &quot;Device&quot;
  Identifier &quot;Device-amdgpu[0]&quot;
  Driver &quot;amdgpu&quot;
  BusID &quot;PCI:5:0:0&quot;
EndSection
</span></code></pre>&lt;/details&gt;
<p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>I</span><span>â€™</span><span>m on nixpkgs unstable with the latest kernel. The thing I noticed trying to</span>
<span>fix the crash were:</span></p><ul class="mb-4 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc"><li class="mb-2"><span>You need both the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">amdgpu</code><span> and </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">nvidia</code><span> video driver, or the explicit</span>
<span>dependencies. (</span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">xf86videoamdgpu</code><span>,</span><span>â€¦</span><span>)</span></li><li class="mb-2"><span>The order in which you declare and the drivers and the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">Screen</code><span>/</span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">Device</code>
<span>sections are not the same. The </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">amdgpu</code><span> will always be the first, resulting</span>
<span>in errors.</span></li><li class="mb-2"><span>The NVIDIA Screen must be the first with sync enabled. I would guess it</span>
<span>should be the other way around for Reverse Prime.</span></li></ul><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>I</span><span>â€™</span><span>m not sure whether this is the cause of the crash, but I think the problem</span>
<span>lies in how the dependencies and the final </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">xorg.conf</code><span> is generated.</span></p>&lt;!-- Morning --&gt;
<!-- -->&lt;!-- What do I want to do today? --&gt;
<!-- -->&lt;!-- Evening --&gt;
<!-- -->&lt;!-- What did I learn today? --&gt;
<!-- -->&lt;!-- Things I learned --&gt;
<!-- -->&lt;!-- Useful tools and libraries --&gt;
</article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"title":"Jouranl 2022-07-02","description":null,"tags":["journal"],"date":"2022-07-02","draft":false,"language":"en","content":[{"Start":{"Heading":["H1",null,[]]}},{"Text":"Journal 2022-07-02"},{"End":{"Heading":["H1",null,[]]}},{"Start":"Paragraph"},{"Text":"Hi, I"},{"Text":"â€™"},{"Text":"ve been following the topic for a while, trying to fix the crash on with"},"SoftBreak",{"Text":"sync (not reverse prime). I managed to make it work with the following config:"},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Video config "},{"Code":"configuration.nix "},{"End":"Paragraph"},{"Html":"\u003cdetails title=\"video-configuration.nix\"\u003e\n"},{"Start":{"CodeBlock":{"Fenced":"nix"}}},{"Text":"{ config\n, pkgs\n, lib\n, ...\n}: {\n  config = {\n    services.xserver.exportConfiguration = true;\n\n    services.xserver.videoDrivers = [\n      # \"modesetting\"\n      # \"fbdev\"\n      \"amdgpu\"\n      \"nvidia\"\n    ];\n\n    hardware.opengl = {\n      enable = true;\n\n      extraPackages = with pkgs; [\n        rocm-opencl-icd\n        rocm-opencl-runtime\n        amdvlk\n        vaapiVdpau\n      ];\n\n      driSupport = true;\n    };\n\n\n    hardware.nvidia = {\n      #powerManagement = {\n      #  enable = true;\n      #  finegrained = true;\n      #};\n\n      nvidiaPersistenced = true;\n\n      modesetting.enable = true;\n\n      prime = {\n        #offload.enable = true;\n        sync.enable = true;\n\n        amdgpuBusId = \"PCI:5:0:0\";\n        nvidiaBusId = \"PCI:1:0:0\";\n      };\n    };\n\n    environment.etc.\"X11/xorg.conf.d/10-amdgpu.conf\".text = ''\n      Section \"OutputClass\"\n          Identifier \"AMDgpu\"\n          MatchDriver \"amdgpu\"\n          Driver \"amdgpu\"\n      EndSection\n    '';\n\n    environment.etc.\"X11/xorg.conf.d/10-radeon.conf\".text = ''\n      Section \"OutputClass\"\n          Identifier \"Radeon\"\n          MatchDriver \"radeon\"\n          Driver \"radeon\"\n      EndSection\n    '';\n\n    environment.etc.\"X11/xorg.conf.d/10-nvidia.conf\".text = ''\n      Section \"OutputClass\"\n          Identifier \"nvidia\"\n          MatchDriver \"nvidia-drm\"\n          Driver \"nvidia\"\n          Option \"AllowEmptyInitialConfiguration\"\n          Option \"SLI\" \"Auto\"\n          Option \"BaseMosaic\" \"on\"\n      EndSection\n\n      Section \"ServerLayout\"\n          Identifier \"layout\"\n          Option \"AllowNVIDIAGPUScreens\"\n      EndSection\n    '';\n\n    services.xserver.config = lib.mkForce ''\n      Section \"ServerFlags\"\n        Option \"AllowMouseOpenFail\" \"on\"\n        Option \"DontZap\" \"on\"\n      EndSection\n\n      Section \"Module\"\n      EndSection\n\n      Section \"Monitor\"\n        Identifier \"Monitor[0]\"\n      EndSection\n\n      # Additional \"InputClass\" sections\n      Section \"InputClass\"\n        Identifier \"libinput mouse configuration\"\n        MatchDriver \"libinput\"\n        MatchIsPointer \"on\"\n        Option \"AccelProfile\" \"adaptive\"\n        Option \"LeftHanded\" \"off\"\n        Option \"MiddleEmulation\" \"on\"\n        Option \"NaturalScrolling\" \"off\"\n        Option \"ScrollMethod\" \"twofinger\"\n        Option \"HorizontalScrolling\" \"on\"\n        Option \"SendEventsMode\" \"enabled\"\n        Option \"Tapping\" \"on\"\n        Option \"TappingDragLock\" \"on\"\n        Option \"DisableWhileTyping\" \"off\"\n      EndSection\n\n      Section \"InputClass\"\n        Identifier \"libinput touchpad configuration\"\n        MatchDriver \"libinput\"\n        MatchIsTouchpad \"on\"\n        Option \"AccelProfile\" \"adaptive\"\n        Option \"LeftHanded\" \"off\"\n        Option \"MiddleEmulation\" \"on\"\n        Option \"NaturalScrolling\" \"off\"\n        Option \"ScrollMethod\" \"twofinger\"\n        Option \"HorizontalScrolling\" \"on\"\n        Option \"SendEventsMode\" \"enabled\"\n        Option \"Tapping\" \"on\"\n        Option \"TappingDragLock\" \"on\"\n        Option \"DisableWhileTyping\" \"off\"\n      EndSection\n\n      Section \"ServerLayout\"\n        Identifier \"Layout[all]\"\n        Inactive \"Device-amdgpu[0]\"\n\n        # Reference the Screen sections for each driver.  This will\n        # cause the X server to try each in turn.\n        Screen \"Screen-nvidia[0]\"\n        Screen \"Screen-amdgpu[0]\"\n      EndSection\n\n      # For each supported driver, add a \"Device\" and \"Screen\"\n      # section.\n      Section \"Device\"\n        Identifier \"Device-nvidia[0]\"\n        Driver \"nvidia\"\n        BusID \"PCI:1:0:0\"\n      EndSection\n\n      Section \"Screen\"\n        Identifier \"Screen-nvidia[0]\"\n        Device \"Device-nvidia[0]\"\n        Option \"RandRRotation\" \"on\"\n        Option \"AllowEmptyInitialConfiguration\"\n      EndSection\n\n      Section \"Screen\"\n        Identifier \"Screen-amdgpu[0]\"\n        Device \"Device-amdgpu[0]\"\n      EndSection\n\n\n      Section \"Device\"\n        Identifier \"Device-amdgpu[0]\"\n        Driver \"amdgpu\"\n        BusID \"PCI:5:0:0\"\n      EndSection\n    '';\n\n    services.xserver.displayManager.gdm.wayland = false;\n\n  };\n}\n"},{"End":{"CodeBlock":{"Fenced":"nix"}}},{"Html":"\u003c/details\u003e\n"},{"Start":"Paragraph"},{"Text":"Exported "},{"Code":"xorg.conf"},{"End":"Paragraph"},{"Html":"\u003cdetails title=\"xorg.conf\"\u003e\n"},{"Start":{"CodeBlock":{"Fenced":"xf86conf"}}},{"Text":"Section \"Files\"\n\n  FontPath \"/nix/store/qydzz8v6nl5n88aabc2glrayy3wd867q-unifont-14.0.04/share/fonts\"\n  FontPath \"/nix/store/23bir9f496d3q7z7r11l0139afm58ln3-font-cursor-misc-1.0.3/lib/X11/fonts/misc\"\n  FontPath \"/nix/store/zxg8rdv42bqs5rz4p7wwsdq9dlnp8qdp-font-misc-misc-1.1.2/lib/X11/fonts/misc\"\n  FontPath \"/nix/store/srf487s27nqn8vxxyv9jw9sl9fqif6b0-font-adobe-100dpi-1.0.3/lib/X11/fonts/100dpi\"\n  FontPath \"/nix/store/jsysicgm3ifrjzgvpwby4v9vsph3wkm8-font-adobe-75dpi-1.0.3/lib/X11/fonts/75dpi\"\n  ModulePath \"/nix/store/bji361pzh9knqbs182g0jgm22nw9wkgh-xf86-video-amdgpu-21.0.0/lib/xorg/modules/drivers\"\n  ModulePath \"/nix/store/bji361pzh9knqbs182g0jgm22nw9wkgh-xf86-video-amdgpu-21.0.0/lib/xorg/modules/drivers\"\n  ModulePath \"/nix/store/ib2y8r7s6xj408zgg9nsplcqsvpyykk9-nvidia-x11-515.48.07-5.18.6-bin/lib/xorg/modules/drivers\"\n  ModulePath \"/nix/store/ib2y8r7s6xj408zgg9nsplcqsvpyykk9-nvidia-x11-515.48.07-5.18.6-bin/lib/xorg/modules/extensions\"\n  ModulePath \"/nix/store/mjn47cwnwgy49zlcq7kv66smsy7r6ghv-xorg-server-1.20.14/lib/xorg/modules\"\n  ModulePath \"/nix/store/mjn47cwnwgy49zlcq7kv66smsy7r6ghv-xorg-server-1.20.14/lib/xorg/modules/drivers\"\n  ModulePath \"/nix/store/mjn47cwnwgy49zlcq7kv66smsy7r6ghv-xorg-server-1.20.14/lib/xorg/modules/extensions\"\n  ModulePath \"/nix/store/mrpw1zy65avf761yydyl5v2ya1247rs8-xf86-input-evdev-2.10.6/lib/xorg/modules/input\"\n  ModulePath \"/nix/store/cgrphl8qib783yp1g3xifsqv8bvksgsw-xf86-input-libinput-1.2.0/lib/xorg/modules/input\"\nFontPath \"/nix/store/f741iiyrs9dj9rf5nzx0r33gfic0jd1f-X11-fonts/share/X11/fonts\"\n\nEndSection\n\nSection \"ServerFlags\"\n  Option \"AllowMouseOpenFail\" \"on\"\n  Option \"DontZap\" \"on\"\nEndSection\n\nSection \"Module\"\nEndSection\n\nSection \"Monitor\"\n  Identifier \"Monitor[0]\"\nEndSection\n\n# Additional \"InputClass\" sections\nSection \"InputClass\"\n  Identifier \"libinput mouse configuration\"\n  MatchDriver \"libinput\"\n  MatchIsPointer \"on\"\n  Option \"AccelProfile\" \"adaptive\"\n  Option \"LeftHanded\" \"off\"\n  Option \"MiddleEmulation\" \"on\"\n  Option \"NaturalScrolling\" \"off\"\n  Option \"ScrollMethod\" \"twofinger\"\n  Option \"HorizontalScrolling\" \"on\"\n  Option \"SendEventsMode\" \"enabled\"\n  Option \"Tapping\" \"on\"\n  Option \"TappingDragLock\" \"on\"\n  Option \"DisableWhileTyping\" \"off\"\nEndSection\n\nSection \"InputClass\"\n  Identifier \"libinput touchpad configuration\"\n  MatchDriver \"libinput\"\n  MatchIsTouchpad \"on\"\n  Option \"AccelProfile\" \"adaptive\"\n  Option \"LeftHanded\" \"off\"\n  Option \"MiddleEmulation\" \"on\"\n  Option \"NaturalScrolling\" \"off\"\n  Option \"ScrollMethod\" \"twofinger\"\n  Option \"HorizontalScrolling\" \"on\"\n  Option \"SendEventsMode\" \"enabled\"\n  Option \"Tapping\" \"on\"\n  Option \"TappingDragLock\" \"on\"\n  Option \"DisableWhileTyping\" \"off\"\nEndSection\n\nSection \"ServerLayout\"\n  Identifier \"Layout[all]\"\n  Inactive \"Device-amdgpu[0]\"\n\n  # Reference the Screen sections for each driver.  This will\n  # cause the X server to try each in turn.\n  Screen \"Screen-nvidia[0]\"\n  Screen \"Screen-amdgpu[0]\"\nEndSection\n\n# For each supported driver, add a \"Device\" and \"Screen\"\n# section.\nSection \"Device\"\n  Identifier \"Device-nvidia[0]\"\n  Driver \"nvidia\"\n  BusID \"PCI:1:0:0\"\nEndSection\n\nSection \"Screen\"\n  Identifier \"Screen-nvidia[0]\"\n  Device \"Device-nvidia[0]\"\n  Option \"RandRRotation\" \"on\"\n  Option \"AllowEmptyInitialConfiguration\"\nEndSection\n\nSection \"Screen\"\n  Identifier \"Screen-amdgpu[0]\"\n  Device \"Device-amdgpu[0]\"\nEndSection\n\n\nSection \"Device\"\n  Identifier \"Device-amdgpu[0]\"\n  Driver \"amdgpu\"\n  BusID \"PCI:5:0:0\"\nEndSection\n"},{"End":{"CodeBlock":{"Fenced":"xf86conf"}}},{"Html":"\u003c/details\u003e\n"},{"Start":"Paragraph"},{"Text":"I"},{"Text":"â€™"},{"Text":"m on nixpkgs unstable with the latest kernel. The thing I noticed trying to"},"SoftBreak",{"Text":"fix the crash were:"},{"End":"Paragraph"},{"Start":{"List":null}},{"Start":"Item"},{"Text":"You need both the "},{"Code":"amdgpu"},{"Text":" and "},{"Code":"nvidia"},{"Text":" video driver, or the explicit"},"SoftBreak",{"Text":"dependencies. ("},{"Code":"xf86videoamdgpu"},{"Text":","},{"Text":"â€¦"},{"Text":")"},{"End":"Item"},{"Start":"Item"},{"Text":"The order in which you declare and the drivers and the "},{"Code":"Screen"},{"Text":"/"},{"Code":"Device"},"SoftBreak",{"Text":"sections are not the same. The "},{"Code":"amdgpu"},{"Text":" will always be the first, resulting"},"SoftBreak",{"Text":"in errors."},{"End":"Item"},{"Start":"Item"},{"Text":"The NVIDIA Screen must be the first with sync enabled. I would guess it"},"SoftBreak",{"Text":"should be the other way around for Reverse Prime."},{"End":"Item"},{"End":{"List":null}},{"Start":"Paragraph"},{"Text":"I"},{"Text":"â€™"},{"Text":"m not sure whether this is the cause of the crash, but I think the problem"},"SoftBreak",{"Text":"lies in how the dependencies and the final "},{"Code":"xorg.conf"},{"Text":" is generated."},{"End":"Paragraph"},{"Html":"\u003c!-- Morning --\u003e\n"},{"Html":"\u003c!-- What do I want to do today? --\u003e\n"},{"Html":"\u003c!-- Evening --\u003e\n"},{"Html":"\u003c!-- What did I learn today? --\u003e\n"},{"Html":"\u003c!-- Things I learned --\u003e\n"},{"Html":"\u003c!-- Useful tools and libraries --\u003e\n"}]}},"__N_SSG":true},"page":"/notes/[path]","query":{"path":"2022-07-02"},"buildId":"C-waYn5KflRK_a3FE3DO6","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>