{"pageProps":{"path":"2023-02-28_goatcounter_analytics","article":{"title":"GoatCounter Analytics for NextJS","description":"GoatCounter Analytics is a privacy-friendly web analytics tool perfect for small websites like blogs. It is free and open source.","tags":["web","nextjs"],"date":"2023-02-28","draft":false,"language":"en","content":[{"Start":{"Heading":["H1",null,[]]}},{"Text":"GoatCounter Analytics for NextJS"},{"End":{"Heading":["H1",null,[]]}},{"Start":"Paragraph"},{"Text":"GoatCounter Analytics is a privacy-friendly web analytics tool perfect for"},"SoftBreak",{"Text":"small websites like blogs. It is free and open source, and it also has a self"},"SoftBreak",{"Text":"hosted option."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"I started using it in this blog, to see how a better understanding the traffic,"},"SoftBreak",{"Text":"while still being privacy-friendly. Before, I was using the panel provided by"},"SoftBreak",{"Text":"Cloudflare, which is also a good option. But it didn"},{"Text":"’"},{"Text":"t provide me with enough"},"SoftBreak",{"Text":"information like the number of page views per page or article or the"},"SoftBreak",{"Start":{"Link":["Inline","https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer",""]}},{"Text":"Referrer"},{"End":{"Link":["Inline","https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer",""]}},"SoftBreak",{"Text":"information."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Start":{"Image":["Inline","/images/2023-02-28/goatcounter.png",""]}},{"Text":"GoatCounter"},{"End":{"Image":["Inline","/images/2023-02-28/goatcounter.png",""]}},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Why Use GoatCounter Analytics?"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"Privacy is a growing concern on the web, and more and more users are becoming"},"SoftBreak",{"Text":"aware of the importance of protecting their online data. GoatCounter is a great"},"SoftBreak",{"Text":"solution for website owners who want to respect their users"},{"Text":"’"},{"Text":" privacy while"},"SoftBreak",{"Text":"still gathering useful data about their website traffic. It is a simple and"},"SoftBreak",{"Text":"lightweight tool that provides essential data like page views, referrer"},"SoftBreak",{"Text":"information, and more, without tracking any personal data or using cookies."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Getting Started with GoatCounter Analytics"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"To use GoatCounter Analytics, the first thing you need to do is to create an"},"SoftBreak",{"Text":"account on the GoatCounter website for your site. Once you have created an"},"SoftBreak",{"Text":"account, GoatCounter will provide you with a script tag that you need to add to"},"SoftBreak",{"Text":"your website."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"html"}}},{"Text":"<script\n  data-goatcounter=\"https://example.goatcounter.com/count\"\n  async\n  src=\"//gc.zgo.at/count.js\"\n></script>\n"},{"End":{"CodeBlock":{"Fenced":"html"}}},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Integrating GoatCounter with NextJS"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"To integrate GoatCounter with your NextJS website, you"},{"Text":"’"},{"Text":"ll need to add a script"},"SoftBreak",{"Text":"tag to your "},{"Code":"_app.tsx"},{"Text":" file, which will ensure that the script is loaded on"},"SoftBreak",{"Text":"every page. It"},{"Text":"’"},{"Text":"s essential to use the "},{"Code":"afterInteractive"},{"Text":" strategy to avoid"},"SoftBreak",{"Text":"impacting page load performance. Additionally, you"},{"Text":"’"},{"Text":"ll need to hook up with the"},"SoftBreak",{"Text":"router events to send page changes to GoatCounte."},{"End":"Paragraph"},{"Start":{"List":1}},{"Start":"Item"},{"Start":"Paragraph"},{"Text":"Add the GoatCounter script tag to your pages/"},{"Text":"_app.tsx file:"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"jsx"}}},{"Text":"// pages/_app.tsx\n"},{"Text":"function MyApp({ Component, pageProps }) {\n"},{"Text":"  return (\n"},{"Text":"    <>\n"},{"Text":"      <Script\n"},{"Text":"        strategy=\"afterInteractive\"\n"},{"Text":"        data-goatcounter={`https://${API}.goatcounter.com/count`}\n"},{"Text":"        src=\"//gc.zgo.at/count.js\"\n"},{"Text":"      ></Script>\n"},{"Text":"      <Component {...pageProps} />\n"},{"Text":"    </>\n"},{"Text":"  );\n"},{"Text":"}\n"},{"End":{"CodeBlock":{"Fenced":"jsx"}}},{"Start":"Paragraph"},{"Text":"Remember to put the script "},{"Start":"Strong"},{"Text":"outside"},{"End":"Strong"},{"Text":" the "},{"Code":"Header"},{"Text":" component, otherwise it"},"SoftBreak",{"Text":"won"},{"Text":"’"},{"Text":"t work and the script will not be loaded correctly."},{"End":"Paragraph"},{"End":"Item"},{"Start":"Item"},{"Start":"Paragraph"},{"Text":"The script will add a magic pixel on the first load, which will phone home"},"SoftBreak",{"Text":"to the GoatCounter server and registered the visit. But it won"},{"Text":"’"},{"Text":"t work for"},"SoftBreak",{"Text":"the rest of the of the page views since NextJS is a SPA. So we need to hook"},"SoftBreak",{"Text":"up to the router events to send the page views to GoatCounter."},{"End":"Paragraph"},{"End":"Item"},{"Start":"Item"},{"Start":"Paragraph"},{"Text":"Now you need to register a event listener to the router, so when the page"},"SoftBreak",{"Text":"changes we"},{"Text":"’"},{"Text":"ll send the information to the GoatCounter server. To do that,"},"SoftBreak",{"Text":"we"},{"Text":"’"},{"Text":"ll use the "},{"Code":"useRouter"},{"Text":":"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"jsx"}}},{"Text":"import { useEffect } from \"react\";\n"},{"Text":"import { useRouter } from \"next/router\";\n\n"},{"Text":"export default function MyApp({ Component, pageProps }) {\n"},{"Text":"  const router = useRouter();\n\n"},{"Text":"  useEffect(() => {\n"},{"Text":"    const handleRouteChange = (url) => {\n"},{"Text":"      window.goatcounter.count({\n"},{"Text":"        path: url,\n"},{"Text":"      });\n"},{"Text":"    };\n\n"},{"Text":"    router.events.on(\"routeChangeComplete\", handleRouteChange);\n\n"},{"Text":"    return () => {\n"},{"Text":"      router.events.off(\"routeChangeComplete\", handleRouteChange);\n"},{"Text":"    };\n"},{"Text":"  }, []);\n\n"},{"Text":"  return <Component {...pageProps} />;\n"},{"Text":"}\n"},{"End":{"CodeBlock":{"Fenced":"jsx"}}},{"Start":"Paragraph"},{"Text":"We use the "},{"Code":"useEffect"},{"Text":" to add the event listener only once, and we remove it"},"SoftBreak",{"Text":"when the component is unmounted."},{"End":"Paragraph"},{"End":"Item"},{"End":{"List":1}},{"Start":"Paragraph"},{"Text":"Now you can go to your GoatCounter dashboard and see the page views. You can"},"SoftBreak",{"Text":"also see the referrer information, which is very useful to see where your"},"SoftBreak",{"Text":"traffic is coming from."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Conclusion"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"GoatCounter is a privacy-friendly analytics tool that provides useful data"},"SoftBreak",{"Text":"about website traffic without tracking any personal data. By following the"},"SoftBreak",{"Text":"steps outlined in this article, you can integrate GoatCounter Analytics with"},"SoftBreak",{"Text":"your NextJS web application and start gathering useful data about your website"},"SoftBreak",{"Text":"traffic while respecting your users"},{"Text":"’"},{"Text":" privacy."},{"End":"Paragraph"}]}},"__N_SSG":true}