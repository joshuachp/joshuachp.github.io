{"pageProps":{"article":{"title":"ZSH configuration","description":"Fine tuning ZSH configuring after moving away form Oh-My-Zsh","tags":["shell","zsh"],"date":"2022-06-19","draft":false,"language":"en","content":[{"Start":{"Heading":["H1",null,[]]}},{"Text":"ZSH configuration"},{"End":{"Heading":["H1",null,[]]}},{"Start":"Paragraph"},{"Text":"I wanted to reconfigure the my zsh setup."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Before, I was using "},{"Start":{"Link":["Inline","https://ohmyz.sh/",""]}},{"Text":"Oh My ZSH"},{"End":{"Link":["Inline","https://ohmyz.sh/",""]}},{"Text":". Which is a wonderful"},"SoftBreak",{"Text":"configuration framework for "},{"Code":"zsh"},{"Text":"."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"The problem I had was not using the feature that it provided. I was only using"},"SoftBreak",{"Text":"the base configuration and two plugins: "},{"Code":"git"},{"Text":" and "},{"Code":"sudo"},{"Text":". Also, I didn"},{"Text":"â€™"},{"Text":"t use"},"SoftBreak",{"Text":"any theme since I prefer the "},{"Start":{"Link":["Inline","https://starship.rs/",""]}},{"Text":"starship"},{"End":{"Link":["Inline","https://starship.rs/",""]}},{"Text":" prompt."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"I wanted to strip down the configuration and remove this dependency. So I"},"SoftBreak",{"Text":"looked at the "},{"Code":"omz"},{"Text":" configurations and "},{"Code":"man zsh(1)"},{"Text":" to came up with the"},"SoftBreak",{"Text":"following configuration. Another source was the"},"SoftBreak",{"Start":{"Link":["Inline","https://github.com/sorin-ionescu/prezto/",""]}},{"Text":"prezto"},{"End":{"Link":["Inline","https://github.com/sorin-ionescu/prezto/",""]}},{"Text":" framework, that you could"},"SoftBreak",{"Text":"look at for an alternative to "},{"Code":"omz"},{"Text":"."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"sh"}}},{"Text":"# Return if not run interactively\n[[ $- != *i* ]] && return\n\n##\n# Env variables\n#\n# Cache directory\nZSH_CACHE_DIR=\"$XDG_CACHE_HOME/zsh\"\n# Specify comp dump direcory\nZSH_COMPDUMP=\"$ZSH_CACHE_DIR/zcompdump\"\n# FPath\n#export FPATH=\"$FPATH:$XDG_DATA_HOME/zsh\"\nfpath+=$XDG_DATA_HOME/zsh\n# List colors\nLS_COLORS=${LS_COLORS:-'di=34:ln=35:so=32:pi=33:ex=31:bd=36;01:cd=33;01:su=31;40;07:sg=36;40;07:tw=32;40;07:ow=33;40;07:'}\n\n# History\nHISTFILE=\"$ZSH_CACHE_DIR/zsh_history\"\nHISTSIZE=50000\nSAVEHIST=10000\n\nif [ ! -f \"$ZSH_CACHE_DIR\" ]; then\n    mkdir -p \"$ZSH_CACHE_DIR\"\nfi\n\n##\n# Zsh functions\n#\n# Remove default prompt\nautoload -U promptinit && promptinit && prompt off\n# Move with regex\nautoload -U zmv\n# Jump\nautoload -U j\n\n##\n# Zsh options\n#\n# Share history between shells\nsetopt share_history\n# Try to correct commands\nsetopt correct\n\n# History\nsetopt extended_history\nsetopt hist_expire_dups_first\nsetopt hist_verify\n\n##\n# Completion\n#\n# automatically load bash completion functions\n# autoload -U +X bashcompinit && bashcompinit -d \"$ZSH_COMPDUMP\"\n# Init completion\nautoload -U compinit && compinit -C -d \"$ZSH_COMPDUMP\"\n\nzmodload -i zsh/complist\n\n# show completion menu on successive tab press\nsetopt always_to_end\nsetopt auto_list\nsetopt auto_menu\nsetopt auto_param_slash\nsetopt complete_aliases\nsetopt complete_in_word\nsetopt extended_glob\nsetopt path_dirs\n# do not autoselect the first completion entry\nunsetopt menu_complete\nunsetopt flowcontrol\nunsetopt CASE_GLOB\n\n#\n# Styles\n#\n\n# Defaults.\nzstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}\nzstyle ':completion:*:default' list-prompt '%S%M matches%s'\n\nzstyle ':completion:*' special-dirs true\n\n# Use caching so that commands like apt and dpkg complete are useable\nzstyle ':completion::complete:*' use-cache on\nzstyle ':completion::complete:*' cache-path \"$ZSH_CACHE_DIR/completion\"\n\n# Case insensitive\nzstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'\n\n# Group matches and describe.\nzstyle ':completion:*:*:*:*:*' menu select\nzstyle ':completion:*:matches' group 'yes'\nzstyle ':completion:*:options' description 'yes'\nzstyle ':completion:*:options' auto-description '%d'\nzstyle ':completion:*:corrections' format ' %F{green}-- %d (errors: %e) --%f'\nzstyle ':completion:*:descriptions' format ' %F{yellow}-- %d --%f'\nzstyle ':completion:*:messages' format ' %F{purple} -- %d --%f'\nzstyle ':completion:*:warnings' format ' %F{red}-- no matches found --%f'\nzstyle ':completion:*' format ' %F{yellow}-- %d --%f'\nzstyle ':completion:*' group-name ''\nzstyle ':completion:*' verbose yes\n\n# Fuzzy match mistyped completions.\nzstyle ':completion:*' completer _complete _match _approximate\nzstyle ':completion:*:match:*' original only\nzstyle ':completion:*:approximate:*' max-errors 1 numeric\n\n# Increase the number of errors based on the length of the typed word. But make\n# sure to cap (at 7) the max-errors to avoid hanging.\nzstyle -e ':completion:*:approximate:*' max-errors 'reply=($((($#PREFIX+$#SUFFIX)/3>7?7:($#PREFIX+$#SUFFIX)/3))numeric)'\n\n# Don't complete unavailable commands.\nzstyle ':completion:*:functions' ignored-patterns '(_*|pre(cmd|exec))'\n\n# Array completion element sorting.\nzstyle ':completion:*:*:-subscript-:*' tag-order indexes parameters\n\n# Directories\nzstyle ':completion:*:*:cd:*' tag-order local-directories directory-stack path-directories\nzstyle ':completion:*:*:cd:*:directory-stack' menu yes select\nzstyle ':completion:*:-tilde-:*' group-order 'named-directories' 'path-directories' 'users' 'expand'\nzstyle ':completion:*' squeeze-slashes true\n\n# History\nzstyle ':completion:*:history-words' stop yes\nzstyle ':completion:*:history-words' remove-all-dups yes\nzstyle ':completion:*:history-words' list false\nzstyle ':completion:*:history-words' menu yes\n\n# Environment Variables\nzstyle ':completion::*:(-command-|export):*' fake-parameters ${${${_comps[(I)-value-*]#*,}%%,*}:#-*-}\n\n# Populate hostname completion. But allow ignoring custom entries from static\n# */etc/hosts* which might be uninteresting.\nzstyle -a ':prezto:module:completion:*:hosts' etc-host-ignores '_etc_host_ignores'\n\nzstyle -e ':completion:*:hosts' hosts 'reply=(\n  ${=${=${=${${(f)\"$(cat {/etc/ssh/ssh_,~/.ssh/}known_hosts(|2)(N) 2> /dev/null)\"}%%[#| ]*}//\\]:[0-9]*/ }//,/ }//\\[/ }\n  ${=${(f)\"$(cat /etc/hosts(|)(N) <<(ypcat hosts 2> /dev/null))\"}%%(\\#${_etc_host_ignores:+|${(j:|:)~_etc_host_ignores}})*}\n  ${=${${${${(@M)${(f)\"$(cat ~/.ssh/config 2> /dev/null)\"}:#Host *}#Host }:#*\\**}:#*\\?*}}\n)'\n\n# Don't complete uninteresting users...\nzstyle ':completion:*:*:*:users' ignored-patterns \\\n  adm amanda apache avahi beaglidx bin cacti canna clamav daemon \\\n  dbus distcache dovecot fax ftp games gdm gkrellmd gopher \\\n  hacluster haldaemon halt hsqldb ident junkbust ldap lp mail \\\n  mailman mailnull mldonkey mysql nagios \\\n  named netdump news nfsnobody nobody nscd ntp nut nx openvpn \\\n  operator pcap postfix postgres privoxy pulse pvm quagga radvd \\\n  rpc rpcuser rpm shutdown squid sshd sync uucp vcsa xfs '_*'\n\n# ... unless we really want to.\nzstyle '*' single-ignored show\n\n# Ignore multiple entries.\nzstyle ':completion:*:(rm|kill|diff):*' ignore-line other\nzstyle ':completion:*:rm:*' file-patterns '*:all-files'\n\n# Kill\nzstyle ':completion:*:*:*:*:processes' command 'ps -u $LOGNAME -o pid,user,command -w'\nzstyle ':completion:*:*:kill:*:processes' list-colors '=(#b) #([0-9]#) ([0-9a-z-]#)*=01;36=0=01'\nzstyle ':completion:*:*:kill:*' menu yes select\nzstyle ':completion:*:*:kill:*' force-list always\nzstyle ':completion:*:*:kill:*' insert-ids single\n\n# Man\nzstyle ':completion:*:manuals' separate-sections true\nzstyle ':completion:*:manuals.(^1*)' insert-sections true\n\n# Media Players\nzstyle ':completion:*:*:mpg123:*' file-patterns '*.(mp3|MP3):mp3\\ files *(-/):directories'\nzstyle ':completion:*:*:mpg321:*' file-patterns '*.(mp3|MP3):mp3\\ files *(-/):directories'\nzstyle ':completion:*:*:ogg123:*' file-patterns '*.(ogg|OGG|flac):ogg\\ files *(-/):directories'\nzstyle ':completion:*:*:mocp:*' file-patterns '*.(wav|WAV|mp3|MP3|ogg|OGG|flac):ogg\\ files *(-/):directories'\n\n# Mutt\nif [[ -s \"$HOME/.mutt/aliases\" ]]; then\n  zstyle ':completion:*:*:mutt:*' menu yes select\n  zstyle ':completion:*:mutt:*' users ${${${(f)\"$(<\"$HOME/.mutt/aliases\")\"}#alias[[:space:]]}%%[[:space:]]*}\nfi\n\n# SSH/SCP/RSYNC\nzstyle ':completion:*:(ssh|scp|rsync):*' tag-order 'hosts:-host:host hosts:-domain:domain hosts:-ipaddr:ip\\ address *'\nzstyle ':completion:*:(scp|rsync):*' group-order users files all-files hosts-domain hosts-host hosts-ipaddr\nzstyle ':completion:*:ssh:*' group-order users hosts-domain hosts-host users hosts-ipaddr\nzstyle ':completion:*:(ssh|scp|rsync):*:hosts-host' ignored-patterns '*(.|:)*' loopback ip6-loopback localhost ip6-localhost broadcasthost\nzstyle ':completion:*:(ssh|scp|rsync):*:hosts-domain' ignored-patterns '<->.<->.<->.<->' '^[-[:alnum:]]##(.[-[:alnum:]]##)##' '*@*'\nzstyle ':completion:*:(ssh|scp|rsync):*:hosts-ipaddr' ignored-patterns '^(<->.<->.<->.<->|(|::)([[:xdigit:].]##:(#c,2))##(|%*))' '127.0.0.<->' '255.255.255.255' '::1' 'fe80::*'\n\n\n##\n# Keymaps\n#\n# Use vim keybindings\nbindkey -v\n\nautoload -Uz edit-command-line\nzle -N edit-command-line\nbindkey -M vicmd 'vv' edit-command-line\n\n# #\n# Autosuggestion\nZSH_AUTOSUGGEST='/usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh'\nif [[ -f $ZSH_AUTOSUGGEST ]]; then\n    source $ZSH_AUTOSUGGEST\nfi\nZSH_AUTOSUGGEST_HIGHLIGHT_STYLE=\"fg=white,underline\"\n\n##\n# Syntax Highlighting\n#\nZSH_HIGHLIGHT='/usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh'\nif [[ -f $ZSH_HIGHLIGHT ]]; then\n    source $ZSH_HIGHLIGHT\n\n    ZSH_HIGHLIGHT_HIGHLIGHTERS=(main brackets)\n    # main\n    ZSH_HIGHLIGHT_STYLES[unknown-token]='fg=red'\n    ZSH_HIGHLIGHT_STYLES[comment]='fg=white,bg=black'\n    ZSH_HIGHLIGHT_STYLES[path]='fg=magenta'\n    ZSH_HIGHLIGHT_STYLES[path_pathseparator]='fg=magenta,bold'\n    ZSH_HIGHLIGHT_STYLES[single-hyphen-option]='fg=yellow'\n    ZSH_HIGHLIGHT_STYLES[double-hyphen-option]='fg=yellow'\n    ZSH_HIGHLIGHT_STYLES[commandseparator]='fg=cyan'\n    # Brackets\n    ZSH_HIGHLIGHT_STYLES[bracket-error]='fg=red'\n    ZSH_HIGHLIGHT_STYLES[bracket-level-1]='fg=blue'\n    ZSH_HIGHLIGHT_STYLES[bracket-level-2]='fg=green'\n    ZSH_HIGHLIGHT_STYLES[bracket-level-3]='fg=magenta'\n    ZSH_HIGHLIGHT_STYLES[bracket-level-4]='fg=yellow'\n    ZSH_HIGHLIGHT_STYLES[bracket-level-5]='fg=cyan'\nfi\n\n##\n# Aliases\n#\nsource $HOME/.aliasrc\neval \"$(direnv hook zsh)\"\n\n##\n# Starship\n#\neval \"$(starship init zsh)\"\n"},{"End":{"CodeBlock":{"Fenced":"sh"}}},{"Start":"Paragraph"},{"Text":"Exploring the "},{"Code":"zsh"},{"Text":" options let me fine tune the configuration for my needs,"},"SoftBreak",{"Text":"without the overhead required by a framework to satisfy all different needs."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Other resources:"},{"End":"Paragraph"},{"Start":{"List":null}},{"Start":"Item"},{"Start":{"Link":["Inline","http://www.bash2zsh.com/zsh_refcard/refcard.pdf",""]}},{"Text":"zsh refcard"},{"End":{"Link":["Inline","http://www.bash2zsh.com/zsh_refcard/refcard.pdf",""]}},{"End":"Item"},{"Start":"Item"},{"Start":{"Link":["Inline","https://grml.org/zsh/zsh-lovers.html",""]}},{"Text":"zsh lovers"},{"End":{"Link":["Inline","https://grml.org/zsh/zsh-lovers.html",""]}},{"End":"Item"},{"End":{"List":null}}]}},"__N_SSG":true}