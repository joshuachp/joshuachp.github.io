{"pageProps":{"article":{"title":"CyberChallengeIT CTF - Group Challenge","tags":["CTF","CCCIT"],"date":"2020-01-06","description":"An easy and guided CTF Challenge with writeup created for the 2020 CyberChallenge Italy.","language":null,"content":[{"Start":{"Heading":["H1",null,[]]}},{"Text":"CyberChallengeIT CTF - Group Challenge"},{"End":{"Heading":["H1",null,[]]}},{"Start":"Paragraph"},{"Text":"During the last week of preparation for che Cyber Challenge IT CTF, we were"},"SoftBreak",{"Text":"asked to do a CTF challenge our self. We were divided in groups and given a"},"SoftBreak",{"Text":"month to come up with a challenge."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Our group create an easy and guided challenge, since we were required to solve"},"SoftBreak",{"Text":"it in one hour. It will cover some basic aspect of all the kind of challenges"},"SoftBreak",{"Text":"types like Web Security, Reversing, Forensics, Cryptography."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"If you want to try the challenge yourself you will start by downloading this"},"SoftBreak",{"Text":"zip file:"},{"End":"Paragraph"},{"Start":"Paragraph"},{"Start":{"Link":["Inline","/CTF/CCIT_challenge/challenge_gruppo_1.zip",""]}},{"Text":"challenge_gruppo_1.zip"},{"End":{"Link":["Inline","/CTF/CCIT_challenge/challenge_gruppo_1.zip",""]}},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Thank you to all the tutors and the other group members which made all the"},"SoftBreak",{"Text":"different parts of this challenge."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"The source code for creating the challenge:"},"SoftBreak",{"Start":{"Link":["Inline","https://github.com/joshuachp/CTF_CyberChallengeIT_2020",""]}},{"Text":"CTF_CyberChallenge"},{"End":{"Link":["Inline","https://github.com/joshuachp/CTF_CyberChallengeIT_2020",""]}},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Writeup"},{"End":{"Heading":["H2",null,[]]}},{"Start":"BlockQuote"},{"Start":"Paragraph"},{"Text":"The challenge was Italy so the writeup is in Italian"},{"End":"Paragraph"},{"End":"BlockQuote"},{"Start":{"Heading":["H3",null,[]]}},{"Text":"Start"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"La challenge inizia con uno zip."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"unzip challenge_gruppo_1.zip\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"All"},{"Text":"’"},{"Text":"interno dello zip troviamo diversi file:"},{"End":"Paragraph"},{"Start":{"List":null}},{"Start":"Item"},{"Start":"Paragraph"},{"Start":"Strong"},{"Text":"get_flag.py"},{"End":"Strong"},{"Text":" : script python che una volta fornita la password corretta"},"SoftBreak",{"Text":"stampa la flag"},{"End":"Paragraph"},{"End":"Item"},{"Start":"Item"},{"Start":"Paragraph"},{"Start":"Strong"},{"Text":"start"},{"End":"Strong"},{"Text":" : eseguibile per l"},{"Text":"’"},{"Text":"inizio della challenge"},{"End":"Paragraph"},{"End":"Item"},{"Start":"Item"},{"Start":"Paragraph"},{"Start":"Strong"},{"Text":"stage1.txt"},{"End":"Strong"},{"Text":" : file di benvenuto"},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Osserviamo lo start fare cose (LOL). Alla fine ci indirizza ad un"},"SoftBreak",{"Start":{"Link":["Inline","https://joshuachp.github.io/CTF/CCIT_challenge/",""]}},{"Text":"sito web"},{"End":{"Link":["Inline","https://joshuachp.github.io/CTF/CCIT_challenge/",""]}},{"Text":"."},{"End":"Paragraph"},{"End":"Item"},{"End":{"List":null}},{"Start":{"Heading":["H3",null,[]]}},{"Text":"Sito"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"Accediamo al sito e troviamo che il campo username è vulnerabile a SQLI ber il"},"SoftBreak",{"Text":"bypass dell"},{"Text":"’"},{"Text":"autenticazione."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"sql"}}},{"Text":"admin' --\n"},{"End":{"CodeBlock":{"Fenced":"sql"}}},{"Start":"Paragraph"},{"Text":"Questo ci permette di scaricare un file "},{"Code":"disk"},{"Text":"."},{"End":"Paragraph"},{"Start":"BlockQuote"},{"Start":"Paragraph"},{"Text":"Il sito non utilizza un database in quanto è una pagina statica. Anche lo se"},"SoftBreak",{"Text":"lo script è minified, con un po"},{"Text":"’"},{"Text":" di reversing si può benissimo trovare la"},"SoftBreak",{"Text":"funzione del download, però non è pratico in quanto per questioni di tempo la"},"SoftBreak",{"Text":"query è molto semplice."},{"End":"Paragraph"},{"End":"BlockQuote"},{"Start":{"Heading":["H4",null,[]]}},{"Text":"Hint 1"},{"End":{"Heading":["H4",null,[]]}},{"Start":"Paragraph"},{"Text":"Nel source del sito possiamo trovare un commento suggerisce di utilizzare SQL"},"SoftBreak",{"Text":"Injection."},{"End":"Paragraph"},{"Start":{"Heading":["H3",null,[]]}},{"Text":"Disk"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"Utilizzando il comando "},{"Code":"file"},{"Text":" su disk possiamo vedere:"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"disk: Linux rev 1.0 ext2 filesystem data, ...\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Essendo un file-system procediamo quindi a creare una cartella dove eseguire il"},"SoftBreak",{"Text":"mount"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"mkdir mnt\nsudo mount disk mnt\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Nella cartella "},{"Code":"mnt"},{"Text":" troviamo i seguenti file:"},{"End":"Paragraph"},{"Start":{"List":null}},{"Start":"Item"},{"Start":"Strong"},{"Text":"next_stage.txt"},{"End":"Strong"},{"Text":" : un testo che come all"},{"Text":"’"},{"Text":"inizio ci indica la strada da"},"SoftBreak",{"Text":"proseguire."},{"End":"Item"},{"Start":"Item"},{"Start":"Strong"},{"Text":"helpful.png"},{"End":"Strong"},{"Text":" : immagine con Clippy che ci lascia un messaggio"},{"End":"Item"},{"End":{"List":null}},{"Start":"Paragraph"},{"Text":"Clippy nel suo messaggio cita un eseguibile di cui fare il reverse engineering,"},"SoftBreak",{"Text":"però non abbiamo al momento nessun eseguibile."},{"End":"Paragraph"},{"Start":{"Heading":["H4",null,[]]}},{"Text":"Hint 2"},{"End":{"Heading":["H4",null,[]]}},{"Start":"Paragraph"},{"Text":"Analizziamo quindi il contenuto del file "},{"Code":"next_stage.txt"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"strings next_stage.txt\nstrings -10 next_stage.txt\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Notiamo una stringa in base64, decodificata proseguiamo ad analizzarla notando"},"SoftBreak",{"Text":"che è stato applicato uno shift"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"echo \"RnIgZnJ2IG95YnBwbmdiIHZhIGdoZ2d2IGRocmZndiBPVkEgY2ViaW4gbiBzbmVndiBoYW4gSk5ZWCA6KQo=\" | base64 -d | tr ‘n-za-mN-ZA-M’ ‘a-zA-Z’\n# Oppure se si ha installati bsd_games\necho \"RnIgZnJ2IG95YnBwbmdiIHZhIGdoZ2d2IGRocmZndiBPVkEgY2ViaW4gbiBzbmVndiBoYW4gSk5ZWCA6KQo=\" | base64 -d | rot13\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Unendo le varie informazioni trovate sappiamo che sono stati eliminati dei file"},"SoftBreak",{"Text":"e ci viene citato "},{"Code":"binwalk"},{"Text":"."},{"End":"Paragraph"},{"Start":{"Heading":["H4",null,[]]}},{"Text":"Forensics"},{"End":{"Heading":["H4",null,[]]}},{"Start":"Paragraph"},{"Text":"Il filesystem mantiene i dati scritti su disco anche dopo l"},{"Text":"’"},{"Text":"eliminazione dato"},"SoftBreak",{"Text":"che vengono solo eliminati i nodi e considerato come freespace. Per estrarre i"},"SoftBreak",{"Text":"dati ci sono vari modi: testdisk, ext-undelete, scalpel"},{"Text":"…"},{"Text":" Noi mostreremo un"},"SoftBreak",{"Text":"metodo utilizzando binwalk."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Come suggerito proviamo a utilizzare binwalk su disk per trovare tutti i dati"},"SoftBreak",{"Text":"contenuti, nelle nuove versioni è necessario utilizzare il tag "},{"Code":"-b"},{"Text":"."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Facendo un prima analisi sul file disk possiamo notare che contiene file di"},"SoftBreak",{"Text":"estensione nota e che quando abbiamo fatto il mount non erano presenti"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"strings -10 disk | grep -i \"[a-z_]*\\.[a-z]*\"\nstrings | head\n# next_stage.txt\n# sneaky.tar.gz\n# helpful.png\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Una volta visto l"},{"Text":"’"},{"Text":"esistenza di un file non presente alla montatura procediamo"},"SoftBreak",{"Text":"con l"},{"Text":"’"},{"Text":"estrazione e l"},{"Text":"’"},{"Text":"analisi dei files utilizzando binwalk con la flag "},{"Code":"-e"},{"Text":"."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"binwalk -e -b disk\ncd _disk.extracted/\nfile *\ntar -xvf 7400\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Il tar contiene i seguenti files:"},{"End":"Paragraph"},{"Start":{"List":null}},{"Start":"Item"},{"Start":"Strong"},{"Text":"final_stage.txt"},{"End":"Strong"},{"Text":" : testo"},{"End":"Item"},{"Start":"Item"},{"Start":"Strong"},{"Text":"crackme"},{"End":"Strong"},{"Text":" : eseguibile"},{"End":"Item"},{"End":{"List":null}},{"Start":"BlockQuote"},{"Start":"Paragraph"},{"Text":"Utilizzando lo strumento testdisk è possibile riconoscere il file rimosso, ma"},"SoftBreak",{"Text":"non è possibile l"},{"Text":"’"},{"Text":"estrazione"},{"End":"Paragraph"},{"End":"BlockQuote"},{"Start":{"Heading":["H4",null,[]]}},{"Text":"Reverse Engineering"},{"End":{"Heading":["H4",null,[]]}},{"Start":"Paragraph"},{"Text":"Analizzando crackme troviamo che dal main viene chiamata una funzione da un"},"SoftBreak",{"Text":"array di funzioni nominato "},{"Code":"table"},{"Text":". La funzione chiamata è la funzione "},{"Code":"j"},{"Text":","},"SoftBreak",{"Text":"dato che viene l"},{"Text":"’"},{"Text":"indice viene determinato dal calcolo di"},"SoftBreak",{"Code":"modular_exponentiation"},{"Text":" sulla base di parametri statici."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"C++"}}},{"Text":"argv_to_int = atoi(*(char **)(param_2 + 8));\ntable_index = modular_exponentiation(3,0x2b,7);\ncVar1 = *(table + (ulong)table_index * 8)((ulong)argv_to_int);\n"},{"End":{"CodeBlock":{"Fenced":"C++"}}},{"Start":"Paragraph"},{"Text":"Proseguendo l"},{"Text":"’"},{"Text":"analisi della funzione "},{"Code":"j"},{"Text":" notiamo che al suo interno chiama una"},"SoftBreak",{"Text":"funzione di controllo ("},{"Code":"fourth_check"},{"Text":") passando come argomento del binary."},"SoftBreak",{"Code":"fourth_check"},{"Text":" divide il valore che abbiamo inserito in 4 variabili tramite"},"SoftBreak",{"Text":"operazioni binarie che utilizza poi in un sistema lineare a quattro incognite."},"SoftBreak",{"Text":"La funzione "},{"Code":"j"},{"Text":" controllerà poi i risultati di questo sistema con i valori"},"SoftBreak",{"Text":"contenuti in un array inizializzato all"},{"Text":"’"},{"Text":"interno della procedura."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Conoscendo tutti questi valori possiamo quindi creare un sistema lineare dove"},"SoftBreak",{"Text":"poniamo come incognite le quattro parti in cui il nostro valore di ingresso è"},"SoftBreak",{"Text":"stato diviso e una volta che abbiamo ottenuto il valore andiamo a fare il"},"SoftBreak",{"Text":"reverse dell"},{"Text":"’"},{"Text":"operazione di "},{"Code":">>"},{"Text":" per ottenere il valore corretto."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"python"}}},{"Text":"import numpy as np\nimport math\n\n\"\"\" fourth_check() - from ghidra\nuint32_t a = n & 0xFF;\nuint32_t b = (n >> 8) & 0xFF;\nuint32_t c = (n >> 16) & 0xFF;\nuint32_t d = (n >> 24) & 0xFF;\n\nuint32_t v1 = 'J' * a + 'o' * b + 'j' * c + 'o' * d;\nuint32_t v2 = 'D' * a + 'I' * b + 'O' * c + '!' * d;\nuint32_t v3 = 'Z' * a + 'A' * b + 'W' * c + 'A' * d;\nuint32_t v4 = 'R' * a + 'U' * b + 'D' * c + 'O' * d;\n\nuint32_t vals[4] = {61319, 38111, 48787, 48939};\n\"\"\"\n\ndef char_to_str(chrs):\nreturn [ord(c) for c in chrs]\n\nincognite = np.array([char_to_str(\"Jojo\"), char_to_str(\"DIO!\"), char_to_str(\"ZAWA\"), char_to_str(\"RUDO\")])\nvalori = np.array([61319, 38111, 48787, 48939])\nrisultato = np.linalg.solve(incognite, valori)\nprint(\"Values are: {}\".format(risultato)) # Values are: [198.  96. 146. 185.]\n\nvalues = [198, 96, 146, 185]\nvalues.reverse()\nbinary = [\"{0:08b}\".format(b) for b in values]\nprint(\"Value: {}\".format(int(\"\".join(binary), 2))) # 3113377990\n"},{"End":{"CodeBlock":{"Fenced":"python"}}},{"Start":"Paragraph"},{"Text":"Eseguiamo quindi crackme passando come parametro il valore calcolato e"},"SoftBreak",{"Text":"otteniamo un HASH(SHA2)."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"./crackme 3113377990\n# 0051377D1EE813EBFB59991D9165D88EC8C28C51AB37268A01DE386D00AE873AE34051D74CEEF2E457AB2D06BF283BEE87D0A209242B004DC27892DA6DB1AE1C\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":{"Heading":["H5",null,[]]}},{"Text":"Hint 3"},{"End":{"Heading":["H5",null,[]]}},{"Start":"Paragraph"},{"Text":"Nell"},{"Text":"’"},{"Text":"eseguibile viene eseguito un controllo tra la stringa "},{"Text":"“"},{"Text":"stuck"},{"Text":"”"},{"Text":" e una"},"SoftBreak",{"Text":"variabile di nome "},{"Code":"hint"},{"Text":". Se andiamo a controllare il valore della variabile,"},"SoftBreak",{"Text":"ci consiglia di trovare dinamicamente la funzione chiamata dal main o di"},"SoftBreak",{"Text":"cambiare il tipo della variabile "},{"Code":"table"},{"Text":" in un array di funzioni per capire"},"SoftBreak",{"Text":"quale di queste chiami. La stringa la possiamo notare eseguendo strings del"},"SoftBreak",{"Text":"nostro eseguibile."},{"End":"Paragraph"},{"Start":{"Heading":["H4",null,[]]}},{"Text":"Steganography"},{"End":{"Heading":["H4",null,[]]}},{"Start":"Paragraph"},{"Text":"Consideriamo l"},{"Text":"’"},{"Text":"immagine "},{"Code":"helpful.png"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"strings helpful.png\n# at Least you're putting Significant effort into this challenge\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Dato il suggerimento proviamo a vedere se abbiamo qualcosa nei"},"SoftBreak",{"Start":{"Link":["Inline","https://www.boiteaklou.fr/Steganography-Least-Significant-Bit.html",""]}},{"Text":"bit meno significativi"},{"End":{"Link":["Inline","https://www.boiteaklou.fr/Steganography-Least-Significant-Bit.html",""]}},{"Text":"."},"SoftBreak",{"Text":"Utilizzando il codice fornito all"},{"Text":"’"},{"Text":"interno della pagina web otteniamo il nostro"},"SoftBreak",{"Text":"messaggio nascosto."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"python"}}},{"Text":"import base64\nfrom PIL import Image\n\nimage = Image.open(\"./helpful.png\")\nextracted = ''\npixels = image.load()\nfor x in range(0,image.width):\nr,g,b = pixels[x,0]\nextracted += bin(r)[-1]\nextracted += bin(g)[-1]\nextracted += bin(b)[-1]\n\nchars = []\nfor i in range(len(extracted)//8):\nbyte = extracted[(i*8):(i+1)*8]\nchars.append(chr(int(''.join([str(bit) for bit in byte]), 2)))\n\nflag = ''.join(chars)\nprint(flag) # This website might help you a lot: https://ecavicc.github.io/cyberchallenge/\n"},{"End":{"CodeBlock":{"Fenced":"python"}}},{"Start":"BlockQuote"},{"Start":"Paragraph"},{"Text":"Un altro tool più popolare da utilizzabile è zsteg in ruby per ricavare"},"SoftBreak",{"Text":"direttamente il base64"},{"End":"Paragraph"},{"End":"BlockQuote"},{"Start":{"Heading":["H3",null,[]]}},{"Text":"Cracking"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"Andiamo a forzare l"},{"Text":"’"},{"Text":"hash che abbiamo ottenuto dall"},{"Text":"’"},{"Text":"eseguibile per ottenere la"},"SoftBreak",{"Text":"password che ci permetterà di ottenere la flag. Per crackare l"},{"Text":"’"},{"Text":"hash andremo a"},"SoftBreak",{"Text":"utilizzare hashcat fornendo una wordlist, si può anche trovare la soluzione su"},"SoftBreak",{"Start":{"Link":["Inline","https://crackstation.net/",""]}},{"Text":"CrackStation"},{"End":{"Link":["Inline","https://crackstation.net/",""]}},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"hashcat -a 0 -m 1700 hash rockyou.txt\n# Mr.Pickles\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":{"Heading":["H4",null,[]]}},{"Text":"Hint 4"},{"End":{"Heading":["H4",null,[]]}},{"Start":"Paragraph"},{"Text":"Il sito che abbiamo estratto dall"},{"Text":"’"},{"Text":"immagine contiene il simbolo # e un gattino"},"SoftBreak",{"Text":"da qui possiamo collegare i due elementi e ottenere "},{"Code":"hashcat"},{"Text":". Inoltre il link"},"SoftBreak",{"Text":"presente infondo alla pagina, che porta alla canzione We Will Rock You, vuole"},"SoftBreak",{"Text":"essere un suggerimento a utilizzare una wordlist di supporto."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Conclusione"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"Eseguiamo il file python per ottenere la flag"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"echo \"Mr.Pickles\" > passwd\npython3 get_flag.py < passwd\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Code":"FLAG{i_7urn3d_mys31f_i1n70_4_pick13}"},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Extras"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"Piccoli easter-egg presenti nella sfida :smile:"},{"End":"Paragraph"},{"Start":{"List":null}},{"Start":"Item"},{"Start":"Strong"},{"Text":"Forgot Password"},{"End":"Strong"},{"Text":": premere più volte "},{"Code":"forget password"},{"Text":" potrebbe aiutare."},{"End":"Item"},{"Start":"Item"},{"Start":"Strong"},{"Text":"Copy Pasta"},{"End":"Strong"},{"Text":": Crackme potrebbe esprimersi su Rick & Morty."},{"End":"Item"},{"Start":"Item"},{"Start":"Strong"},{"Text":"Hello There"},{"End":"Strong"},{"Text":": Il sito nascosto da Clippy - con un gran icona - potrebbe"},"SoftBreak",{"Text":"avere un saluto altrettanto nascosto."},{"End":"Item"},{"End":{"List":null}}]}},"__N_SSG":true}