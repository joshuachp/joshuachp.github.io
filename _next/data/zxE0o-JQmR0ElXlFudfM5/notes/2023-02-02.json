{"pageProps":{"article":{"title":"Jouranl 2023-02-02","description":null,"tags":["journal","gnupg","nix"],"date":"2023-02-02","draft":false,"language":"en","content":[{"Start":{"Heading":["H1",null,[]]}},{"Text":"Journal 2023-02-02"},{"End":{"Heading":["H1",null,[]]}},{"Html":"<!-- Morning -->\n"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"GPG Custom Home Nixos"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"If you configure a different "},{"Code":"$GNUPGHOME"},{"Text":", the "},{"Code":"gpgconf --list-dirs"},{"Text":" tool will"},"SoftBreak",{"Text":"return the socket directories as"},"SoftBreak",{"Code":"/run/user/$(id)/gnupg/<hash>/S.gpg-agent.socket"},{"Text":" the directories. Where the"},"SoftBreak",{"Code":"hash"},{"Text":" is the "},{"Code":"GCRY_MD_SHA1"},{"Text":" hash of the "},{"Code":"GNUPGHOME"},{"Text":"."},{"FootnoteReference":"1"},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"If your using "},{"Code":"NixOS"},{"Text":" option "},{"Code":"programs.gnupg.agent.enable"},{"Text":" the user service"},"SoftBreak",{"Text":"will put the socket in the wrong "},{"Code":"path"},{"Text":". You need to set the "},{"Code":"ListeningStream"},"SoftBreak",{"Text":"to the correct path."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"nix"}}},{"Text":"{\n    systemd.user.sockets.gpg-agent.listenStreams = [ \"\" \"%t/gnupg/d.8jmbbcqh9gemi75at4554oo4/S.gpg-agent\" ];\n    systemd.user.sockets.gpg-agent-ssh.listenStreams = [ \"\" \"%t/gnupg/d.8jmbbcqh9gemi75at4554oo4/S.gpg-agent.ssh\" ];\n    systemd.user.sockets.gpg-agent-extra.listenStreams = [ \"\" \"%t/gnupg/d.8jmbbcqh9gemi75at4554oo4/S.gpg-agent.extra\" ];\n}\n"},{"End":{"CodeBlock":{"Fenced":"nix"}}},{"Start":"Paragraph"},{"Text":"The first "},{"Code":"\"\""},{"Text":" empty string is to reset the option for the override."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Then you can configure the environment variables as usual:"},"SoftBreak",{"Code":"export SSH_AUTH_SOCK=\"$(gpgconf --list-dirs agent-ssh-socket)\""},{"Text":"."},{"End":"Paragraph"},{"Html":"<!-- What do I want to do today? -->\n"},{"Html":"<!-- Evening -->\n"},{"Html":"<!-- What did I learn today? -->\n"},{"Html":"<!-- Things I learned -->\n"},{"Html":"<!-- Useful tools and libraries -->\n"},{"Start":{"FootnoteDefinition":"1"}},{"Start":{"CodeBlock":"Indented"}},{"Text":"Source\n"},{"Text":"[ArchWiki - GnuPG](https://wiki.archlinux.org/title/GnuPG#Set_SSH_AUTH_SOCK)\n"},{"End":{"CodeBlock":"Indented"}},{"End":{"FootnoteDefinition":"1"}}]}},"__N_SSG":true}