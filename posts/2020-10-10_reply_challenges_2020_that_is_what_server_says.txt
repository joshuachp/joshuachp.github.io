1:HL["/_next/static/css/c54d109becb66e5a.css",{"as":"style"}]
0:[[["",{"children":["posts",{"children":[["path","2020-10-10_reply_challenges_2020_that_is_what_server_says","d"],{"children":["__PAGE__?{\"path\":\"2020-10-10_reply_challenges_2020_that_is_what_server_says\"}",{}]}]}]},"$undefined","$undefined",true],"$L2",[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/c54d109becb66e5a.css","precedence":"next"}]],["$L3",null]]]]
4:HL["/_next/static/css/2a1840b1c557e13c.css",{"as":"style"}]
2:["$L5",null]
3:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"/dev/blog - /dev/blog - Reply Challenge 2020 - That's what server says"}],["$","meta","2",{"name":"description","content":"Writeup for the 300 points Web challenge for Reply Challenge CTF"}],["$","meta","3",{"name":"application-name","content":"/dev/blog"}],["$","meta","4",{"name":"generator","content":"Next.js"}],["$","meta","5",{"name":"keywords","content":"Dev,Blog,Programmings"}],["$","meta","6",{"name":"referrer","content":"origin-when-cross-origin"}],["$","meta","7",{"name":"theme-color","content":"amber"}],["$","meta","8",{"name":"color-scheme","content":"dark"}],["$","meta","9",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","10",{"name":"creator","content":"Joshua Chapman"}],["$","link","11",{"rel":"canonical","href":"https://joshuachp.dev/posts/2020-10-10_reply_challenges_2020_that_is_what_server_says"}],["$","link","12",{"rel":"icon","href":"/favicon.svg","type":"image/svg+xml"}],["$","link","13",{"rel":"icon","href":"/favicon.png","type":"image/png"}],["$","link","14",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon"}]]
6:I{"id":"3508","chunks":["920:static/chunks/920-79b25866a09062bb.js","185:static/chunks/app/layout-ac6595f318b0efa3.js"],"name":"","async":false}
7:I{"id":"247","chunks":["920:static/chunks/920-79b25866a09062bb.js","185:static/chunks/app/layout-ac6595f318b0efa3.js"],"name":"","async":false}
8:I{"id":"3495","chunks":["920:static/chunks/920-79b25866a09062bb.js","185:static/chunks/app/layout-ac6595f318b0efa3.js"],"name":"","async":false}
9:I{"id":"4463","chunks":["272:static/chunks/webpack-3cec3c2ca15efd7b.js","253:static/chunks/bce60fc1-ffb58b2bcff1f68e.js","488:static/chunks/488-f0d2c9fb33175142.js"],"name":"","async":false}
a:I{"id":"1010","chunks":["272:static/chunks/webpack-3cec3c2ca15efd7b.js","253:static/chunks/bce60fc1-ffb58b2bcff1f68e.js","488:static/chunks/488-f0d2c9fb33175142.js"],"name":"","async":false}
5:["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","$L6",null,{"production":true,"goatCounterApi":"a7d98e3f-b56b"}],["$","script",null,{"id":"dark-theme","dangerouslySetInnerHTML":{"__html":"if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}"}}]]}],["$","body",null,{"className":"bg-primary-50 dark:bg-primary-900","children":["$","$L7",null,{"children":[["$","$L8",null,{}],["$","main",null,{"className":"flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96","children":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$","$L9",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["path","2020-10-10_reply_challenges_2020_that_is_what_server_says","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$La",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","childProp":{"current":["$Lb",null],"segment":"__PAGE__?{\"path\":\"2020-10-10_reply_challenges_2020_that_is_what_server_says\"}"},"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/2a1840b1c557e13c.css","precedence":"next"}]]}],"segment":["path","2020-10-10_reply_challenges_2020_that_is_what_server_says","d"]},"styles":[]}],"segment":"posts"},"styles":[]}]}]]}]}]]}]
c:I{"id":"8920","chunks":["920:static/chunks/920-79b25866a09062bb.js","790:static/chunks/app/notes/[path]/page-194102d9beb0e613.js"],"name":"","async":false}
d:I{"id":"8451","chunks":["920:static/chunks/920-79b25866a09062bb.js","790:static/chunks/app/notes/[path]/page-194102d9beb0e613.js"],"name":"","async":false}
b:["$","article",null,{"className":"flex max-w-full grow flex-col justify-self-start","children":[["$","h1",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl","children":[["$","span","1",{"children":"Reply Challenge 2020 - That"}],["$","span","2",{"children":"’"}],["$","span","3",{"children":"s what server says"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","6",{"children":"This is the Writeup for the 300 points Web challenge for Reply Challenge CTF."}],"\r\n",["$","span","8",{"children":"During the CTF I and my team achieved first blood on this challenge. The"}],"\r\n",["$","span","10",{"children":"challenge consists of finding a service endpoint on a web page, with a login"}],"\r\n",["$","span","12",{"children":"API. Then you have to exploit an "}],["$","strong","15",{"children":[["$","span","14",{"children":"XXE"}]]}],["$","span","16",{"children":" (XML External Entities) Injection to"}],"\r\n",["$","span","18",{"children":"get an "}],["$","strong","21",{"children":[["$","span","20",{"children":"LFI"}]]}],["$","span","22",{"children":" (Local File Inclusion) to get the sysadmin credentials to login"}],"\r\n",["$","span","24",{"children":"on the service and get the flag."}]]}],["$","h2",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl","children":[["$","span","27",{"children":"Service discovery"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","30",{"children":"Fist we land on a page with just a "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"<h1>"}],["$","span","32",{"children":" title and an "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"<img>"}],["$","span","34",{"children":". The title talks"}],"\r\n",["$","span","36",{"children":"about "}],["$","strong","39",{"children":[["$","span","38",{"children":"robots"}]]}],["$","span","40",{"children":" and in the image there are some blackberries. So as they"}],"\r\n",["$","span","42",{"children":"hinted we navigate to the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"/robots.txt"}],["$","span","44",{"children":" files to find if there are some"}],"\r\n",["$","span","46",{"children":"disallowed entries. We are greeted by the character Michael from The Office"}],"\r\n",["$","span","48",{"children":"saying "}],["$","em","55",{"children":[["$","span","50",{"children":"“"}],["$","span","51",{"children":"You"}],["$","span","52",{"children":"’"}],["$","span","53",{"children":"re not my friend Barry"}],["$","span","54",{"children":"”"}]]}],["$","span","56",{"children":"."}]]}],["$","h3",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl","children":[["$","span","59",{"children":"User Agent"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","62",{"children":"Since the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"roots.txt"}],["$","span","64",{"children":" file is blocked and there is anything else on the main"}],"\r\n",["$","span","66",{"children":"page, we have to circumvent the check on this file. They hinted to us something"}],"\r\n",["$","span","68",{"children":"about berries or blackberries. So we can try to access the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"robots.txt"}],["$","span","70",{"children":" as a"}],"\r\n",["$","span","72",{"children":"BlackBerry phone. This can be done by changing the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"User-Agent"}],["$","span","74",{"children":" header of your"}],"\r\n",["$","span","76",{"children":"HTTP request. We can find a list of valid "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"User-Agent"}],["$","span","78",{"children":" string on"}],"\r\n",["$","$Lc",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"http://www.useragentstring.com/pages/useragentstring.php?name=BlackBerry","children":[["$","span","81",{"children":"this website"}]]}],["$","span","83",{"children":"."}],"\r\n",["$","span","85",{"children":"After we changed the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"User-agent"}],["$","span","87",{"children":" we revisit the page and now we can see a"}],"\r\n",["$","span","89",{"children":"disallowed entry "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"/file_upload.php"}],["$","span","91",{"children":"."}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","img","96",{"src":"/images/reply-challenges/robots.png","alt":""}]]}],["$","h3",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl","children":[["$","span","99",{"children":"File Upload"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","102",{"children":"The "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"file_upload.php"}],["$","span","104",{"children":" API permits us to upload a "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"[png, jpg, jpeg, gif]"}],["$","span","106",{"children":" file"}],"\r\n",["$","span","108",{"children":"to the machine and will return where the file was uploaded."}]]}],["$","blockquote","116",{"children":[["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","112",{"children":"Spoiler: we never use the uploaded file (rev shell or other) probably was a"}],"\r\n",["$","span","114",{"children":"rabbit hole."}]]}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","118",{"children":"There are two curious facts about this API. The first is that the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"POST"}],"\r\n",["$","span","121",{"children":"request has sent three values:"}]]}],["$","ul",null,{"className":"mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc","children":[["$","li","129",{"className":"mb-2","children":[["$","strong","127",{"children":[["$","span","126",{"children":"fileToUpload"}]]}],["$","span","128",{"children":": The file to upload and its filename"}]]}],["$","li","135",{"className":"mb-2","children":[["$","strong","133",{"children":[["$","span","132",{"children":"req"}]]}],["$","span","134",{"children":": A string that represents an endpoint on the server"}]]}],["$","li","141",{"className":"mb-2","children":[["$","strong","139",{"children":[["$","span","138",{"children":"submit"}]]}],["$","span","140",{"children":": A request method (POST)"}]]}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","144",{"children":"The second one is when you send the request without uploading a file, you get a"}],"\r\n",["$","span","146",{"children":"message to contact the sysadmin to use the API "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"/services"}],["$","span","148",{"children":" and set the"}],"\r\n",["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"authorized.xml"}],["$","span","151",{"children":" file."}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","img","156",{"src":"/images/reply-challenges/sysadmin.png","alt":""}]]}],["$","h2",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl","children":[["$","span","159",{"children":"Exploitation"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","162",{"children":"We can not access the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"/services"}],["$","span","164",{"children":" from our machine, so we can try to use"}],"\r\n",["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"file_upload.php"}],["$","span","167",{"children":" to communicate with this API. First, we can try to change the"}],"\r\n",["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"req"}],["$","span","170",{"children":" value to "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"/services"}],["$","span","172",{"children":" and check what we get back. Sending an image we get"}],"\r\n",["$","span","174",{"children":"that the page doesn"}],["$","span","175",{"children":"’"}],["$","span","176",{"children":"t support this method. Then we change the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"submit"}],["$","span","178",{"children":" value to"}],"\r\n",["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"GET"}],["$","span","181",{"children":". The page responds with an HTML/XML body. This is "}],["$","strong","184",{"children":[["$","span","183",{"children":"XML WSDL"}]]}],["$","span","185",{"children":" a standard"}],"\r\n",["$","span","187",{"children":"for Web Services Description Language, it is used to describe web services."}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","img","192",{"src":"/images/reply-challenges/services.png","alt":""}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","195",{"children":"We can see that the services have an endpoint at "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"/services/perform_login"}],"\r\n",["$","span","198",{"children":"requires as input a "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"user"}],["$","span","200",{"children":" and a "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"pwd"}],["$","span","202",{"children":" that is probably the one in the"}],"\r\n",["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"authorized.xml"}],["$","span","205",{"children":" referenced before."}]]}],["$","h3",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl","children":[["$","span","208",{"children":"XXE Injection"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","211",{"children":"We can now try to send the file to the login API. If we send an image the"}],"\r\n",["$","span","213",{"children":"endpoint returns "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"XML Format Error"}],["$","span","215",{"children":", so we know that the page requires an XML"}],"\r\n",["$","span","217",{"children":"file. Unfortunately, "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"file_upload.php"}],["$","span","219",{"children":" only accepts certain extension, we need"}],"\r\n",["$","span","221",{"children":"to craft or XML payload and rename the file to a valid extension like "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":".jpg"}],["$","span","223",{"children":"."}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","226",{"children":"From the XML WSDL, we know the arguments that are required, and with a bit of"}],"\r\n",["$","span","228",{"children":"trial and error, we can find the right format of the payload."}]]}],["$","$Ld","232",{"language":"xml","className":"mb-4 mt-2","children":[["$","span","231",{"children":"<user>test</user>\n"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","234",{"children":"When we send the post we get an error saying:"}]]}],["$","$Ld","238",{"language":"","className":"mb-4 mt-2","children":[["$","span","237",{"children":"test is not a register user\n"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","240",{"children":"Now we have a value "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"user"}],["$","span","242",{"children":" that can output on the response. This means we can"}],"\r\n",["$","span","244",{"children":"make an XXE Injection to get the "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"authorized.xml"}],["$","span","246",{"children":" file as the user value and"}],"\r\n",["$","span","248",{"children":"make the response print it as an error for profit. We can guess the position of"}],"\r\n",["$","span","250",{"children":"the file because the response includes where our image was uploaded, or we"}],"\r\n",["$","span","252",{"children":"could try and get the entire directory, or a known file like "}],["$","code",null,{"className":" items-baseline whitespace-nowrap rounded bg-primary-200 p-0.5 dark:bg-primary-700 sm:p-1","children":"/etc/passwd"}],["$","span","254",{"children":"."}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","257",{"children":"The final payload is the following."}]]}],["$","$Ld","261",{"language":"xml","className":"mb-4 mt-2","children":[["$","span","260",{"children":"<!DOCTYPE root [!ENTITY test SYSTEM 'file:///var/chall300_web/authorized.xml'>]>\n<user>&test;</user>\n"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","img","265",{"src":"/images/reply-challenges/flag.png","alt":""}]]}],["$","blockquote","275",{"children":[["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","269",{"children":"If you want to read more about XXE here"}],"\r\n",["$","$Lc",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection","children":[["$","span","272",{"children":"PayloadAllTheThings/XXE Injection"}]]}]]}]]}]]}]
