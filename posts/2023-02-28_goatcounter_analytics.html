<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="stylesheet" href="/_next/static/css/816f3edd0640ecf0.css" data-precedence="next.js"/><link rel="stylesheet" href="/_next/static/css/2a1840b1c557e13c.css" data-precedence="next.js"/><link rel="preload" as="script" href="//gc.zgo.at/count.js"/><title>/dev/blog - /dev/blog - GoatCounter Analytics for NextJS</title><meta name="description" content="GoatCounter Analytics is a privacy-friendly web analytics tool perfect for small websites like blogs. It is free and open source."/><meta name="application-name" content="/dev/blog"/><meta name="generator" content="Next.js"/><meta name="keywords" content="Dev,Blog,Programmings"/><meta name="referrer" content="origin-when-cross-origin"/><meta name="theme-color" content="amber"/><meta name="color-scheme" content="dark"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="creator" content="Joshua Chapman"/><link rel="canonical" href="https://joshuachp.dev/posts/2023-02-28_goatcounter_analytics"/><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="icon" href="/favicon.png" type="image/png"/><link rel="icon" href="/favicon.ico" type="image/x-icon"/><script>(self.__next_s=self.__next_s||[]).push([0,{"children":"if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}"}])</script><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" nomodule=""></script></head><body class="bg-primary-50 dark:bg-primary-900"><header class="flex flex-row items-baseline justify-between gap-4 p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><nav class="flex flex-grow flex-row flex-wrap gap-y-4"><a title="Home page" class="mr-8" href="/"><h1 class=" text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl">/dev/blog</h1></a><ul class="flex flex-grow flex-row items-end justify-start gap-8"><li><a title="Posts" href="/posts"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50 underline font-bold">Posts</span></a></li><li><a title="Notes" href="/notes"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50  font-bold">Notes</span></a></li></ul></nav><div><button class="rounded border-t-2 border-l-2 border-r-4 border-b-4  border-primary-900 px-4 py-2 text-sm font-medium text-primary-900  hover:bg-primary-100 active:translate-y-0.5 dark:border-primary-50 dark:text-primary-50 dark:hover:bg-primary-800 "><span class="text-sm sm:text-base xl:text-lg text-primary-900 dark:text-primary-50 font-semibold">Auto</span></button></div></header><main class="flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><article class="flex max-w-full grow flex-col justify-self-start"><h1 class="mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl"><span>GoatCounter Analytics for NextJS</span></h1><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>GoatCounter Analytics is a privacy-friendly web analytics tool perfect for</span>
<span>small websites like blogs. It is free and open source, and it also has a self</span>
<span>hosted option.</span></p><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>I started using it in this blog, to see how a better understanding the traffic,</span>
<span>while still being privacy-friendly. Before, I was using the panel provided by</span>
<span>Cloudflare, which is also a good option. But it didn</span><span>’</span><span>t provide me with enough</span>
<span>information like the number of page views per page or article or the</span>
<a title="" class="font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer"><span>Referrer</span></a>
<span>information.</span></p><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><img src="/images/2023-02-28/goatcounter.png" alt=""/></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Why Use GoatCounter Analytics?</span></h2><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Privacy is a growing concern on the web, and more and more users are becoming</span>
<span>aware of the importance of protecting their online data. GoatCounter is a great</span>
<span>solution for website owners who want to respect their users</span><span>’</span><span> privacy while</span>
<span>still gathering useful data about their website traffic. It is a simple and</span>
<span>lightweight tool that provides essential data like page views, referrer</span>
<span>information, and more, without tracking any personal data or using cookies.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Getting Started with GoatCounter Analytics</span></h2><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>To use GoatCounter Analytics, the first thing you need to do is to create an</span>
<span>account on the GoatCounter website for your site. Once you have created an</span>
<span>account, GoatCounter will provide you with a script tag that you need to add to</span>
<span>your website.</span></p><pre class="language-html mb-4 mt-2 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>&lt;script
  data-goatcounter=&quot;https://example.goatcounter.com/count&quot;
  async
  src=&quot;//gc.zgo.at/count.js&quot;
&gt;&lt;/script&gt;
</span></code></pre><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Integrating GoatCounter with NextJS</span></h2><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>To integrate GoatCounter with your NextJS website, you</span><span>’</span><span>ll need to add a script</span>
<span>tag to your </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">_app.tsx</code><span> file, which will ensure that the script is loaded on</span>
<span>every page. It</span><span>’</span><span>s essential to use the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">afterInteractive</code><span> strategy to avoid</span>
<span>impacting page load performance. Additionally, you</span><span>’</span><span>ll need to hook up with the</span>
<span>router events to send page changes to GoatCounte.</span></p><ol start="1" class="mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-decimal"><li class="mb-2"><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Add the GoatCounter script tag to your pages/</span><span>_app.tsx file:</span></p><pre class="language-jsx mb-4 mt-2 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>// pages/_app.tsx
</span><span>function MyApp({ Component, pageProps }) {
</span><span>  return (
</span><span>    &lt;&gt;
</span><span>      &lt;Script
</span><span>        strategy=&quot;afterInteractive&quot;
</span><span>        data-goatcounter={`https://${API}.goatcounter.com/count`}
</span><span>        src=&quot;//gc.zgo.at/count.js&quot;
</span><span>      &gt;&lt;/Script&gt;
</span><span>      &lt;Component {...pageProps} /&gt;
</span><span>    &lt;/&gt;
</span><span>  );
</span><span>}
</span></code></pre><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Remember to put the script </span><strong><span>outside</span></strong><span> the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">Header</code><span> component, otherwise it</span>
<span>won</span><span>’</span><span>t work and the script will not be loaded correctly.</span></p></li><li class="mb-2"><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>The script will add a magic pixel on the first load, which will phone home</span>
<span>to the GoatCounter server and registered the visit. But it won</span><span>’</span><span>t work for</span>
<span>the rest of the of the page views since NextJS is a SPA. So we need to hook</span>
<span>up to the router events to send the page views to GoatCounter.</span></p></li><li class="mb-2"><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Now you need to register a event listener to the router, so when the page</span>
<span>changes we</span><span>’</span><span>ll send the information to the GoatCounter server. To do that,</span>
<span>we</span><span>’</span><span>ll use the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">useRouter</code><span>:</span></p><pre class="language-jsx mb-4 mt-2 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>import { useEffect } from &quot;react&quot;;
</span><span>import { useRouter } from &quot;next/router&quot;;

</span><span>export default function MyApp({ Component, pageProps }) {
</span><span>  const router = useRouter();

</span><span>  useEffect(() =&gt; {
</span><span>    const handleRouteChange = (url) =&gt; {
</span><span>      window.goatcounter.count({
</span><span>        path: url,
</span><span>      });
</span><span>    };

</span><span>    router.events.on(&quot;routeChangeComplete&quot;, handleRouteChange);

</span><span>    return () =&gt; {
</span><span>      router.events.off(&quot;routeChangeComplete&quot;, handleRouteChange);
</span><span>    };
</span><span>  }, []);

</span><span>  return &lt;Component {...pageProps} /&gt;;
</span><span>}
</span></code></pre><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>We use the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">useEffect</code><span> to add the event listener only once, and we remove it</span>
<span>when the component is unmounted.</span></p></li></ol><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Now you can go to your GoatCounter dashboard and see the page views. You can</span>
<span>also see the referrer information, which is very useful to see where your</span>
<span>traffic is coming from.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Conclusion</span></h2><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>GoatCounter is a privacy-friendly analytics tool that provides useful data</span>
<span>about website traffic without tracking any personal data. By following the</span>
<span>steps outlined in this article, you can integrate GoatCounter Analytics with</span>
<span>your NextJS web application and start gathering useful data about your website</span>
<span>traffic while respecting your users</span><span>’</span><span> privacy.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Update 2023-04-03 </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">app</code><span> directory</span></h2><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Since the NextJS </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">canary</code><span> version and the future </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">13.3</code><span> release will support</span>
<span>static exports, I decided to move the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">pages</code><span> directory to the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">app</code><span> directory.</span></p><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>In the new layout the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">useRouter</code><span> is deprecated in favour of the new and more</span>
<span>ergonomic </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">usePathname</code><span> and </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">useSearchParams</code><span> hooks. So I needed to update the</span>
<span>above script to support the new API.</span></p><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>I also improved the component, using the state hook to wait for the</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">goatcounter</code><span> script to be loaded before using it.</span></p><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>The component consists in the following:</span></p><ul class="mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc"><li class="mb-2"><span>Getting the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">pathname</code><span>, and optionally the query string, with the</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">usePathname</code><span> hook</span></li><li class="mb-2"><span>A </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">goatcounter</code><span> state value for the GoatCounter script since we cannot access</span>
<span>the window object in the static export</span></li><li class="mb-2"><span>A </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">useEffect</code><span> hook to run the code only when the path changes or the script</span>
<span>is loaded</span></li><li class="mb-2"><span>Finally the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">Script</code><span> component to load the script, and when loaded it will</span>
<span>update the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">goatcounter</code><span> state value</span></li></ul><pre class="language-tsx mb-4 mt-2 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>export function GoatCounter({ api }: GoatCounterProps) {
  const pathname = usePathname();
  const [goatcounter, setGoatcounter] = useState&lt;GoatCounter | null&gt;(null);

  useEffect(() =&gt; {
    // We need to wait for the script to load before we can use it.
    if (!goatcounter) {
      return;
    }

    goatcounter.count({
      //path: location.pathname + location.search + location.hash,
      path: pathname,
    });
  }, [pathname, goatcounter]);

  return (
    &lt;Script
      strategy=&quot;afterInteractive&quot;
      data-goatcounter={`https://${api}.goatcounter.com/count`}
      src=&quot;//gc.zgo.at/count.js&quot;
      onLoad={() =&gt; {
        if (!window.goatcounter) {
          throw new Error(&quot;goatcounter object is not defined&quot;);
        }

        setGoatcounter(window.goatcounter);
      }}
    /&gt;
  );
typescript}
</span></code></pre><h3 class="mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl"><span>Bonus</span></h3><p class="mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>To make the typescript compiler happy, I added the following to the</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">types/index.d.ts</code><span> file, you also need to specify it into the tsconfig file:</span></p><pre class="language-typescript mb-4 mt-2 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>/**
 * GoatCounter script object.
 */
interface GoatCounter {
  count: (options: { path: string }) =&gt; void;
}

/**
 * Declare the global goatcounter that is included as a script.
 */
interface Window extends Window {
  goatcounter?: GoatCounter;
}
</span></code></pre></article></main><script src="/_next/static/chunks/webpack-e24f1f8cbee90348.js" async=""></script><script src="/_next/static/chunks/2443530c-65ca4daeaf429502.js" async=""></script><script src="/_next/static/chunks/961-409d5e344dd5ce3d.js" async=""></script><script src="/_next/static/chunks/main-app-8f2d29d5c797a129.js" async=""></script></body></html><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"0:\"$L1\"\n"])</script><script>self.__next_f.push([1,"2:I{\"id\":\"8462\",\"name\":\"\",\"chunks\":[\"272:webpack-e24f1f8cbee90348\",\"667:2443530c-65ca4daeaf429502\",\"961:961-409d5e344dd5ce3d\"],\"async\":false}\n4:I{\"id\":\"9178\",\"name\":\"\",\"chunks\":[\"272:webpack-e24f1f8cbee90348\",\"667:2443530c-65ca4daeaf429502\",\"961:961-409d5e344dd5ce3d\"],\"async\":false}\n"])</script><script>self.__next_f.push([1,"1:[\"$\",\"$L2\",null,{\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/posts/2023-02-28_goatcounter_analytics\",\"initialTree\":[\"\",{\"children\":[\"posts\",{\"children\":[[\"path\",\"2023-02-28_goatcounter_analytics\",\"d\"],{\"children\":[\"__PAGE__?{\\\"path\\\":\\\"2023-02-28_goatcounter_analytics\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":\"$L3\",\"globalErrorComponent\":\"$4\",\"notFound\":\"$L5\",\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"children\":[\"$L6\",null,null,[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/816f3edd0640ecf0.css\",\"precedence\":\"next.js\"}]]]}]\n"])</script><script>self.__next_f.push([1,"7:I{\"id\":\"5376\",\"name\":\"\",\"chunks\":[\"619:619-3a70a20416de9ff0\",\"185:app/layout-e35d8b0528d4d717\"],\"async\":false}\n8:I{\"id\":\"6722\",\"name\":\"\",\"chunks\":[\"619:619-3a70a20416de9ff0\",\"185:app/layout-e35d8b0528d4d717\"],\"async\":false}\n9:I{\"id\":\"9299\",\"name\":\"\",\"chunks\":[\"619:619-3a70a20416de9ff0\",\"185:app/layout-e35d8b0528d4d717\"],\"async\":false}\na:I{\"id\":\"5019\",\"name\":\"\",\"chunks\":[\"619:619-3a70a20416de9ff0\",\"185:app/layout-e35d8b0528d4d717\"],\"async\":false}\nb:I{\"id\":\"1300\",\"name\":\"\",\"chunks\":[\"272:webpack-e24f1f8cbee"])</script><script>self.__next_f.push([1,"90348\",\"667:2443530c-65ca4daeaf429502\",\"961:961-409d5e344dd5ce3d\"],\"async\":false}\nc:I{\"id\":\"6022\",\"name\":\"\",\"chunks\":[\"272:webpack-e24f1f8cbee90348\",\"667:2443530c-65ca4daeaf429502\",\"961:961-409d5e344dd5ce3d\"],\"async\":false}\n"])</script><script>self.__next_f.push([1,"6:[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"$L7\",null,{\"production\":true,\"goatCounterApi\":\"a7d98e3f-b56b\"}],[\"$\",\"$L8\",null,{\"id\":\"dark-theme\",\"strategy\":\"beforeInteractive\",\"children\":\"if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')\u0026\u0026window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}\"}]]}],[\"$\",\"body\",null,{\"className\":\"bg-primary-50 dark:bg-primary-900\",\"children\":[\"$\",\"$L9\",null,{\"children\":[[\"$\",\"$La\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96\",\"children\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"childProp\":{\"current\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"childProp\":{\"current\":[\"$\",\"$Lb\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"posts\",\"children\",[\"path\",\"2023-02-28_goatcounter_analytics\",\"d\"],\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"template\":[\"$\",\"$Lc\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"asNotFound\":false,\"childProp\":{\"current\":[\"$Ld\",null,null,[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2a1840b1c557e13c.css\",\"precedence\":\"next.js\"}]]],\"segment\":\"__PAGE__?{\\\"path\\\":\\\"2023-02-28_goatcounter_analytics\\\"}\"}}],\"segment\":[\"path\",\"2023-02-28_goatcounter_analytics\",\"d\"]}}],\"segment\":\"posts\"}}]}]]}]}]]}]\n"])</script><script>self.__next_f.push([1,"5:[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"$L7\",null,{\"production\":true,\"goatCounterApi\":\"a7d98e3f-b56b\"}],[\"$\",\"$L8\",null,{\"id\":\"dark-theme\",\"strategy\":\"beforeInteractive\",\"children\":\"if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')\u0026\u0026window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}\"}]]}],[\"$\",\"body\",null,{\"className\":\"bg-primary-50 dark:bg-primary-900\",\"children\":[\"$\",\"$L9\",null,{\"children\":[[\"$\",\"$La\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96\",\"children\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]}]]}]}]]}]\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"meta\",null,{\"charSet\":\"utf-8\"}],[\"$\",\"title\",null,{\"children\":\"/dev/blog - /dev/blog - GoatCounter Analytics for NextJS\"}],[\"$\",\"meta\",null,{\"name\":\"description\",\"content\":\"GoatCounter Analytics is a privacy-friendly web analytics tool perfect for small websites like blogs. It is free and open source.\"}],[\"$\",\"meta\",null,{\"name\":\"application-name\",\"content\":\"/dev/blog\"}],null,null,[\"$\",\"meta\",null,{\"name\":\"generator\",\"content\":\"Next.js\"}],[\"$\",\"meta\",null,{\"name\":\"keywords\",\"content\":\"Dev,Blog,Programmings\"}],[\"$\",\"meta\",null,{\"name\":\"referrer\",\"content\":\"origin-when-cross-origin\"}],[[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"amber\"}]],[\"$\",\"meta\",null,{\"name\":\"color-scheme\",\"content\":\"dark\"}],[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",null,{\"name\":\"creator\",\"content\":\"Joshua Chapman\"}],null,null,null,null,null,null,null,null,null,[]],[[\"$\",\"link\",null,{\"rel\":\"canonical\",\"href\":\"https://joshuachp.dev/posts/2023-02-28_goatcounter_analytics\"}],null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.svg\",\"type\":\"image/svg+xml\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.png\",\"type\":\"image/png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\"}]],[],null]]\n"])</script><script>self.__next_f.push([1,"e:I{\"id\":\"3619\",\"name\":\"\",\"chunks\":[\"619:619-3a70a20416de9ff0\",\"991:app/posts/page-e472f6bcb7e02e60\"],\"async\":false}\nf:I{\"id\":\"7876\",\"name\":\"\",\"chunks\":[\"619:619-3a70a20416de9ff0\",\"563:app/posts/[path]/page-36232329709e656d\"],\"async\":false}\n"])</script><script>self.__next_f.push([1,"d:[\"$\",\"article\",null,{\"className\":\"flex max-w-full grow flex-col justify-self-start\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl\",\"children\":[[\"$\",\"span\",\"1\",{\"children\":\"GoatCounter Analytics for NextJS\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"4\",{\"children\":\"GoatCounter Analytics is a privacy-friendly web analytics tool perfect for\"}],\"\\r\\n\",[\"$\",\"span\",\"6\",{\"children\":\"small websites like blogs. It is free and open source, and it also has a self\"}],\"\\r\\n\",[\"$\",\"span\",\"8\",{\"children\":\"hosted option.\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"11\",{\"children\":\"I started using it in this blog, to see how a better understanding the traffic,\"}],\"\\r\\n\",[\"$\",\"span\",\"13\",{\"children\":\"while still being privacy-friendly. Before, I was using the panel provided by\"}],\"\\r\\n\",[\"$\",\"span\",\"15\",{\"children\":\"Cloudflare, which is also a good option. But it didn\"}],[\"$\",\"span\",\"16\",{\"children\":\"’\"}],[\"$\",\"span\",\"17\",{\"children\":\"t provide me with enough\"}],\"\\r\\n\",[\"$\",\"span\",\"19\",{\"children\":\"information like the number of page views per page or article or the\"}],\"\\r\\n\",[\"$\",\"$Le\",null,{\"title\":\"\",\"className\":\"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600\",\"href\":\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer\",\"children\":[[\"$\",\"span\",\"22\",{\"children\":\"Referrer\"}]]}],\"\\r\\n\",[\"$\",\"span\",\"25\",{\"children\":\"information.\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"img\",\"30\",{\"src\":\"/images/2023-02-28/goatcounter.png\",\"alt\":\"\"}]]}],[\"$\",\"h2\",null,{\"className\":\"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl\",\"children\":[[\"$\",\"span\",\"33\",{\"children\":\"Why Use GoatCounter Analytics?\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"36\",{\"children\":\"Privacy is a growing concern on the web, and more and more users are becoming\"}],\"\\r\\n\",[\"$\",\"span\",\"38\",{\"children\":\"aware of the importance of protecting their online data. GoatCounter is a great\"}],\"\\r\\n\",[\"$\",\"span\",\"40\",{\"children\":\"solution for website owners who want to respect their users\"}],[\"$\",\"span\",\"41\",{\"children\":\"’\"}],[\"$\",\"span\",\"42\",{\"children\":\" privacy while\"}],\"\\r\\n\",[\"$\",\"span\",\"44\",{\"children\":\"still gathering useful data about their website traffic. It is a simple and\"}],\"\\r\\n\",[\"$\",\"span\",\"46\",{\"children\":\"lightweight tool that provides essential data like page views, referrer\"}],\"\\r\\n\",[\"$\",\"span\",\"48\",{\"children\":\"information, and more, without tracking any personal data or using cookies.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl\",\"children\":[[\"$\",\"span\",\"51\",{\"children\":\"Getting Started with GoatCounter Analytics\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"54\",{\"children\":\"To use GoatCounter Analytics, the first thing you need to do is to create an\"}],\"\\r\\n\",[\"$\",\"span\",\"56\",{\"children\":\"account on the GoatCounter website for your site. Once you have created an\"}],\"\\r\\n\",[\"$\",\"span\",\"58\",{\"children\":\"account, GoatCounter will provide you with a script tag that you need to add to\"}],\"\\r\\n\",[\"$\",\"span\",\"60\",{\"children\":\"your website.\"}]]}],[\"$\",\"$Lf\",\"64\",{\"language\":\"html\",\"className\":\"mb-4 mt-2\",\"children\":[[\"$\",\"span\",\"63\",{\"children\":\"\u003cscript\\n  data-goatcounter=\\\"https://example.goatcounter.com/count\\\"\\n  async\\n  src=\\\"//gc.zgo.at/count.js\\\"\\n\u003e\u003c/script\u003e\\n\"}]]}],[\"$\",\"h2\",null,{\"className\":\"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl\",\"children\":[[\"$\",\"span\",\"66\",{\"children\":\"Integrating GoatCounter with NextJS\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"69\",{\"children\":\"To integrate GoatCounter with your NextJS website, you\"}],[\"$\",\"span\",\"70\",{\"children\":\"’\"}],[\"$\",\"span\",\"71\",{\"children\":\"ll need to add a script\"}],\"\\r\\n\",[\"$\",\"span\",\"73\",{\"children\":\"tag to your \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"_app.tsx\"}],[\"$\",\"span\",\"75\",{\"children\":\" file, which will ensure that the script is loaded on\"}],\"\\r\\n\",[\"$\",\"span\",\"77\",{\"children\":\"every page. It\"}],[\"$\",\"span\",\"78\",{\"children\":\"’\"}],[\"$\",\"span\",\"79\",{\"children\":\"s essential to use the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"afterInteractive\"}],[\"$\",\"span\",\"81\",{\"children\":\" strategy to avoid\"}],\"\\r\\n\",[\"$\",\"span\",\"83\",{\"children\":\"impacting page load performance. Additionally, you\"}],[\"$\",\"span\",\"84\",{\"children\":\"’\"}],[\"$\",\"span\",\"85\",{\"children\":\"ll need to hook up with the\"}],\"\\r\\n\",[\"$\",\"span\",\"87\",{\"children\":\"router events to send page changes to GoatCounte.\"}]]}],[\"$\",\"ol\",null,{\"start\":1,\"className\":\"mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-decimal\",\"children\":[[\"$\",\"li\",\"123\",{\"className\":\"mb-2\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"92\",{\"children\":\"Add the GoatCounter script tag to your pages/\"}],[\"$\",\"span\",\"93\",{\"children\":\"_app.tsx file:\"}]]}],[\"$\",\"$Lf\",\"109\",{\"language\":\"jsx\",\"className\":\"mb-4 mt-2\",\"children\":[[\"$\",\"span\",\"96\",{\"children\":\"// pages/_app.tsx\\n\"}],[\"$\",\"span\",\"97\",{\"children\":\"function MyApp({ Component, pageProps }) {\\n\"}],[\"$\",\"span\",\"98\",{\"children\":\"  return (\\n\"}],[\"$\",\"span\",\"99\",{\"children\":\"    \u003c\u003e\\n\"}],[\"$\",\"span\",\"100\",{\"children\":\"      \u003cScript\\n\"}],[\"$\",\"span\",\"101\",{\"children\":\"        strategy=\\\"afterInteractive\\\"\\n\"}],[\"$\",\"span\",\"102\",{\"children\":\"        data-goatcounter={`https://${API}.goatcounter.com/count`}\\n\"}],[\"$\",\"span\",\"103\",{\"children\":\"        src=\\\"//gc.zgo.at/count.js\\\"\\n\"}],[\"$\",\"span\",\"104\",{\"children\":\"      \u003e\u003c/Script\u003e\\n\"}],[\"$\",\"span\",\"105\",{\"children\":\"      \u003cComponent {...pageProps} /\u003e\\n\"}],[\"$\",\"span\",\"106\",{\"children\":\"    \u003c/\u003e\\n\"}],[\"$\",\"span\",\"107\",{\"children\":\"  );\\n\"}],[\"$\",\"span\",\"108\",{\"children\":\"}\\n\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"111\",{\"children\":\"Remember to put the script \"}],[\"$\",\"strong\",\"114\",{\"children\":[[\"$\",\"span\",\"113\",{\"children\":\"outside\"}]]}],[\"$\",\"span\",\"115\",{\"children\":\" the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"Header\"}],[\"$\",\"span\",\"117\",{\"children\":\" component, otherwise it\"}],\"\\r\\n\",[\"$\",\"span\",\"119\",{\"children\":\"won\"}],[\"$\",\"span\",\"120\",{\"children\":\"’\"}],[\"$\",\"span\",\"121\",{\"children\":\"t work and the script will not be loaded correctly.\"}]]}]]}],[\"$\",\"li\",\"136\",{\"className\":\"mb-2\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"126\",{\"children\":\"The script will add a magic pixel on the first load, which will phone home\"}],\"\\r\\n\",[\"$\",\"span\",\"128\",{\"children\":\"to the GoatCounter server and registered the visit. But it won\"}],[\"$\",\"span\",\"129\",{\"children\":\"’\"}],[\"$\",\"span\",\"130\",{\"children\":\"t work for\"}],\"\\r\\n\",[\"$\",\"span\",\"132\",{\"children\":\"the rest of the of the page views since NextJS is a SPA. So we need to hook\"}],\"\\r\\n\",[\"$\",\"span\",\"134\",{\"children\":\"up to the router events to send the page views to GoatCounter.\"}]]}]]}],[\"$\",\"li\",\"177\",{\"className\":\"mb-2\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"139\",{\"children\":\"Now you need to register a event listener to the router, so when the page\"}],\"\\r\\n\",[\"$\",\"span\",\"141\",{\"children\":\"changes we\"}],[\"$\",\"span\",\"142\",{\"children\":\"’\"}],[\"$\",\"span\",\"143\",{\"children\":\"ll send the information to the GoatCounter server. To do that,\"}],\"\\r\\n\",[\"$\",\"span\",\"145\",{\"children\":\"we\"}],[\"$\",\"span\",\"146\",{\"children\":\"’\"}],[\"$\",\"span\",\"147\",{\"children\":\"ll use the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"useRouter\"}],[\"$\",\"span\",\"149\",{\"children\":\":\"}]]}],[\"$\",\"$Lf\",\"169\",{\"language\":\"jsx\",\"className\":\"mb-4 mt-2\",\"children\":[[\"$\",\"span\",\"152\",{\"children\":\"import { useEffect } from \\\"react\\\";\\n\"}],[\"$\",\"span\",\"153\",{\"children\":\"import { useRouter } from \\\"next/router\\\";\\n\\n\"}],[\"$\",\"span\",\"154\",{\"children\":\"export default function MyApp({ Component, pageProps }) {\\n\"}],[\"$\",\"span\",\"155\",{\"children\":\"  const router = useRouter();\\n\\n\"}],[\"$\",\"span\",\"156\",{\"children\":\"  useEffect(() =\u003e {\\n\"}],[\"$\",\"span\",\"157\",{\"children\":\"    const handleRouteChange = (url) =\u003e {\\n\"}],[\"$\",\"span\",\"158\",{\"children\":\"      window.goatcounter.count({\\n\"}],[\"$\",\"span\",\"159\",{\"children\":\"        path: url,\\n\"}],[\"$\",\"span\",\"160\",{\"children\":\"      });\\n\"}],[\"$\",\"span\",\"161\",{\"children\":\"    };\\n\\n\"}],[\"$\",\"span\",\"162\",{\"children\":\"    router.events.on(\\\"routeChangeComplete\\\", handleRouteChange);\\n\\n\"}],[\"$\",\"span\",\"163\",{\"children\":\"    return () =\u003e {\\n\"}],[\"$\",\"span\",\"164\",{\"children\":\"      router.events.off(\\\"routeChangeComplete\\\", handleRouteChange);\\n\"}],[\"$\",\"span\",\"165\",{\"children\":\"    };\\n\"}],[\"$\",\"span\",\"166\",{\"children\":\"  }, []);\\n\\n\"}],[\"$\",\"span\",\"167\",{\"children\":\"  return \u003cComponent {...pageProps} /\u003e;\\n\"}],[\"$\",\"span\",\"168\",{\"children\":\"}\\n\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"171\",{\"children\":\"We use the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"useEffect\"}],[\"$\",\"span\",\"173\",{\"children\":\" to add the event listener only once, and we remove it\"}],\"\\r\\n\",[\"$\",\"span\",\"175\",{\"children\":\"when the component is unmounted.\"}]]}]]}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"180\",{\"children\":\"Now you can go to your GoatCounter dashboard and see the page views. You can\"}],\"\\r\\n\",[\"$\",\"span\",\"182\",{\"children\":\"also see the referrer information, which is very useful to see where your\"}],\"\\r\\n\",[\"$\",\"span\",\"184\",{\"children\":\"traffic is coming from.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl\",\"children\":[[\"$\",\"span\",\"187\",{\"children\":\"Conclusion\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"190\",{\"children\":\"GoatCounter is a privacy-friendly analytics tool that provides useful data\"}],\"\\r\\n\",[\"$\",\"span\",\"192\",{\"children\":\"about website traffic without tracking any personal data. By following the\"}],\"\\r\\n\",[\"$\",\"span\",\"194\",{\"children\":\"steps outlined in this article, you can integrate GoatCounter Analytics with\"}],\"\\r\\n\",[\"$\",\"span\",\"196\",{\"children\":\"your NextJS web application and start gathering useful data about your website\"}],\"\\r\\n\",[\"$\",\"span\",\"198\",{\"children\":\"traffic while respecting your users\"}],[\"$\",\"span\",\"199\",{\"children\":\"’\"}],[\"$\",\"span\",\"200\",{\"children\":\" privacy.\"}]]}],[\"$\",\"h2\",null,{\"className\":\"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl\",\"children\":[[\"$\",\"span\",\"203\",{\"children\":\"Update 2023-04-03 \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"app\"}],[\"$\",\"span\",\"205\",{\"children\":\" directory\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"208\",{\"children\":\"Since the NextJS \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"canary\"}],[\"$\",\"span\",\"210\",{\"children\":\" version and the future \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"13.3\"}],[\"$\",\"span\",\"212\",{\"children\":\" release will support\"}],\"\\r\\n\",[\"$\",\"span\",\"214\",{\"children\":\"static exports, I decided to move the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"pages\"}],[\"$\",\"span\",\"216\",{\"children\":\" directory to the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"app\"}],[\"$\",\"span\",\"218\",{\"children\":\" directory.\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"221\",{\"children\":\"In the new layout the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"useRouter\"}],[\"$\",\"span\",\"223\",{\"children\":\" is deprecated in favour of the new and more\"}],\"\\r\\n\",[\"$\",\"span\",\"225\",{\"children\":\"ergonomic \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"usePathname\"}],[\"$\",\"span\",\"227\",{\"children\":\" and \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"useSearchParams\"}],[\"$\",\"span\",\"229\",{\"children\":\" hooks. So I needed to update the\"}],\"\\r\\n\",[\"$\",\"span\",\"231\",{\"children\":\"above script to support the new API.\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"234\",{\"children\":\"I also improved the component, using the state hook to wait for the\"}],\"\\r\\n\",[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"goatcounter\"}],[\"$\",\"span\",\"237\",{\"children\":\" script to be loaded before using it.\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"240\",{\"children\":\"The component consists in the following:\"}]]}],[\"$\",\"ul\",null,{\"className\":\"mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc\",\"children\":[[\"$\",\"li\",\"250\",{\"className\":\"mb-2\",\"children\":[[\"$\",\"span\",\"244\",{\"children\":\"Getting the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"pathname\"}],[\"$\",\"span\",\"246\",{\"children\":\", and optionally the query string, with the\"}],\"\\r\\n\",[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"usePathname\"}],[\"$\",\"span\",\"249\",{\"children\":\" hook\"}]]}],[\"$\",\"li\",\"257\",{\"className\":\"mb-2\",\"children\":[[\"$\",\"span\",\"252\",{\"children\":\"A \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"goatcounter\"}],[\"$\",\"span\",\"254\",{\"children\":\" state value for the GoatCounter script since we cannot access\"}],\"\\r\\n\",[\"$\",\"span\",\"256\",{\"children\":\"the window object in the static export\"}]]}],[\"$\",\"li\",\"264\",{\"className\":\"mb-2\",\"children\":[[\"$\",\"span\",\"259\",{\"children\":\"A \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"useEffect\"}],[\"$\",\"span\",\"261\",{\"children\":\" hook to run the code only when the path changes or the script\"}],\"\\r\\n\",[\"$\",\"span\",\"263\",{\"children\":\"is loaded\"}]]}],[\"$\",\"li\",\"273\",{\"className\":\"mb-2\",\"children\":[[\"$\",\"span\",\"266\",{\"children\":\"Finally the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"Script\"}],[\"$\",\"span\",\"268\",{\"children\":\" component to load the script, and when loaded it will\"}],\"\\r\\n\",[\"$\",\"span\",\"270\",{\"children\":\"update the \"}],[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"goatcounter\"}],[\"$\",\"span\",\"272\",{\"children\":\" state value\"}]]}]]}],[\"$\",\"$Lf\",\"277\",{\"language\":\"tsx\",\"className\":\"mb-4 mt-2\",\"children\":[[\"$\",\"span\",\"276\",{\"children\":\"export function GoatCounter({ api }: GoatCounterProps) {\\n  const pathname = usePathname();\\n  const [goatcounter, setGoatcounter] = useState\u003cGoatCounter | null\u003e(null);\\n\\n  useEffect(() =\u003e {\\n    // We need to wait for the script to load before we can use it.\\n    if (!goatcounter) {\\n      return;\\n    }\\n\\n    goatcounter.count({\\n      //path: location.pathname + location.search + location.hash,\\n      path: pathname,\\n    });\\n  }, [pathname, goatcounter]);\\n\\n  return (\\n    \u003cScript\\n      strategy=\\\"afterInteractive\\\"\\n      data-goatcounter={`https://${api}.goatcounter.com/count`}\\n      src=\\\"//gc.zgo.at/count.js\\\"\\n      onLoad={() =\u003e {\\n        if (!window.goatcounter) {\\n          throw new Error(\\\"goatcounter object is not defined\\\");\\n        }\\n\\n        setGoatcounter(window.goatcounter);\\n      }}\\n    /\u003e\\n  );\\ntypescript}\\n\"}]]}],[\"$\",\"h3\",null,{\"className\":\"mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl\",\"children\":[[\"$\",\"span\",\"279\",{\"children\":\"Bonus\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg\",\"children\":[[\"$\",\"span\",\"282\",{\"children\":\"To make the typescript compiler happy, I added the following to the\"}],\"\\r\\n\",[\"$\",\"code\",null,{\"className\":\" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg\",\"children\":\"types/index.d.ts\"}],[\"$\",\"span\",\"285\",{\"children\":\" file, you also need to specify it into the tsconfig file:\"}]]}],[\"$\",\"$Lf\",\"289\",{\"language\":\"typescript\",\"className\":\"mb-4 mt-2\",\"children\":[[\"$\",\"span\",\"288\",{\"children\":\"/**\\n * GoatCounter script object.\\n */\\ninterface GoatCounter {\\n  count: (options: { path: string }) =\u003e void;\\n}\\n\\n/**\\n * Declare the global goatcounter that is included as a script.\\n */\\ninterface Window extends Window {\\n  goatcounter?: GoatCounter;\\n}\\n\"}]]}]]}]\n"])</script>