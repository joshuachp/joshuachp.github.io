<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="icon" type="image/png" href="/favicon.png"/><link rel="icon" type="image/x-icon" href="/favicon.ico"/><title>/dev/blog - GoatCounter Analytics for NextJS</title><meta name="description" content="GoatCounter Analytics is a privacy-friendly web analytics tool perfect for small websites like blogs. It is free and open source."/><link rel="canonical" href="https://joshuachp.dev/posts/2023-02-28_goatcounter_analytics"/><meta name="next-head-count" content="8"/><script id="dark-theme" data-nscript="beforeInteractive">if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}</script><link rel="preload" href="/_next/static/css/5fc30b497c9bed6d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5fc30b497c9bed6d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/2a1840b1c557e13c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2a1840b1c557e13c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2751f6424e24f776.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-f11614d8aa7ee555.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a9d23293c892d64a.js" defer=""></script><script src="/_next/static/chunks/664-e2359597ac708d8d.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpath%5D-9dcb15b2d370bd2e.js" defer=""></script><script src="/_next/static/Cwdoa7w8T0g6WgNi9Ucp_/_buildManifest.js" defer=""></script><script src="/_next/static/Cwdoa7w8T0g6WgNi9Ucp_/_ssgManifest.js" defer=""></script></head><body class="bg-primary-50 dark:bg-primary-900"><div id="__next"><header class="flex flex-row items-baseline justify-between gap-4 p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><nav class="flex flex-grow flex-row flex-wrap gap-y-4"><a title="Home page" class="mr-8" href="/"><h1 class=" text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl">/dev/blog</h1></a><ul class="flex flex-grow flex-row items-end justify-start gap-8"><li><a title="Posts" href="/posts"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50 underline font-bold">Posts</span></a></li><li><a title="Notes" href="/notes"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50  font-bold">Notes</span></a></li></ul></nav><div><button class="rounded border-t-2 border-l-2 border-r-4 border-b-4  border-primary-900 px-4 py-2 text-sm font-medium text-primary-900  hover:bg-primary-100 active:translate-y-0.5 dark:border-primary-50 dark:text-primary-50 dark:hover:bg-primary-800 "><span class="text-sm sm:text-base xl:text-lg text-primary-900 dark:text-primary-50 font-semibold">Auto</span></button></div></header><main class="flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><article class="flex max-w-full grow flex-col justify-self-start"><h1 class="mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl"><span>GoatCounter Analytics for NextJS</span></h1><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>GoatCounter Analytics is a privacy-friendly web analytics tool perfect for</span>
<span>small websites like blogs. It is free and open source, and it also has a self</span>
<span>hosted option.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>I started using it in this blog, to see how a better understanding the traffic,</span>
<span>while still being privacy-friendly. Before, I was using the panel provided by</span>
<span>Cloudflare, which is also a good option. But it didn</span><span>’</span><span>t provide me with enough</span>
<span>information like the number of page views per page or article or the</span>
<a title="" class="font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer"><span>Referrer</span></a>
<span>information.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><img src="/images/2023-02-28/goatcounter.png" alt=""/></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Why Use GoatCounter Analytics?</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Privacy is a growing concern on the web, and more and more users are becoming</span>
<span>aware of the importance of protecting their online data. GoatCounter is a great</span>
<span>solution for website owners who want to respect their users</span><span>’</span><span> privacy while</span>
<span>still gathering useful data about their website traffic. It is a simple and</span>
<span>lightweight tool that provides essential data like page views, referrer</span>
<span>information, and more, without tracking any personal data or using cookies.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Getting Started with GoatCounter Analytics</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>To use GoatCounter Analytics, the first thing you need to do is to create an</span>
<span>account on the GoatCounter website for your site. Once you have created an</span>
<span>account, GoatCounter will provide you with a script tag that you need to add to</span>
<span>your website.</span></p><pre class="language-html mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>&lt;script
  data-goatcounter=&quot;https://example.goatcounter.com/count&quot;
  async
  src=&quot;//gc.zgo.at/count.js&quot;
&gt;&lt;/script&gt;
</span></code></pre><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Integrating GoatCounter with NextJS</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>To integrate GoatCounter with your NextJS website, you</span><span>’</span><span>ll need to add a script</span>
<span>tag to your </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">_app.tsx</code><span> file, which will ensure that the script is loaded on</span>
<span>every page. It</span><span>’</span><span>s essential to use the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">afterInteractive</code><span> strategy to avoid</span>
<span>impacting page load performance. Additionally, you</span><span>’</span><span>ll need to hook up with the</span>
<span>router events to send page changes to GoatCounte.</span></p><ol start="1" class="mb-4 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-decimal"><li class="mb-2"><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Add the GoatCounter script tag to your pages/</span><span>_app.tsx file:</span></p><pre class="language-jsx mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>// pages/_app.tsx
</span><span>function MyApp({ Component, pageProps }) {
</span><span>  return (
</span><span>    &lt;&gt;
</span><span>      &lt;Script
</span><span>        strategy=&quot;afterInteractive&quot;
</span><span>        data-goatcounter={`https://${API}.goatcounter.com/count`}
</span><span>        src=&quot;//gc.zgo.at/count.js&quot;
</span><span>      &gt;&lt;/Script&gt;
</span><span>      &lt;Component {...pageProps} /&gt;
</span><span>    &lt;/&gt;
</span><span>  );
</span><span>}
</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Remember to put the script </span><strong><span>outside</span></strong><span> the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">Header</code><span> component, otherwise it</span>
<span>won</span><span>’</span><span>t work and the script will not be loaded correctly.</span></p></li><li class="mb-2"><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>The script will add a magic pixel on the first load, which will phone home</span>
<span>to the GoatCounter server and registered the visit. But it won</span><span>’</span><span>t work for</span>
<span>the rest of the of the page views since NextJS is a SPA. So we need to hook</span>
<span>up to the router events to send the page views to GoatCounter.</span></p></li><li class="mb-2"><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Now you need to register a event listener to the router, so when the page</span>
<span>changes we</span><span>’</span><span>ll send the information to the GoatCounter server. To do that,</span>
<span>we</span><span>’</span><span>ll use the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">useRouter</code><span>:</span></p><pre class="language-jsx mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>import { useEffect } from &quot;react&quot;;
</span><span>import { useRouter } from &quot;next/router&quot;;

</span><span>export default function MyApp({ Component, pageProps }) {
</span><span>  const router = useRouter();

</span><span>  useEffect(() =&gt; {
</span><span>    const handleRouteChange = (url) =&gt; {
</span><span>      window.goatcounter.count({
</span><span>        path: url,
</span><span>      });
</span><span>    };

</span><span>    router.events.on(&quot;routeChangeComplete&quot;, handleRouteChange);

</span><span>    return () =&gt; {
</span><span>      router.events.off(&quot;routeChangeComplete&quot;, handleRouteChange);
</span><span>    };
</span><span>  }, []);

</span><span>  return &lt;Component {...pageProps} /&gt;;
</span><span>}
</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>We use the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">useEffect</code><span> to add the event listener only once, and we remove it</span>
<span>when the component is unmounted.</span></p></li></ol><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Now you can go to your GoatCounter dashboard and see the page views. You can</span>
<span>also see the referrer information, which is very useful to see where your</span>
<span>traffic is coming from.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Conclusion</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>GoatCounter is a privacy-friendly analytics tool that provides useful data</span>
<span>about website traffic without tracking any personal data. By following the</span>
<span>steps outlined in this article, you can integrate GoatCounter Analytics with</span>
<span>your NextJS web application and start gathering useful data about your website</span>
<span>traffic while respecting your users</span><span>’</span><span> privacy.</span></p></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"path":"2023-02-28_goatcounter_analytics","article":{"title":"GoatCounter Analytics for NextJS","description":"GoatCounter Analytics is a privacy-friendly web analytics tool perfect for small websites like blogs. It is free and open source.","tags":["web","nextjs"],"date":"2023-02-28","draft":false,"language":"en","content":[{"Start":{"Heading":["H1",null,[]]}},{"Text":"GoatCounter Analytics for NextJS"},{"End":{"Heading":["H1",null,[]]}},{"Start":"Paragraph"},{"Text":"GoatCounter Analytics is a privacy-friendly web analytics tool perfect for"},"SoftBreak",{"Text":"small websites like blogs. It is free and open source, and it also has a self"},"SoftBreak",{"Text":"hosted option."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"I started using it in this blog, to see how a better understanding the traffic,"},"SoftBreak",{"Text":"while still being privacy-friendly. Before, I was using the panel provided by"},"SoftBreak",{"Text":"Cloudflare, which is also a good option. But it didn"},{"Text":"’"},{"Text":"t provide me with enough"},"SoftBreak",{"Text":"information like the number of page views per page or article or the"},"SoftBreak",{"Start":{"Link":["Inline","https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer",""]}},{"Text":"Referrer"},{"End":{"Link":["Inline","https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer",""]}},"SoftBreak",{"Text":"information."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Start":{"Image":["Inline","/images/2023-02-28/goatcounter.png",""]}},{"Text":"GoatCounter"},{"End":{"Image":["Inline","/images/2023-02-28/goatcounter.png",""]}},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Why Use GoatCounter Analytics?"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"Privacy is a growing concern on the web, and more and more users are becoming"},"SoftBreak",{"Text":"aware of the importance of protecting their online data. GoatCounter is a great"},"SoftBreak",{"Text":"solution for website owners who want to respect their users"},{"Text":"’"},{"Text":" privacy while"},"SoftBreak",{"Text":"still gathering useful data about their website traffic. It is a simple and"},"SoftBreak",{"Text":"lightweight tool that provides essential data like page views, referrer"},"SoftBreak",{"Text":"information, and more, without tracking any personal data or using cookies."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Getting Started with GoatCounter Analytics"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"To use GoatCounter Analytics, the first thing you need to do is to create an"},"SoftBreak",{"Text":"account on the GoatCounter website for your site. Once you have created an"},"SoftBreak",{"Text":"account, GoatCounter will provide you with a script tag that you need to add to"},"SoftBreak",{"Text":"your website."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"html"}}},{"Text":"\u003cscript\n  data-goatcounter=\"https://example.goatcounter.com/count\"\n  async\n  src=\"//gc.zgo.at/count.js\"\n\u003e\u003c/script\u003e\n"},{"End":{"CodeBlock":{"Fenced":"html"}}},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Integrating GoatCounter with NextJS"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"To integrate GoatCounter with your NextJS website, you"},{"Text":"’"},{"Text":"ll need to add a script"},"SoftBreak",{"Text":"tag to your "},{"Code":"_app.tsx"},{"Text":" file, which will ensure that the script is loaded on"},"SoftBreak",{"Text":"every page. It"},{"Text":"’"},{"Text":"s essential to use the "},{"Code":"afterInteractive"},{"Text":" strategy to avoid"},"SoftBreak",{"Text":"impacting page load performance. Additionally, you"},{"Text":"’"},{"Text":"ll need to hook up with the"},"SoftBreak",{"Text":"router events to send page changes to GoatCounte."},{"End":"Paragraph"},{"Start":{"List":1}},{"Start":"Item"},{"Start":"Paragraph"},{"Text":"Add the GoatCounter script tag to your pages/"},{"Text":"_app.tsx file:"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"jsx"}}},{"Text":"// pages/_app.tsx\n"},{"Text":"function MyApp({ Component, pageProps }) {\n"},{"Text":"  return (\n"},{"Text":"    \u003c\u003e\n"},{"Text":"      \u003cScript\n"},{"Text":"        strategy=\"afterInteractive\"\n"},{"Text":"        data-goatcounter={`https://${API}.goatcounter.com/count`}\n"},{"Text":"        src=\"//gc.zgo.at/count.js\"\n"},{"Text":"      \u003e\u003c/Script\u003e\n"},{"Text":"      \u003cComponent {...pageProps} /\u003e\n"},{"Text":"    \u003c/\u003e\n"},{"Text":"  );\n"},{"Text":"}\n"},{"End":{"CodeBlock":{"Fenced":"jsx"}}},{"Start":"Paragraph"},{"Text":"Remember to put the script "},{"Start":"Strong"},{"Text":"outside"},{"End":"Strong"},{"Text":" the "},{"Code":"Header"},{"Text":" component, otherwise it"},"SoftBreak",{"Text":"won"},{"Text":"’"},{"Text":"t work and the script will not be loaded correctly."},{"End":"Paragraph"},{"End":"Item"},{"Start":"Item"},{"Start":"Paragraph"},{"Text":"The script will add a magic pixel on the first load, which will phone home"},"SoftBreak",{"Text":"to the GoatCounter server and registered the visit. But it won"},{"Text":"’"},{"Text":"t work for"},"SoftBreak",{"Text":"the rest of the of the page views since NextJS is a SPA. So we need to hook"},"SoftBreak",{"Text":"up to the router events to send the page views to GoatCounter."},{"End":"Paragraph"},{"End":"Item"},{"Start":"Item"},{"Start":"Paragraph"},{"Text":"Now you need to register a event listener to the router, so when the page"},"SoftBreak",{"Text":"changes we"},{"Text":"’"},{"Text":"ll send the information to the GoatCounter server. To do that,"},"SoftBreak",{"Text":"we"},{"Text":"’"},{"Text":"ll use the "},{"Code":"useRouter"},{"Text":":"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"jsx"}}},{"Text":"import { useEffect } from \"react\";\n"},{"Text":"import { useRouter } from \"next/router\";\n\n"},{"Text":"export default function MyApp({ Component, pageProps }) {\n"},{"Text":"  const router = useRouter();\n\n"},{"Text":"  useEffect(() =\u003e {\n"},{"Text":"    const handleRouteChange = (url) =\u003e {\n"},{"Text":"      window.goatcounter.count({\n"},{"Text":"        path: url,\n"},{"Text":"      });\n"},{"Text":"    };\n\n"},{"Text":"    router.events.on(\"routeChangeComplete\", handleRouteChange);\n\n"},{"Text":"    return () =\u003e {\n"},{"Text":"      router.events.off(\"routeChangeComplete\", handleRouteChange);\n"},{"Text":"    };\n"},{"Text":"  }, []);\n\n"},{"Text":"  return \u003cComponent {...pageProps} /\u003e;\n"},{"Text":"}\n"},{"End":{"CodeBlock":{"Fenced":"jsx"}}},{"Start":"Paragraph"},{"Text":"We use the "},{"Code":"useEffect"},{"Text":" to add the event listener only once, and we remove it"},"SoftBreak",{"Text":"when the component is unmounted."},{"End":"Paragraph"},{"End":"Item"},{"End":{"List":1}},{"Start":"Paragraph"},{"Text":"Now you can go to your GoatCounter dashboard and see the page views. You can"},"SoftBreak",{"Text":"also see the referrer information, which is very useful to see where your"},"SoftBreak",{"Text":"traffic is coming from."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Conclusion"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"GoatCounter is a privacy-friendly analytics tool that provides useful data"},"SoftBreak",{"Text":"about website traffic without tracking any personal data. By following the"},"SoftBreak",{"Text":"steps outlined in this article, you can integrate GoatCounter Analytics with"},"SoftBreak",{"Text":"your NextJS web application and start gathering useful data about your website"},"SoftBreak",{"Text":"traffic while respecting your users"},{"Text":"’"},{"Text":" privacy."},{"End":"Paragraph"}]}},"__N_SSG":true},"page":"/posts/[path]","query":{"path":"2023-02-28_goatcounter_analytics"},"buildId":"Cwdoa7w8T0g6WgNi9Ucp_","runtimeConfig":{"domain":"joshuachp.dev","production":true},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>