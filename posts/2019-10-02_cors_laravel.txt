0:[[["",{"children":["posts",{"children":[["path","2019-10-02_cors_laravel","d"],{"children":["__PAGE__?{\"path\":\"2019-10-02_cors_laravel\"}",{}]}]}]},"$undefined","$undefined",true],"$L1","$L2"]]
2:[[["$","meta",null,{"charSet":"utf-8"}],["$","title",null,{"children":"/dev/blog - /dev/blog - CORS Laravel"}],["$","meta",null,{"name":"description","content":"Implementation of a simple CORS middleware for Laravel Php framework"}],["$","meta",null,{"name":"application-name","content":"/dev/blog"}],null,null,["$","meta",null,{"name":"generator","content":"Next.js"}],["$","meta",null,{"name":"keywords","content":"Dev,Blog,Programmings"}],["$","meta",null,{"name":"referrer","content":"origin-when-cross-origin"}],[["$","meta",null,{"name":"theme-color","content":"amber"}]],["$","meta",null,{"name":"color-scheme","content":"dark"}],["$","meta",null,{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta",null,{"name":"creator","content":"Joshua Chapman"}],null,null,null,null,null,null,null,null,null,[]],[["$","link",null,{"rel":"canonical","href":"https://joshuachp.dev/posts/2019-10-02_cors_laravel"}],null,null,null],null,null,[null,null,null,null,null],null,null,null,null,[null,[["$","link",null,{"rel":"icon","href":"/favicon.svg","type":"image/svg+xml"}],["$","link",null,{"rel":"icon","href":"/favicon.png","type":"image/png"}],["$","link",null,{"rel":"icon","href":"/favicon.ico","type":"image/x-icon"}]],[],null]]
1:["$L3",null,null,[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/816f3edd0640ecf0.css","precedence":"next.js"}]]]
4:I{"id":"5376","name":"","chunks":["619:619-3a70a20416de9ff0","185:app/layout-147fc0c93c3f3e98"],"async":false}
5:I{"id":"9299","name":"","chunks":["619:619-3a70a20416de9ff0","185:app/layout-147fc0c93c3f3e98"],"async":false}
6:I{"id":"5019","name":"","chunks":["619:619-3a70a20416de9ff0","185:app/layout-147fc0c93c3f3e98"],"async":false}
7:I{"id":"1300","name":"","chunks":["272:webpack-e24f1f8cbee90348","667:2443530c-65ca4daeaf429502","961:961-409d5e344dd5ce3d"],"async":false}
8:I{"id":"6022","name":"","chunks":["272:webpack-e24f1f8cbee90348","667:2443530c-65ca4daeaf429502","961:961-409d5e344dd5ce3d"],"async":false}
3:["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","$L4",null,{"production":true,"goatCounterApi":"a7d98e3f-b56b"}],["$","script",null,{"id":"dark-theme","dangerouslySetInnerHTML":{"__html":"if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}"}}]]}],["$","body",null,{"className":"bg-primary-50 dark:bg-primary-900","children":["$","$L5",null,{"children":[["$","$L6",null,{}],["$","main",null,{"className":"flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96","children":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$","$L7",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children",["path","2019-10-02_cors_laravel","d"],"children"],"error":"$undefined","errorStyles":"$undefined","loading":"$undefined","loadingStyles":"$undefined","hasLoading":false,"template":["$","$L8",null,{}],"templateStyles":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","asNotFound":false,"childProp":{"current":["$L9",null,null,[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/2a1840b1c557e13c.css","precedence":"next.js"}]]],"segment":"__PAGE__?{\"path\":\"2019-10-02_cors_laravel\"}"}}],"segment":["path","2019-10-02_cors_laravel","d"]}}],"segment":"posts"}}]}]]}]}]]}]
a:I{"id":"3619","name":"","chunks":["619:619-3a70a20416de9ff0","991:app/posts/page-a8aca74000a1e875"],"async":false}
b:I{"id":"7876","name":"","chunks":["619:619-3a70a20416de9ff0","563:app/posts/[path]/page-deda6ae7686b2d48"],"async":false}
9:["$","article",null,{"className":"flex max-w-full grow flex-col justify-self-start","children":[["$","h1",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl","children":[["$","span","1",{"children":"CORS Laravel"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","4",{"children":"I want to talk about the problems that I have encountered setting up CORS"}],"\r\n",["$","span","6",{"children":"between a Laravel backend server and a simple Html frontend hosted on a"}],"\r\n",["$","span","8",{"children":"different domain, using the fetch API."}]]}],["$","h2",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl","children":[["$","span","11",{"children":"What is CORS"}]]}],["$","blockquote","35",{"children":[["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","strong","17",{"children":[["$","span","16",{"children":"Cross-Origin Resource Sharing (CORS)"}]]}],["$","span","18",{"children":" is a mechanism that uses HTTP"}],"\r\n",["$","span","20",{"children":"headers to tell browsers to give a web application running at one origin,"}],"\r\n",["$","span","22",{"children":"access to selected resources from a different origin. A web application"}],"\r\n",["$","span","24",{"children":"executes a cross-origin HTTP request when it requests a resource that has a"}],"\r\n",["$","span","26",{"children":"different origin (domain, protocol, or port) from its own."}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":["<cite>",["$","$La",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://developer.mozilla.org/docs/Web/HTTP/CORS","children":[["$","span","31",{"children":"MDN Web docs"}]]}],"</cite>"]}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","37",{"children":"An example is having a backend server in a domain different from the frontend."}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","40",{"children":"Eg. "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"example.com admin.example.com"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","44",{"children":"The browsers will block all the requests cross-domain and throw an error. This"}],"\r\n",["$","span","46",{"children":"issue is also present in development because the server and frontend must be"}],"\r\n",["$","span","48",{"children":"hosted on different ports (Like "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"localhost:8080"}],["$","span","50",{"children":" and "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"localhost:8000"}],["$","span","52",{"children":")."}]]}],["$","h2",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl","children":[["$","span","55",{"children":"Implementation"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","58",{"children":"The best place to read the implementation of CORS is"}],"\r\n",["$","$La",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://developer.mozilla.org/docs/Web/HTTP/CORS","children":[["$","span","61",{"children":"MDN Web Docs"}]]}],["$","span","63",{"children":". Most of the"}],"\r\n",["$","span","65",{"children":"setup on the frontend is already done by "}],["$","strong","68",{"children":[["$","span","67",{"children":"fetch"}]]}],["$","span","69",{"children":". The first step in the CORS"}],"\r\n",["$","span","71",{"children":"mechanism is a "}],["$","strong","74",{"children":[["$","span","73",{"children":"Preflighted request"}]]}],["$","span","75",{"children":"."}]]}],["$","h3",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl","children":[["$","span","78",{"children":"Preflighted request"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","81",{"children":"The "}],["$","strong","84",{"children":[["$","span","83",{"children":"Preflighted request"}]]}],["$","span","85",{"children":" is an "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"OPTIONS"}],["$","span","87",{"children":" request that checks if the backend"}],"\r\n",["$","span","89",{"children":"server understands the necessary headers."}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","92",{"children":"The headers are:"}]]}],["$","ul",null,{"className":"mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc","children":[["$","li","97",{"className":"mb-2","children":[["$","span","96",{"children":"Access-Control-Request-Method"}]]}],["$","li","100",{"className":"mb-2","children":[["$","span","99",{"children":"Access-Control-Request-Headers"}]]}],["$","li","103",{"className":"mb-2","children":[["$","span","102",{"children":"Origin"}]]}]]}],["$","h4",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-xl font-semibold tracking-tight sm:text-2xl md:text-3xl","children":[["$","span","106",{"children":"Request"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","109",{"children":"I needed to make an Ajax "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"POST"}],["$","span","111",{"children":" request for some resources. I would send and"}],"\r\n",["$","span","113",{"children":"receive data in json format. The preflighted request would look something like"}],"\r\n",["$","span","115",{"children":"this:"}]]}],["$","$Lb","119",{"language":"http","className":"mb-4 mt-2","children":[["$","span","118",{"children":"GET /data/ HTTP/1.1\nHost: admin.example.com\nUser-Agent: Mozilla/5.0 (...) Gecko/20100101 Firefox\nAccept: */*\nAccept-Language: en-us,en;q=0.5\nAccept-Encoding: gzip,deflate\nConnection: keep-alive\nOrigin: https://example.com\n"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","121",{"children":"With the fetch API"}]]}],["$","$Lb","125",{"language":"javascript","className":"mb-4 mt-2","children":[["$","span","124",{"children":"fetch.ajax('admin.example.com', {\n        method: 'POST',\n        mode: 'cors',\n        body: JSON.stringify({\n            data: 'data',\n        });\n"}]]}],["$","h3",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl","children":[["$","span","127",{"children":"Laravel API"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","130",{"children":"On the API side on Laravel we need to use a Middleware to intercept the"}],"\r\n",["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"OPTION"}],["$","span","133",{"children":" request and add the necessary headers:"}]]}],["$","ul",null,{"className":"mb-4 mt-2 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc","children":[["$","li","138",{"className":"mb-2","children":[["$","span","137",{"children":"Access-Control-Allow-Origin"}]]}],["$","li","141",{"className":"mb-2","children":[["$","span","140",{"children":"Access-Control-Allow-Methods"}]]}],["$","li","144",{"className":"mb-2","children":[["$","span","143",{"children":"Access-Control-Allow-Headers"}]]}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","147",{"children":"We can do it two ways. Using a custom Middleware created on your own, for"}],"\r\n",["$","span","149",{"children":"simple testing, or the more complete plugin"}],"\r\n",["$","$La",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://github.com/barryvdh/laravel-cors","children":[["$","span","152",{"children":"barryvdh/laravel-cors"}]]}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","156",{"children":"You can find the implementation of the custom Middleware in this"}],"\r\n",["$","$La",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://stackoverflow.com/a/33090515","children":[["$","span","159",{"children":"Stack Overflow answer"}]]}],["$","span","161",{"children":". The code is:"}]]}],["$","$Lb","165",{"language":"php","className":"mb-4 mt-2","children":[["$","span","164",{"children":"<?php namespace App\\Http\\Middleware;\n\nuse Closure;\n\nclass CORS {\n\n    /**\n     * Handle an incoming request.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  \\Closure  $next\n     * @return mixed\n     */\n    public function handle($request, Closure $next)\n    {\n\n        header(\"Access-Control-Allow-Origin: *\");\n\n        // ALLOW OPTIONS METHOD\n        $headers = [\n            'Access-Control-Allow-Methods'=> 'POST, GET, OPTIONS, PUT, DELETE',\n            'Access-Control-Allow-Headers'=> 'Content-Type, X-Auth-Token, Origin'\n        ];\n        if($request->getMethod() == \"OPTIONS\") {\n            // The client-side application can set headers allowed in Access-Control-Allow-Headers\n            return Response::make('OK', 200, $headers);\n        }\n\n        $response = $next($request);\n        foreach($headers as $key => $value)\n            $response->header($key, $value);\n        return $response;\n    }\n}\n"}]]}],["$","h2",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl","children":[["$","span","167",{"children":"Issue"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","170",{"children":"After adding the Middleware I had still issues with the browser blocking the"}],"\r\n",["$","span","172",{"children":"request. The response to the Preflighted Request had a 200 Status Code, but no"}],"\r\n",["$","span","174",{"children":"CORS headers. After some digging, I found out that Laravel returns an html page"}],"\r\n",["$","span","176",{"children":"if you don"}],["$","span","177",{"children":"â€™"}],["$","span","178",{"children":"t specify a return type "}],["$","code",null,{"className":" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg","children":"Accept-Content: application/json"}],["$","span","180",{"children":" in the"}],"\r\n",["$","span","182",{"children":"request and it will result in a 302 redirect to the page which will blocked by"}],"\r\n",["$","span","184",{"children":"default from the browser. So in the fetch function, we need to add the request"}],"\r\n",["$","span","186",{"children":"and response content-type headers:"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","189",{"children":"With the fetch API"}]]}],["$","$Lb","193",{"language":"javascript","className":"mb-4 mt-2","children":[["$","span","192",{"children":"fetch.ajax(\"admin.example.com\", {\n    method: \"POST\",\n    mode: \"cors\",\n    headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\"\n    },;:\n    body: JSON.stringify({\n        data: \"data\"\n    })\n});\n"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","195",{"children":"An alternative would be to use a different package like"}],"\r\n",["$","$La",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://github.com/axios/axios","children":[["$","span","198",{"children":"axios"}]]}],["$","span","200",{"children":" that automatically sets the header for"}],"\r\n",["$","span","202",{"children":"the content-type and"}],"\r\n",["$","$La",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest","children":[["$","span","205",{"children":"XMLHttpRequest"}]]}],"\r\n",["$","span","208",{"children":"for Laravel to recognize the request as ajax."}]]}],["$","h2",null,{"className":"mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl","children":[["$","span","211",{"children":"Conclusion"}]]}],["$","p",null,{"className":"mb-2 text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg","children":[["$","span","214",{"children":"In conclusion, I suggest the use of the plug-in"}],"\r\n",["$","$La",null,{"title":"","className":"font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600","href":"https://github.com/barryvdh/laravel-cors","children":[["$","span","217",{"children":"barryvdh/laravel-cors"}]]}],["$","span","219",{"children":" for the best"}],"\r\n",["$","span","221",{"children":"configuration and features."}]]}]]}]
