<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" type="image/svg+xml" href="/favicon.svg"/><link rel="icon" type="image/png" href="/favicon.png"/><link rel="icon" type="image/x-icon" href="/favicon.ico"/><title>/dev/blog - /dev/blog - Reply Challenge 2020 - That&#x27;s what server says</title><meta name="description" content="Writeup for the 300 points Web challenge for Reply Challenge CTF"/><link rel="canonical" href="https://joshuachp.dev//posts/2020-10-10_reply_challenges_2020_that_is_what_server_says"/><meta name="next-head-count" content="8"/><script id="dark-theme" data-nscript="beforeInteractive">if(localStorage.theme==='Dark'||((!('theme'in localStorage)||localStorage.theme==='Auto')&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark')}</script><link rel="preload" href="/_next/static/css/5fc30b497c9bed6d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5fc30b497c9bed6d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/2a1840b1c557e13c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2a1840b1c557e13c.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-2751f6424e24f776.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-f11614d8aa7ee555.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4751e1abc30929ff.js" defer=""></script><script src="/_next/static/chunks/212-6cd705c4437a57fb.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpath%5D-cd79aeedc62188d6.js" defer=""></script><script src="/_next/static/1FCVS7IGzcEpLjeHx1B2_/_buildManifest.js" defer=""></script><script src="/_next/static/1FCVS7IGzcEpLjeHx1B2_/_ssgManifest.js" defer=""></script></head><body class="bg-primary-50 dark:bg-primary-900"><div id="__next"><header class="flex flex-row items-baseline justify-between gap-4 p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><nav class="flex flex-grow flex-row flex-wrap gap-y-4"><a title="Home page" class="mr-8" href="/"><h1 class=" text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl">/dev/blog</h1></a><ul class="flex flex-grow flex-row items-end justify-start gap-8"><li><a title="Posts" href="/posts"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50 underline font-bold">Posts</span></a></li><li><a title="Notes" href="/notes"><span class="text-xl md:text-2xl text-primary-900 dark:text-primary-50  font-bold">Notes</span></a></li></ul></nav><div><button class="rounded border-t-2 border-l-2 border-r-4 border-b-4  border-primary-900 px-4 py-2 text-sm font-medium text-primary-900  hover:bg-primary-100 active:translate-y-0.5 dark:border-primary-50 dark:text-primary-50 dark:hover:bg-primary-800 "><span class="text-sm sm:text-base xl:text-lg text-primary-900 dark:text-primary-50 font-semibold">Auto</span></button></div></header><main class="flex flex-col justify-center p-6 sm:px-12 md:px-24 lg:px-48 xl:px-60 2xl:px-96"><article class="flex max-w-full grow flex-col justify-self-start"><h1 class="mb-4 text-primary-900 dark:text-primary-50 text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl"><span>Reply Challenge 2020 - That</span><span>’</span><span>s what server says</span></h1><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>This is the Writeup for the 300 points Web challenge for Reply Challenge CTF.</span>
<span>During the CTF I and my team achieved first blood on this challenge. The</span>
<span>challenge consists of finding a service endpoint on a web page, with a login</span>
<span>API. Then you have to exploit an </span><strong><span>XXE</span></strong><span> (XML External Entities) Injection to</span>
<span>get an </span><strong><span>LFI</span></strong><span> (Local File Inclusion) to get the sysadmin credentials to login</span>
<span>on the service and get the flag.</span></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Service discovery</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Fist we land on a page with just a </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">&lt;h1&gt;</code><span> title and an </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">&lt;img&gt;</code><span>. The title talks</span>
<span>about </span><strong><span>robots</span></strong><span> and in the image there are some blackberries. So as they</span>
<span>hinted we navigate to the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">/robots.txt</code><span> files to find if there are some</span>
<span>disallowed entries. We are greeted by the character Michael from The Office</span>
<span>saying </span><em><span>“</span><span>You</span><span>’</span><span>re not my friend Barry</span><span>”</span></em><span>.</span></p><h3 class="mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl"><span>User Agent</span></h3><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Since the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">roots.txt</code><span> file is blocked and there is anything else on the main</span>
<span>page, we have to circumvent the check on this file. They hinted to us something</span>
<span>about berries or blackberries. So we can try to access the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">robots.txt</code><span> as a</span>
<span>BlackBerry phone. This can be done by changing the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">User-Agent</code><span> header of your</span>
<span>HTTP request. We can find a list of valid </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">User-Agent</code><span> string on</span>
<a title="" class="font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600" href="http://www.useragentstring.com/pages/useragentstring.php?name=BlackBerry"><span>this website</span></a><span>.</span>
<span>After we changed the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">User-agent</code><span> we revisit the page and now we can see a</span>
<span>disallowed entry </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">/file_upload.php</code><span>.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><img src="/images/reply-challenges/robots.png" alt=""/></p><h3 class="mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl"><span>File Upload</span></h3><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>The </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">file_upload.php</code><span> API permits us to upload a </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">[png, jpg, jpeg, gif]</code><span> file</span>
<span>to the machine and will return where the file was uploaded.</span></p><blockquote><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Spoiler: we never use the uploaded file (rev shell or other) probably was a</span>
<span>rabbit hole.</span></p></blockquote><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>There are two curious facts about this API. The first is that the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">POST</code>
<span>request has sent three values:</span></p><ul class="mb-4 ml-6 text-primary-900 dark:text-primary-50 text-sm sm:text-base xl:text-lg list-disc"><li class="mb-2"><strong><span>fileToUpload</span></strong><span>: The file to upload and its filename</span></li><li class="mb-2"><strong><span>req</span></strong><span>: A string that represents an endpoint on the server</span></li><li class="mb-2"><strong><span>submit</span></strong><span>: A request method (POST)</span></li></ul><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>The second one is when you send the request without uploading a file, you get a</span>
<span>message to contact the sysadmin to use the API </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">/services</code><span> and set the</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">authorized.xml</code><span> file.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><img src="/images/reply-challenges/sysadmin.png" alt=""/></p><h2 class="mb-4 text-primary-900 dark:text-primary-50 text-3xl font-bold tracking-tight sm:text-4xl md:text-5xl"><span>Exploitation</span></h2><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>We can not access the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">/services</code><span> from our machine, so we can try to use</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">file_upload.php</code><span> to communicate with this API. First, we can try to change the</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">req</code><span> value to </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">/services</code><span> and check what we get back. Sending an image we get</span>
<span>that the page doesn</span><span>’</span><span>t support this method. Then we change the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">submit</code><span> value to</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">GET</code><span>. The page responds with an HTML/XML body. This is </span><strong><span>XML WSDL</span></strong><span> a standard</span>
<span>for Web Services Description Language, it is used to describe web services.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><img src="/images/reply-challenges/services.png" alt=""/></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>We can see that the services have an endpoint at </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">/services/perform_login</code>
<span>requires as input a </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">user</code><span> and a </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">pwd</code><span> that is probably the one in the</span>
<code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">authorized.xml</code><span> referenced before.</span></p><h3 class="mb-4 text-primary-900 dark:text-primary-50 text-2xl font-bold tracking-tight sm:text-3xl md:text-4xl"><span>XXE Injection</span></h3><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>We can now try to send the file to the login API. If we send an image the</span>
<span>endpoint returns </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">XML Format Error</code><span>, so we know that the page requires an XML</span>
<span>file. Unfortunately, </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">file_upload.php</code><span> only accepts certain extension, we need</span>
<span>to craft or XML payload and rename the file to a valid extension like </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">.jpg</code><span>.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>From the XML WSDL, we know the arguments that are required, and with a bit of</span>
<span>trial and error, we can find the right format of the payload.</span></p><pre class="language-xml mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>&lt;user&gt;test&lt;/user&gt;
</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>When we send the post we get an error saying:</span></p><pre class="language-plaintext mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>test is not a register user
</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>Now we have a value </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">user</code><span> that can output on the response. This means we can</span>
<span>make an XXE Injection to get the </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">authorized.xml</code><span> file as the user value and</span>
<span>make the response print it as an error for profit. We can guess the position of</span>
<span>the file because the response includes where our image was uploaded, or we</span>
<span>could try and get the entire directory, or a known file like </span><code class=" items-baseline rounded bg-primary-200 p-0.5 text-sm dark:bg-primary-700 sm:p-1 sm:text-base xl:text-lg">/etc/passwd</code><span>.</span></p><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>The final payload is the following.</span></p><pre class="language-xml mb-4 overflow-auto rounded border-2 border-primary-900 p-4 dark:border-primary-50"><code><span>&lt;!DOCTYPE root [!ENTITY test SYSTEM &#x27;file:///var/chall300_web/authorized.xml&#x27;&gt;]&gt;
&lt;user&gt;&amp;test;&lt;/user&gt;
</span></code></pre><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><img src="/images/reply-challenges/flag.png" alt=""/></p><blockquote><p class="mb-4 inline text-sm text-primary-900 dark:text-primary-50 sm:text-base xl:text-lg"><span>If you want to read more about XXE here</span>
<a title="" class="font-bold text-accent-700 visited:text-accent-900 hover:underline dark:text-accent-400 dark:visited:text-accent-600" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection"><span>PayloadAllTheThings/XXE Injection</span></a></p></blockquote></article></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"path":"2020-10-10_reply_challenges_2020_that_is_what_server_says","article":{"title":"Reply Challenge 2020 - That's what server says","description":"Writeup for the 300 points Web challenge for Reply Challenge CTF","tags":["CTF"],"date":"2020-10-10","draft":false,"language":null,"content":[{"Start":{"Heading":["H1",null,[]]}},{"Text":"Reply Challenge 2020 - That"},{"Text":"’"},{"Text":"s what server says"},{"End":{"Heading":["H1",null,[]]}},{"Start":"Paragraph"},{"Text":"This is the Writeup for the 300 points Web challenge for Reply Challenge CTF."},"SoftBreak",{"Text":"During the CTF I and my team achieved first blood on this challenge. The"},"SoftBreak",{"Text":"challenge consists of finding a service endpoint on a web page, with a login"},"SoftBreak",{"Text":"API. Then you have to exploit an "},{"Start":"Strong"},{"Text":"XXE"},{"End":"Strong"},{"Text":" (XML External Entities) Injection to"},"SoftBreak",{"Text":"get an "},{"Start":"Strong"},{"Text":"LFI"},{"End":"Strong"},{"Text":" (Local File Inclusion) to get the sysadmin credentials to login"},"SoftBreak",{"Text":"on the service and get the flag."},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Service discovery"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"Fist we land on a page with just a "},{"Code":"\u003ch1\u003e"},{"Text":" title and an "},{"Code":"\u003cimg\u003e"},{"Text":". The title talks"},"SoftBreak",{"Text":"about "},{"Start":"Strong"},{"Text":"robots"},{"End":"Strong"},{"Text":" and in the image there are some blackberries. So as they"},"SoftBreak",{"Text":"hinted we navigate to the "},{"Code":"/robots.txt"},{"Text":" files to find if there are some"},"SoftBreak",{"Text":"disallowed entries. We are greeted by the character Michael from The Office"},"SoftBreak",{"Text":"saying "},{"Start":"Emphasis"},{"Text":"“"},{"Text":"You"},{"Text":"’"},{"Text":"re not my friend Barry"},{"Text":"”"},{"End":"Emphasis"},{"Text":"."},{"End":"Paragraph"},{"Start":{"Heading":["H3",null,[]]}},{"Text":"User Agent"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"Since the "},{"Code":"roots.txt"},{"Text":" file is blocked and there is anything else on the main"},"SoftBreak",{"Text":"page, we have to circumvent the check on this file. They hinted to us something"},"SoftBreak",{"Text":"about berries or blackberries. So we can try to access the "},{"Code":"robots.txt"},{"Text":" as a"},"SoftBreak",{"Text":"BlackBerry phone. This can be done by changing the "},{"Code":"User-Agent"},{"Text":" header of your"},"SoftBreak",{"Text":"HTTP request. We can find a list of valid "},{"Code":"User-Agent"},{"Text":" string on"},"SoftBreak",{"Start":{"Link":["Inline","http://www.useragentstring.com/pages/useragentstring.php?name=BlackBerry",""]}},{"Text":"this website"},{"End":{"Link":["Inline","http://www.useragentstring.com/pages/useragentstring.php?name=BlackBerry",""]}},{"Text":"."},"SoftBreak",{"Text":"After we changed the "},{"Code":"User-agent"},{"Text":" we revisit the page and now we can see a"},"SoftBreak",{"Text":"disallowed entry "},{"Code":"/file_upload.php"},{"Text":"."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Start":{"Image":["Inline","/images/reply-challenges/robots.png",""]}},{"Text":"robots.txt"},{"End":{"Image":["Inline","/images/reply-challenges/robots.png",""]}},{"End":"Paragraph"},{"Start":{"Heading":["H3",null,[]]}},{"Text":"File Upload"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"The "},{"Code":"file_upload.php"},{"Text":" API permits us to upload a "},{"Code":"[png, jpg, jpeg, gif]"},{"Text":" file"},"SoftBreak",{"Text":"to the machine and will return where the file was uploaded."},{"End":"Paragraph"},{"Start":"BlockQuote"},{"Start":"Paragraph"},{"Text":"Spoiler: we never use the uploaded file (rev shell or other) probably was a"},"SoftBreak",{"Text":"rabbit hole."},{"End":"Paragraph"},{"End":"BlockQuote"},{"Start":"Paragraph"},{"Text":"There are two curious facts about this API. The first is that the "},{"Code":"POST"},"SoftBreak",{"Text":"request has sent three values:"},{"End":"Paragraph"},{"Start":{"List":null}},{"Start":"Item"},{"Start":"Strong"},{"Text":"fileToUpload"},{"End":"Strong"},{"Text":": The file to upload and its filename"},{"End":"Item"},{"Start":"Item"},{"Start":"Strong"},{"Text":"req"},{"End":"Strong"},{"Text":": A string that represents an endpoint on the server"},{"End":"Item"},{"Start":"Item"},{"Start":"Strong"},{"Text":"submit"},{"End":"Strong"},{"Text":": A request method (POST)"},{"End":"Item"},{"End":{"List":null}},{"Start":"Paragraph"},{"Text":"The second one is when you send the request without uploading a file, you get a"},"SoftBreak",{"Text":"message to contact the sysadmin to use the API "},{"Code":"/services"},{"Text":" and set the"},"SoftBreak",{"Code":"authorized.xml"},{"Text":" file."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Start":{"Image":["Inline","/images/reply-challenges/sysadmin.png",""]}},{"Text":"sysadmin"},{"End":{"Image":["Inline","/images/reply-challenges/sysadmin.png",""]}},{"End":"Paragraph"},{"Start":{"Heading":["H2",null,[]]}},{"Text":"Exploitation"},{"End":{"Heading":["H2",null,[]]}},{"Start":"Paragraph"},{"Text":"We can not access the "},{"Code":"/services"},{"Text":" from our machine, so we can try to use"},"SoftBreak",{"Code":"file_upload.php"},{"Text":" to communicate with this API. First, we can try to change the"},"SoftBreak",{"Code":"req"},{"Text":" value to "},{"Code":"/services"},{"Text":" and check what we get back. Sending an image we get"},"SoftBreak",{"Text":"that the page doesn"},{"Text":"’"},{"Text":"t support this method. Then we change the "},{"Code":"submit"},{"Text":" value to"},"SoftBreak",{"Code":"GET"},{"Text":". The page responds with an HTML/XML body. This is "},{"Start":"Strong"},{"Text":"XML WSDL"},{"End":"Strong"},{"Text":" a standard"},"SoftBreak",{"Text":"for Web Services Description Language, it is used to describe web services."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Start":{"Image":["Inline","/images/reply-challenges/services.png",""]}},{"Text":"/services"},{"End":{"Image":["Inline","/images/reply-challenges/services.png",""]}},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"We can see that the services have an endpoint at "},{"Code":"/services/perform_login"},"SoftBreak",{"Text":"requires as input a "},{"Code":"user"},{"Text":" and a "},{"Code":"pwd"},{"Text":" that is probably the one in the"},"SoftBreak",{"Code":"authorized.xml"},{"Text":" referenced before."},{"End":"Paragraph"},{"Start":{"Heading":["H3",null,[]]}},{"Text":"XXE Injection"},{"End":{"Heading":["H3",null,[]]}},{"Start":"Paragraph"},{"Text":"We can now try to send the file to the login API. If we send an image the"},"SoftBreak",{"Text":"endpoint returns "},{"Code":"XML Format Error"},{"Text":", so we know that the page requires an XML"},"SoftBreak",{"Text":"file. Unfortunately, "},{"Code":"file_upload.php"},{"Text":" only accepts certain extension, we need"},"SoftBreak",{"Text":"to craft or XML payload and rename the file to a valid extension like "},{"Code":".jpg"},{"Text":"."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"From the XML WSDL, we know the arguments that are required, and with a bit of"},"SoftBreak",{"Text":"trial and error, we can find the right format of the payload."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"xml"}}},{"Text":"\u003cuser\u003etest\u003c/user\u003e\n"},{"End":{"CodeBlock":{"Fenced":"xml"}}},{"Start":"Paragraph"},{"Text":"When we send the post we get an error saying:"},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":""}}},{"Text":"test is not a register user\n"},{"End":{"CodeBlock":{"Fenced":""}}},{"Start":"Paragraph"},{"Text":"Now we have a value "},{"Code":"user"},{"Text":" that can output on the response. This means we can"},"SoftBreak",{"Text":"make an XXE Injection to get the "},{"Code":"authorized.xml"},{"Text":" file as the user value and"},"SoftBreak",{"Text":"make the response print it as an error for profit. We can guess the position of"},"SoftBreak",{"Text":"the file because the response includes where our image was uploaded, or we"},"SoftBreak",{"Text":"could try and get the entire directory, or a known file like "},{"Code":"/etc/passwd"},{"Text":"."},{"End":"Paragraph"},{"Start":"Paragraph"},{"Text":"The final payload is the following."},{"End":"Paragraph"},{"Start":{"CodeBlock":{"Fenced":"xml"}}},{"Text":"\u003c!DOCTYPE root [!ENTITY test SYSTEM 'file:///var/chall300_web/authorized.xml'\u003e]\u003e\n\u003cuser\u003e\u0026test;\u003c/user\u003e\n"},{"End":{"CodeBlock":{"Fenced":"xml"}}},{"Start":"Paragraph"},{"Start":{"Image":["Inline","/images/reply-challenges/flag.png",""]}},{"Text":"flag"},{"End":{"Image":["Inline","/images/reply-challenges/flag.png",""]}},{"End":"Paragraph"},{"Start":"BlockQuote"},{"Start":"Paragraph"},{"Text":"If you want to read more about XXE here"},"SoftBreak",{"Start":{"Link":["Inline","https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection",""]}},{"Text":"PayloadAllTheThings/XXE Injection"},{"End":{"Link":["Inline","https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection",""]}},{"End":"Paragraph"},{"End":"BlockQuote"}]}},"__N_SSG":true},"page":"/posts/[path]","query":{"path":"2020-10-10_reply_challenges_2020_that_is_what_server_says"},"buildId":"1FCVS7IGzcEpLjeHx1B2_","runtimeConfig":{"domain":"joshuachp.dev"},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>